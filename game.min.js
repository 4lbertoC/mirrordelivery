var requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;window.requestAnimationFrame=requestAnimationFrame;
var d=document.getElementById("c"),e=d.getContext("2d"),g=640,h=400,k=16,l=1,aa=3,ba=1,ca=1,m=12,n=[8,-8],da=12,ea=[100,370],fa=[g-36,20],p="023123467".split(""),q=null,ga=4,r=0,t=0,u=!1,v=!1,w=!1,x=0,ha=null,ia=!1,y=void 0,z=null,ja=null,A=3,B=[],ka=null,la=null,ma={a:null,size:1,position:null,b:null},C=[],na={a:null,position:null},D=[],pa={a:null,position:null,speed:6},E=[],F=!1,H=d.getBoundingClientRect(),I=0,J=0,K=0,L=document.createElement("canvas"),M={};
window.addEventListener("keyup",function(a){M[a.keyCode]=void 0},!1);window.addEventListener("keydown",function(a){M[a.keyCode]=Date.now()},!1);for(var qa=[523.25,587.33,659.26,698.46,783.99,880,987.77,1046.5,1108.73],ra={},N=0;N<qa.length;N++)ra[N]=jsfxlib.createWave(["synth",0,0.4,0,0.208,0,0.12,20,qa[N],2400,0,0,0,0.01,3E-4,0,0,0,0,0,0,0,0,1,0,0,0.1,0]);var O=p.slice();function sa(){ra[O.shift()].play();0<O.length&&setTimeout(sa,200)}var P={};
P[0]=jsfxlib.createWave(["square",0,0.4,0,0.174,0,0.28,20,497,2400,0.22,0,0,0.01,3E-4,0,0,0,0.0665,0,0,0,0,0.783,0,0,0,0]);P[l]=jsfxlib.createWave(["noise",0,0.4,0,0.14,0.405,0.116,20,479,2400,-0.07,0,0,0.01,3E-4,0,0,0,0,0,0,-0.086,-0.122,1,0,0,0,0]);P[5]=jsfxlib.createWave(["square",0,0.4,0,0.098,0.504,0.282,20,1582,2400,0,0,0,0.01,3E-4,0,0,0,0,0,0,0,0,1,0,0,0,0]);P[8]=jsfxlib.createWave(["saw",0,0.4,0,0.324,0,0.284,20,631,2400,0.172,0,0.498,19.35,3E-4,0,0,0,0,0,0,0,0,1,0,0,0,0]);
function Q(a){P[a]&&(P[a].pause(),P[a].currentTime=0,P[a].play())}var R=0,S=0,T=g/k,U=h/k;B.length=T*U;for(R=0;R<T;R++)for(S=0;S<U;S++)B[T*S+R]="0";function V(a,f,b){var c=new Image;c.width=f||16;c.height=b||16;c.src=a;return c}ha=V("man.png",16,32);ja=V("crow.png");ka=V("ladder.png");na.a=V("crumbs.png");pa.a=V("shot.png");la=V("nest.png");function ta(a,f,b,c){for(f=f.slice();0<f.length;)a.fillText(f.shift(),b,c),c+=13}
function W(){F=!1;q=ea.slice();z=fa.slice();for(var a=ba,f,b,c,G=C.length=0;G<aa;G++)f=Object.create(ma),f.size=a,b=document.createElement("canvas"),b.width=m+a,b.height=m+a,c=b.getContext("2d"),c.setFillColor("yellow"),c.fillRect(0,0,m+a,m+a),c.setFillColor("black"),c.fillText(a,5,10),f.a=b,b=60+10*a,f.position=[b,360],f.b=[b,360],C.push(f),a+=ca;L.width=g;L.height=h;a=L.getContext("2d");a.clearRect(0,0,g,h);a.font="12px sans-serif";a.setFillColor("rgba(0,0,0,0.7)");a.fillRect(0,0,g,h);a.setFillColor("fff");
a.fillText("Click the crow to start!",g-170,25);ta(a,["Delivery Boy must deliver all the boxes to the green goal.","If you fall from too high, the box will break, and it is returned to start position.","Use arrows to move and jump, SPACEBAR to take/leave boxes, E to eat speed candies.","Speed candies leave crumbs on the ground."],140,330);a.textAlign="right";ta(a,["Crow must hinder Delivery Boy from delivering all the boxes.","Move with mouse, left click to shoot and right click to collect food.",
"Food recharges shots and is found in the nest and crumbs left by Delivery Boy.","Don't touch roofs and don't get too close to Delivery Boy."],440,30);a.font="20px sans-serif";a.textAlign="center";a.fillText("Delivery Boy "+J+" - "+K+" Crow",g/2,h/2);a.beginPath();a.arc(g-25,25,16,0,360);a.lineWidth=1;a.strokeStyle="fff";a.stroke();O=p.slice()}W();function X(a){return[a.clientX-H.left,a.clientY-H.top]}function ua(){return Math.max(1,ga+r-(void 0!==y?C[y].size:0))}
d.addEventListener("click",function(a){a=X(a);if(!F)a[0]>g-36&&36>a[1]&&(F=!0,I=Date.now()+3E5,sa(),d.style.cursor="none");else if(0<A){A--;var f=Object.create(pa);f.position=a.slice();E.push(f)}});d.addEventListener("mousemove",function(a){F&&(z=X(a).slice())});
d.addEventListener("contextmenu",function(a){a.preventDefault();if(F)if(a=X(a),"6"===B[T*Math.round(z[1]/k)+Math.round(z[0]/k-0.5)]||"6"===B[T*Math.round(z[1]/k)+Math.round(z[0]/k+0.5)])A=Math.max(A,3);else{var f;for(f=0;f<D.length;f++)if(Y(a,D[f].position)){A=Math.max(A,5);D.splice(f,1);break}}});B="4444444444444444444444444444444444444444333333000000000000000000000000000000006000000300000000000000000000000000000000110000000000000000000000000033330000000000055500000000000000020000000000000000000011111100100110011112011100111100000000000000000000000000000200000000001000000000000000000000000000020000000000010000000000011100000000001111110000000000100200000020000000000000333333300003333301021000002000333333000000000000000000000002000000200000000000000000000000000000000200000020000000000000100100100110000202020000002011111111111110000000333110000002111000200333333333300000000000033000000333330020000000000000000000000000000000000000002000000000000000002000000000000200000000201111001111100111201110011111120111110020000000000000000020000000000002000000002000000000000000002000000000000200000000003333000000000000111100002000020000000000000000000000000000000000211112000000000000000000000000000000000020000000000011111111111111111111111111111111111111114444444444444444444444444444444444444444";
function Y(a,f){return Math.round(a[0]/k)===Math.round(f[0]/k)&&Math.round(a[1]/k)===Math.round(f[1]/k)}function Z(a){return Y(q,[q[0],q[1]+k/2])||B[T*Math.round(q[1]/k)+Math.round(q[0]/k)]!==a&&B[T*Math.round(q[1]/k)+Math.round(q[0]/k+1)]!==a?!1:!0}function $(a,f){return B[T*Math.round(a[1]/k-1)+Math.round(a[0]/k-0.5)]===f||B[T*Math.round(a[1]/k-1)+Math.round(a[0]/k+0.5)]===f?!0:!1}function va(){var a=void 0!==y?C[y]:void 0;a&&(Q(l),y=void 0,a.position=a.b.slice())}
function wa(){var a=void 0!==y?C[y]:void 0;a&&x>da-a.size&&va()}
(function xa(f){if(F){var b=ua(),c=q[0],G=q[1];if(!M[32]||u||v||w)if(M[69]&&!w){w=!0;r=3;t=Date.now()+5E3;var s=Object.create(na);s.position=[q[0]+4,q[1]-7];D.push(s);Q(8)}else M[32]||(M[69]||!w)||(w=!1);else{w=!0;var s=y,oa=void 0!==s?C[s]:void 0;if(void 0===oa)for(s=0;s<C.length;s++){if(Y(q,C[s].position)){y=s;break}}else y=void 0,$(q,"5")&&void 0!==oa&&(Q(5),C.splice(s,1),0>=C.length&&(J+=1,d.style.cursor="auto",W()))}M[37]&&(q[0]=Math.max(k,c-b));M[38]?$(q,"2")?q[1]=Math.min(h-k,G-2):u||v||(x=
-7,v=u=!0,Q(0)):!M[38]&&u&&(u=!1);M[39]&&(q[0]=Math.min(g-2*k,c+b));M[40]&&($(q,"2")&&!Z("1"))&&(q[1]=Math.min(h,G+2))}H=d.getBoundingClientRect();if($(q,"2")||Z("1")||q[1]>h-k){if(0<x||Z("2"))wa(),x=0,v=!1}else 0<x&&ia&&(wa(),x=k/3),x+=1,v=!0;q[1]+=x;ia="1"===B[T*Math.round(q[1]/k)+Math.round(q[0]/k)]||"1"===B[T*Math.round(q[1]/k)+Math.round(q[0]/k+1)]?!0:!1;void 0!==y&&(C[y].position[0]=q[0]+n[0],C[y].position[1]=q[1]+n[1]);t<f&&0<r&&(r=0);for(b=0;b<E.length;b++)if(c=E[b],c.position[1]+=c.speed,
Y(q,c.position))va(),E.splice(b,1),b--;else if(c.position[1]>h||$(c.position,"3"))E.splice(b,1),b--;F&&I<f&&(K+=1,d.style.cursor="auto",W());e.setFillColor("black");e.fillRect(0,0,g,h);for(R=0;R<T;R++)for(S=0;S<U;S++)c=null,b="00deff","0"!==B[T*S+R]&&("1"===B[T*S+R]?b="555":"2"===B[T*S+R]?c=ka:"3"===B[T*S+R]?b="brown":"4"===B[T*S+R]?b="000":"5"===B[T*S+R]?b="0f0":"6"===B[T*S+R]?c=la:b="fff"),e.setFillColor(b),e.fillRect(R*k,S*k,k,k),c&&e.drawImage(c,R*k,S*k,k,k);e.drawImage(ha,q[0]+8,q[1]-24);for(c=
0;c<C.length;c++)b=C[c],e.drawImage(b.a,b.position[0],b.position[1]);for(c=0;c<D.length;c++)b=D[c],e.drawImage(b.a,b.position[0],b.position[1]);for(c=0;c<E.length;c++)b=E[c],e.drawImage(b.a,b.position[0],b.position[1]);e.drawImage(ja,z[0],z[1]);e.setFillColor("00deff");e.fillText("BOY",10,396);e.setFillColor("red");e.fillText("CROW",600,12);e.setFillColor("white");e.fillText("SPEED: "+ua(),40,396);e.fillText("BOOST TIMEOUT: "+Math.max(0,Math.ceil((t-f)/1E3)),100,396);e.fillText("TIME LEFT: "+Math.max(0,
Math.ceil((I-f)/1E3)),210,396);e.fillText("SHOTS: "+A,540,12);F||e.drawImage(L,0,0);window.requestAnimationFrame(xa)})();
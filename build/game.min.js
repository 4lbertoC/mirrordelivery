var ia={};
(function(a){function z(a,d){return d?J(a&255)+z(a>>8,d-1):""}var A=this.ya=a||44100,x=2*A,J=String.fromCharCode,l;this.Na=function(a){var d=Audio,u=btoa,n="",w=a.length;for(q=0;q<w;q++)var h=32767*a[q]|0,h=-32768>h?-32768:32767<h?32767:h,h=h+(0>h?65536:0),n=n+String.fromCharCode(h&255,h>>8);a=n;a=["RIFF",36+(l=a.length),"WAVEfmt ",16,1,1,A,x,2,16,"data",l,a];n="";for(q=0;q<a.length;q++)n+="s"=="s4s4224422s4s"[q]?a[q]:z(a[q],"s4s4224422s4s".charCodeAt(q)-48);return new d("data:audio/wav;base64,"+u(n))};
var d,q,u=Math.sin,h=2*Math.PI;this.filter=function(a,h,l,n,w,u,x,A,z,J){l=l?l:1;n=n?n:a.length;d=a.slice(0);for(q=l;q<n;q++)d[q]=h(a,d,l,n,q,w,u,x,A,z,J);return d};this.filters={Ta:function(a,d,h,l,w,q){return d[w-1]+q*(a[w]-d[w-1])},Ua:function(a,d,h,q,w,l){return d[w-1]+l*(q-w)/(q-h)*(a[w]-d[w-1])},Sa:function(a,d,h,q,l,u){return u*(d[l-1]+a[l]-a[l-1])}};this.Aa=function(a,d,l,u,w,x,z,J,F){d=d*h/A;var N=Array(a|0);for(q=0;q<a;q++)N[q]=l(q*d,u,w,x,z,J,F);return N};var F=0;this.L={Oa:function(a){4>
a%h&&(F=2*Math.random()-1);return F},Va:Math.random,Qa:Math.sin,Ra:function(a){return u(a)+0.5*u(a/2)+0.3*u(a/4)},Pa:function(a){return 2*(a/h-(a/h+0.5|0))},Ba:function(a,d){return u(a)>d?1:u(a)<d?-1:d}}}).apply(ia);var Ea={};
(function(){this.ga=[];this.da={square:ia.L.Ba,saw:ia.L.Pa,sine:ia.L.Qa,noise:ia.L.Oa,synth:ia.L.Ra};this.Ja=function(){var a=[],z;for(z in this.da)a.push(z);return a};this.Ka=function(){function a(a,l,d,q,u){void 0===u&&(u=(d-l)/1E3);a={name:a,id:a.replace(/ /g,""),min:l,max:d,step:u,Ia:q,type:"range",group:A};z.push(a)}var z=[],A=0,x=this.Ja();(function(a,l,d){a={name:a,id:a.replace(/ /g,""),options:l,Ia:d,type:"option",group:A};z.push(a)})("Generator",x,x[0]);a("SuperSamplingQuality",0,16,0,1);
a("MasterVolume",0,1,0.4);A++;a("AttackTime",0,1,0.1);a("SustainTime",0,2,0.3);a("SustainPunch",0,3,2);a("DecayTime",0,2,1);A++;a("MinFrequency",20,2400,0,1);a("StartFrequency",20,2400,440,1);a("MaxFrequency",20,2400,2E3,1);a("Slide",-1,1,0);a("DeltaSlide",-1,1,0);A++;a("VibratoDepth",0,1,0);a("VibratoFrequency",0.01,48,8);a("VibratoDepth Slide",-0.3,1,0);a("VibratoFrequencySlide",-1,1,0);A++;a("ChangeAmount",-1,1,0);a("ChangeSpeed",0,1,0.1);A++;a("SquareDuty",0,0.5,0);a("SquareDutySweep",-1,1,0);
A++;a("RepeatSpeed",0,0.8,0);A++;a("PhaserOffset",-1,1,0);a("PhaserSweep",-1,1,0);A++;a("LPFilterCutoff",0,1,1);a("LPFilterCutoffSweep",-1,1,0);a("LPFilterResonance",0,1,0);a("HPFilterCutoff",0,1,0);a("HPFilterCutoffSweep",-1,1,0);return z};this.Aa=function(a){var z=2*Math.PI,A=Math.sin,x=Math.pow,J=Math.abs,l=ia.ya,d=a.SuperSamplingQuality|0;1>d&&(d=1);for(var l=l*d,q=[{K:0,Y:1,time:a.AttackTime},{K:1+a.SustainPunch,Y:1,time:a.SustainTime},{K:1,Y:0,time:a.DecayTime}],u=q.length,h=0;h<u;h++)q[h].V=
1+(q[h].time*l|0);for(var F=void 0,T=0,pa=-1,Da=0,n=-1,w=0,h=0;h<u;h++)w+=q[h].V;w<l/2&&(w=l/2);var za=Array(w/d|0),B=0,qa=0,Aa=Ea.da[a.Generator];void 0===Aa&&(Aa=this.da.Ba);var N=0,N=a.SquareDuty,ja=a.SquareDutySweep/l,E=0,O=a.StartFrequency*z/l,Z=1+64*x(a.Slide,3)/l,ca=x(a.DeltaSlide,3)/(1E3*l);void 0!==d&&(ca/=d);a.MinFrequency>a.StartFrequency&&(a.MinFrequency=a.StartFrequency);a.MaxFrequency<a.StartFrequency&&(a.MaxFrequency=a.StartFrequency);for(var ra=a.MinFrequency*z/l,da=a.MaxFrequency*
z/l,sa=0,Fa=a.VibratoFrequency*z/l,$=a.VibratoDepth,Ka=1+3*x(a.VibratoFrequencySlide,3)/l,Ba=a.VibratoDepthSlide/l,ea=0,fa=a.ChangeSpeed*l,W=x(a.ChangeAmount,2),W=0<a.ChangeAmount?1+10*W:1-0.9*W,ka=Array(1024),h=0;1024>h;h++)ka[h]=0;var ta=0,U=1020*x(a.PhaserOffset,2),la=4E3*x(a.PhaserSweep,3)/l,La=1E-5<J(la)||1E-5<J(U),P=0.0010<a.HPFilterCutoff||0.999>a.LPFilterCutoff,aa=0,X=0,Y=x(a.LPFilterCutoff,3)/10,Ga=1+a.HPFilterCutoffSweep/1E4,ba=5/(1+20*x(a.LPFilterResonance,2))*(0.01+a.LPFilterCutoff);0.8<
ba&&(ba=0.8);var ba=1-ba,L=0.999>a.LPFilterCutoff,p=0,Q=x(a.HPFilterCutoff,2)/10,v=1+a.HPFilterCutoffSweep/1E4,r=0,ua=w;0<a.RepeatSpeed&&(ua=x(1-a.RepeatSpeed,2)*l+32);for(var Ma=a.MasterVolume,G=0,h=0;h<w;h++)B=Aa(E,N,0),N+=ja,0>N?N=0:0.5<N&&(N=0.5),r>ua&&(E=0,O=a.StartFrequency*z/l,Z=1+3*x(a.Slide,3)/l,ca=x(a.DeltaSlide,3)/(1E3*l),void 0!==d&&(ca/=d),ea=0,fa=a.ChangeSpeed*l,W=1+(a.ChangeAmount|0)/12,r=0),r+=1,E+=O,Z+=ca,O*=Z,ea>fa&&(O*=W,fa=w),ea+=1,O>da?O=da:O<ra&&(O=ra),sa+=Fa,F=O*A(sa)*$,E+=
F,Fa*=Ka,Ba&&($+=Ba,0>$?Ba=$=0:1<$&&($=1,Ba=0)),P&&(0.0010<J(Q)&&(Q*=v,1E-5>Q?Q=1E-5:0.1<Q&&(Q=0.1)),F=aa,Y*=Ga,0>Y?Y=0:0.1<Y&&(Y=0.1),L?(X+=(B-aa)*Y,X*=ba):(aa=B,X=0),aa+=X,p+=aa-F,B=p*=1-Q),La&&(U+=la,0>U&&(U=-U,la=-la),1023<U&&(U=1023,la=0),ka[ta]=B,B+=ka[ta-(U|0)+1024&1023],ta=ta+1&1023),h>n&&(pa+=1,F=pa<u?q[pa]:{K:0,Y:0,V:w},T=F.K,Da=(F.Y-F.K)/(F.V+1),n+=F.V),B*=T,T+=Da,B*=Ma,1<d?(qa+=B,0===(h+1)%d&&(za[G]=qa/d,G+=1,qa=0)):za[h]=B;a=l/100|0;z=Array(a);for(h=0;h<a;h++)z[h]=0;return z.concat(za).concat(z)};
this.ga=this.Ka()}).apply(Ea);var Sa={};(function(){this.za=function(a){a=Ea.Aa(this.Ha(a));return ia.Na(a)};this.Ha=function(a){for(var z={},A=Ea.ga.length,x=0;x<A;x++)z[Ea.ga[x].id]=a[x];return z}}).apply(Sa);(function(){var a,z,A,x,J,l,d,q,u;function h(k,a){var b=new XMLHttpRequest;"withCredentials"in b?b.open(k,a,!0):"undefined"!=typeof XDomainRequest?(b=new XDomainRequest,b.open(k,a)):b=null;return b}function F(k,a,b,H,c){var e=Ca[k].frame;k=Ca[k].h;p.drawImage(ma,e.x,e.y,H||e.b,c||e.c,a+k.x,b+k.y,k.b,k.c)}function T(k,a,b,H,c,e){var g=Ca[k].frame,d=Ca[k].h;k=Ca[k].frames;H=e?k[Math.floor(e*H/1E3)%k.length]:k[H];c?p.drawImage(Na,$a-(g.x+H.x)-H.b,g.y+H.y,H.b,H.c,a+d.x,b+d.y,H.b,H.c):p.drawImage(ma,g.x+
H.x,g.y+H.y,H.b,H.c,a+d.x,b+d.y,H.b,H.c)}function pa(k){k=k||Levels[v];k=["CustomLevel"+Ma++,k[s.fa].slice(),k[s.ba].slice(),k[s.Z].slice(),k[s.q]&&k[s.q].slice(),k[s.j],k[s.ea],k[s.f].slice(),null,!0];Levels.push(k);f.state===y.e&&(v=Levels.length-1,B(v))}function Da(){if(Ta)try{f.state===y.i&&0<Ua.length&&(ab[Ua.shift()].play(),setTimeout(Da,200))}catch(k){}}function n(k,a){if(Ta)try{Ha[k]=Sa.za(a)}catch(b){}}function w(a){if(Ta)try{Ha[a]&&(Ha[a].pause(),Ha[a].currentTime=0,Ha[a].play())}catch(b){}}
function za(a){var b=a[s.Z],c,d,f,e;Oa.O=b;for(var g=M.length=0;g<a[s.f].length;g++)c=a[s.f][g],d=Object.create(Oa),d.size=c,f=document.createElement("canvas"),f.width=Pa+c,f.height=Pa+c,e=f.getContext("2d"),e.fillStyle="yellow",e.fillRect(0,0,Pa+c,Pa+c),e.fillStyle="black",e.fillText(c,5,10),d.ka=f,f=b[0]+16*g,c=b[1]-c,d.position=[f,c],d.O=[f,c],M.push(d)}function B(k){k=f.o=Levels[k]||Levels[v];ra(y.e);b.position=k[s.fa].slice();a=k[s.ba].slice();b.J=0;b.X=0;b.d=void 0;b.T=bb;b.w=!1;b.D=!1;b.a=
!1;b.n=!1;b.v=!1;z=cb;x=A=0;f.time=0;ra(y.e);G=0;k[s.q]?(d=k[s.q].slice(),q=[k[s.q][0]+15,k[s.q][1]+23],u=q.slice()):q=d=null;va="4444444444444444444444444444444444444444"+k[s.ea]+"4444444444444444444444444444444444444444";va=va.split("");za(k);wa.length=0;na.length=0;Qa.width=R;Qa.height=S;var t=Qa.getContext("2d");t.fillStyle="rgba(0,0,0,0.7)";t.fillRect(0,0,R,S);t.fillStyle="#fff";t.font="20px courier";t.textAlign="center";t.fillText(f.o[s.m],R/2,S/2-50);t.fillText("Delivery Boy "+f.ia+" - "+f.ja+
" Crow",R/2,S/2);t.font="15px courier";t.fillText("Click the "+(P?"screen":"crow")+" to start!",R/2,S/2+60);t.fillText("< >: Select level",R/2,S/2+100);t.fillText(k[s.Q]?"E: edit   "+(P?"1":"D")+": delete   "+(P?"2":"J")+": insert/copy JSON"+(Ga?"   S: share":""):"E: edit",R/2,S/2+120);t.beginPath();t.arc(a[0],a[1],16,0,360);t.lineWidth=1;t.strokeStyle="#fff";t.stroke();Ua=db.slice();window.localStorage&&(window.localStorage.sa=JSON.stringify(Levels))}function qa(){f.ia+=1;L.style.cursor="auto";w(D.xa);
B(v)}function Aa(){f.ja+=1;L.style.cursor="auto";w(D.oa);B(v)}function N(a){var b=a.clientX-f.S.left;a=a.clientY-f.S.top;b=Math.max(0,Math.min(b,R-1));a=Math.max(0,Math.min(a,S-1));return[b,a]}function ja(){return Math.max(1,b.speed+b.W-(void 0!==b.d?M[b.d].size:0))}function E(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c}function O(){ra(y.i);f.time=Q+f.o[s.j];Da();L.style.cursor="none"}function Z(){if(f.state===y.g)if(G<xa){var k=Math.floor(r[1]/
C);0<k&&k<Va-1&&(va[ya*k+Math.floor(r[0]/C)]=""+G)}else if(G===oa.ta)b.position=r.slice();else if(G===oa.B)a=r.slice();else if(G===oa.l&&d)d=r.slice(),q=[d[0]+15,d[1]+23],u=q.slice();else{if(G===oa.f)for(Oa.O=r.slice(),k=0;k<M.length;k++){var t=M[k];t.position[0]=r[0]+16*k;t.position[1]=r[1]-t.size}}else f.state!==y.e||P?0<A&&x<Q&&(A--,w(D.na),k=Object.create(jb),k.position=a.slice(),na.push(k)):r[0]>a[0]-16&&(r[0]<a[0]+16&&r[1]>a[1]-16&&r[1]<a[1]+16)&&O()}function ca(b){b.preventDefault();if(f.state===
y.g)Wa=!Wa;else if(f.state===y.i&&x<Q)if(b=N(b),(fa(a[0]-8,a[1]-8,16,16,I.C)||ea(a[0],a[1],0,0,I.C))&&A<kb)w(D.aa),A++;else{var t;for(t=0;t<wa.length;t++)if(sa(b,wa[t].position)){A=Math.max(A,lb);w(D.aa);wa.splice(t,1);break}}}function ra(a){f.state=a;if(P)if(a===y.g){a=document.getElementsByClassName("edit");for(var b=0;b<a.length;b++)a[b].setAttribute("class","btn edit")}else for(a=document.getElementsByClassName("edit"),b=0;b<a.length;b++)a[b].setAttribute("class","btn h edit")}function da(a,b){return va[ya*
Math.floor(b/C)+Math.floor(a/C)]}function sa(a,b){return Math.round(a[0]/C)===Math.round(b[0]/C)&&Math.round(a[1]/C)===Math.round(b[1]/C)}function Fa(){var a=b.d,c=void 0!==a?M[a]:void 0;if(void 0===c){for(a=0;a<M.length;a++)if(sa(b.position,M[a].position)){b.d=a;w(D.$);return}W(I.p)&&(b.J=mb,w(D.p))}else b.d=void 0,w(D.$),W(I.pa)&&void 0!==c&&(M.splice(a,1),0>=M.length?qa():w(D.ma))}function $(){var a=b.U,c=ja();b.a||(a=0);a=Math.min(c,a+c/7);b.U=a;return W(I.s)?c/2:a}function Ka(){L.style.cursor=
"auto";f.state===y.g&&(Levels[v][s.ea]=va.join("").substring(ya,ya*Va-ya),Levels[v][s.fa]=b.position.slice(),Levels[v][s.ba]=a.slice(),Levels[v][s.q]=d instanceof Array?d.slice():void 0,Levels[v][s.Z]=Oa.O.slice());B(v)}function Ba(a){var t=ja(),l=b.Ma,H=b.position[0],p=b.position[1],e=V.la;if(f.state===y.e)if(e[c.t]&&!b.a)v=(v+Levels.length-1)%Levels.length,B(v),b.a=!0;else if(e[c.u]&&!b.a)v=(v+1)%Levels.length,B(v),b.a=!0;else if(e[c.k]&&!b.a)b.a=!0,Levels[v][s.Q]||pa(),ra(y.g),e[c.k]=void 0;else if(e[c.F]&&
!b.a)b.a=!0,Levels[v][s.Q]&&(Levels.splice(v,1),v--,B(v)),e[c.F]=void 0;else if(e[c.r]&&Levels[v][s.Q]&&!b.a){if(l=t=prompt("LEVEL JSON",JSON.stringify(Levels[v])))a:{try{JSON.parse(t);l=!0;break a}catch(g){alert("Error!")}l=!1}l&&(Levels[v]=JSON.parse(t),B(v));e[c.r]=void 0}else if(e[c.ha]&&!b.a){if(b.a=!0,Ga){var m=h("post",Y+"/addLevel");m.onload=function(){prompt("Your level share url",m.responseText)};m.send(JSON.stringify(Levels[v]));e[c.ha]=void 0}}else e[c.t]||(e[c.u]||e[c.F]||e[c.k]||e[c.r]||
e[c.ha])||(b.a=!1);else{if(f.state===y.g)if(e[c.t]&&!b.a)G=(G+Xa-1)%Xa,b.a=!0;else if(e[c.u]&&!b.a)G=(G+1)%Xa,b.a=!0;else if(e[c.l]&&!b.a)d instanceof Array?u=q=d=null:(d=[32,32],q=[d[0]+15,d[1]+23],u=q.slice()),b.a=!0;else if(e[c.f]&&!b.a){b.a=!0;try{var r=JSON.parse(prompt("Set crates",JSON.stringify(Levels[v][s.f])));if(r instanceof Array){for(t=0;t<r.length;t++)"number"===!typeof t&&alert("Error!"),r[t]=Math.max(1,Math.min(5,r[t]));Levels[v][s.f]=r;za(Levels[v])}}catch(x){alert("Error!")}e[c.f]=
void 0}else e[c.m]&&!b.a?(b.a=!0,(t=prompt("Set name",Levels[v][s.m]))&&(Levels[v][s.m]=t),e[c.m]=!1):e[c.j]&&!b.a?(b.a=!0,a=+prompt("Set time",Levels[v][s.j]),!isNaN(a)&&0<a&&(Levels[v][s.j]=a),e[c.j]=!1):e[c.k]&&!b.a?(b.a=!0,Ka(),e[c.k]=void 0):e[c.t]||(e[c.u]||e[c.l]||e[c.f]||e[c.m]||e[c.j]||e[c.k])||(b.a=!1);else f.state===y.i&&(!e[c.P]||b.D||b.n||b.w?e[c.k]&&!b.w?(b.w=!0,0<b.J&&(b.J--,b.W=nb,b.X=a+ob,r=Object.create(pb),r.position=[b.position[0]+4,b.position[1]-7],wa.push(r),w(D.wa))):e[c.P]||
(e[c.k]||!b.w)||(b.w=!1):(b.w=!0,Fa()),e[c.R]?W(I.s)?(b.position[1]=Math.min(S-C,p-l),b.a=!0):b.D||b.n||(b.A=b.La,b.U=t,b.D=!0,b.n=!0,w(D.ra)):!e[c.R]&&b.D&&(b.D=!1),e[c.t]&&(b.position[0]=Math.max(C,H-$()),b.a=!0,b.v=!0),e[c.u]&&(b.position[0]=Math.min(R-2*C,H+$()),b.a=!0,b.v=!1),e[c.ca]&&W(I.s)&&(b.position[1]=Math.min(S,p+l),b.a=!0),e[c.t]||(e[c.R]||e[c.u]||e[c.ca])||(b.a=!1));e[c.e]&&Ka()}}function ea(a,b,c,d,f){var e=b,g=da(a,e);c=a+c;topRight=da(c,e);bottomRight=da(c,b+d);bottomLeft=da(a,b);
return g===f||topRight===f||bottomRight===f||bottomLeft===f}function fa(a,b,c,d,f){b+=d;d=da(a,b);bottomLeft=da(a+c,b);return d===f||bottomLeft===f}function W(a){return ea(b.position[0]-8,b.position[1]-32,16,32,a)||ea(b.position[0],b.position[1]-8,0,0,a)}function ka(a,b){return Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2)}function ta(){return void 0!==b.d?M[b.d]:void 0}function U(a,b){return Math.atan((b[1]-a[1])/(b[0]-a[0]))}function la(){var a=ta();a&&(w(D.ua),b.d=void 0,a.position=a.O.slice(),b.T--,
0>=b.T&&Aa())}function La(a,b,c){var d=null,f="#00deff";a===I.va?d=K.Ga:a===I.I?d=K.I:a===I.Fa?f="#000":a===I.pa?f="#0f0":a===I.C?d=K.C:a===I.s?d=K.s:a===I.p&&(d=K.p);p.fillStyle=f;p.fillRect(b,c,C,C);null!==d&&F(d,b,c,C,C)}(function(){for(var a=0,b=["webkit","moz"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||
(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),f=window.setTimeout(function(){b(c+d)},d);a=c+d;return f});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})})();window.createCORSRequest=h;var P=!1;if("ontouchstart"in document.documentElement)for(var P=!0,aa=document.getElementsByClassName("btn"),X=0;X<aa.length;X++)-1===aa[X].getAttribute("class").indexOf("edit")&&aa[X].setAttribute("class","btn");var Y="http://127.0.0.1:3000",
Ga=!1,ba=h("get",Y+"/getServerCode");ba&&(ba.onload=function(){if("Ok"===ba.responseText){Ga=!0;var a=window.location.hash;if(1<a.length){var a=a.substr(1),b=h("get",Y+"/getLevel/"+a);b.onload=function(){try{var a=b.responseText;0<a.length&&pa(JSON.parse(a))}catch(c){alert("Error!")}};b.send()}}},ba.send());var L=document.getElementById("C"),p=L.getContext("2d"),Q=0,v=0,r=[0,0],ua=!1,Ma=1,G=0,Wa=!1,R=640,S=400,C=16,ya=R/C,Va=S/C,Ta=window.btoa&&window.atob,I={EMPTY:"0",va:"1",s:"2",I:"3",Fa:"4",pa:"5",
C:"6",p:"7"},xa=8,oa={ta:xa+0,B:xa+1,l:xa+2,f:xa+3},Xa=xa+4,y={e:0,i:1,g:2},D={ra:0,ua:1,na:2,Ca:3,$:4,ma:5,xa:6,oa:7,wa:8,aa:9,p:10,qa:11},bb=10,Pa=12,eb=[1,-6],nb=3,ob=5E3,mb=3,kb=3,lb=5,cb=10,db="023123467".split(""),c={t:37,R:38,u:39,ca:40,k:69,P:32,e:27,F:68,r:74,l:71,f:67,m:78,j:84,ha:83},K={B:0,Da:1,p:2,l:3,s:4,H:5,C:6,I:7,Ea:8,Ga:9},Ca={},Ca=[{frame:{x:30,y:0,b:30,c:14},h:{x:1,y:1,b:30,c:14},frames:[{x:1,y:1,b:15,c:13},{x:17,y:1,b:15,c:13}]},{frame:{x:14,y:40,b:14,c:8},h:{x:1,y:7,b:14,c:8}},
{frame:{x:32,y:14,b:16,c:16},h:{x:0,y:0,b:16,c:16}},{frame:{x:0,y:24,b:14,c:24},h:{x:1,y:7,b:14,c:24}},{frame:{x:16,y:48,b:16,c:16},h:{x:0,y:0,b:16,c:16}},{frame:{x:0,y:0,b:30,c:24},h:{x:1,y:3,b:30,c:24},frames:[{x:0,y:0,b:15,c:24},{x:15,y:0,b:15,c:24}]},{frame:{x:48,y:14,b:16,c:10},h:{x:0,y:10,b:16,c:10}},{frame:{x:14,y:24,b:16,c:16},h:{x:0,y:0,b:16,c:16}},{frame:{x:31,y:30,b:6,c:14},h:{x:4,y:1,b:6,c:14}},{frame:{x:0,y:48,b:16,c:16},h:{x:0,y:0,b:16,c:16}}],s={m:0,fa:1,ba:2,Z:3,q:4,j:5,ea:6,f:7,G:8,
Q:9},ma=new Image,Na=document.createElement("canvas"),$a=0;ma.onload=function(){Na.width=$a=ma.naturalWidth;Na.height=ma.naturalHeight;var a=Na.getContext("2d");a.translate(ma.naturalWidth,0);a.scale(-1,1);a.drawImage(ma,0,0)};ma.src="img/imgmap.png";var b={position:null,speed:4,U:0,W:0,X:0,Ma:2,La:-7,D:!1,n:!1,a:!1,w:!1,A:0,d:void 0,J:0,T:bb,v:!1};J=a=null;A=0;l=!1;x=0;z=cb;var va=[],Oa={ka:null,size:1,position:null,O:[0,0]},M=[],pb={position:null},wa=[],jb={position:null,speed:6},na=[],f={state:y.e,
S:L.getBoundingClientRect(),time:0,ia:0,ja:0,o:null},Qa=document.createElement("canvas");u=null;d=[80,53];q=[95,78];var fb=[["Tutorial",[33,370],[R-24,55],[300,365],[20,70],3E6,"00000000000000000000000000000000000000000000000000000000000000000000000000000000330000000000000000000000000000000000006000000000000000000000000000000000000000110000000000033300000000000006000000000000110000000003330000000000001110000000000000000000000333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003333333333333333333333333333333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000555500000000000000000000000000000000000055550000000000000000000000000000000000005555000000000007000000000000002000000000111111111111111111111111111111200000000000000000000000000000000000000020000000000000000000000000000000000000002000000000000000000000000000000000000000200000000000000000000000000000000000000020000000001111111111111111111111111111111111111111",
[1],[[20,340,["PLAYER 1"]],[100,340,["ARROWS: move/jump"]],[250,340,["SPACEBAR: grab/release crate"]],[500,340,["UP/DOWN: Climb ladder"]],[450,250,["Crates break if you fall from too high"]],[160,250,[(P?"S":"SPACEBAR")+": buy candies when not holding crate","E: Use candy to gain speed"]],[10,230,["Deliver crate to green area"]],[560,30,["PLAYER 2",(P?"DPad":"Mouse")+": move"]],[410,70,["Don't get shot","Hide in the nest"]],[410,130,[(P?"2":"RClick")+": eat from nest or candy crumbs",(P?"1":"LClick")+
": shoot!"]],[140,60,["Don't touch roofs or the boy"]]]],["Level 1",[25,366],[616,24],[41,364],[513,180],6E4,"00000000000000000000000000000000000000600000000000000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000003330000000000000000000000000000000000003333300000000000000000000000000000000000055500000000000000000000000000000000000005550000020000000000000200000000000000000555020002000111111111120000333000000000111112000200133333330002000000000000000000000200021130000000000200000000000000000000020002000000000000020000000000000000000002000200020000000002111111100111001101111100111112000000000200000000000000000000000033333200000000020000000000000000000000000000020000000000000000000000000000000000000002000000000000000000000000000000000000000200000000000000000000000000000000001111111111111111111111111111111111111111",
[1,2]],["Level 2",[28,143],[600,296],[588,365],[51,50],12E4,"33330000000000000000000000000000000000005550000000000033000000000330000000000000555000000000000000000000000000000000000055500000000000000003030000000000000000001111111000000000000030000000000000110010000000010000000000000000000000000100301000000000000200000200000200000200000000100000000011120111102000201111021113002010111100000002000000020200000002000000211100000000000100000000200000000100000020000000000000000000000000000000000002002000000000000000000000000000000000030211100000001110000000000000000000000030020000000000000000000000003333300000000002000000000000000000000000000000000003020200000000000001100000000000000000000002110000000000000000000000000020700000020200000000000000000000000000112110000002020000060000000000010000000000200000000201000011100000000000000000000020000000020000000000000000000000000000002000000002000000000000000000000000000000200000000200000000001111111111111111111111111111111111111111",
[1,2]],["Level 3",[17,349],[281,39],[96,316],[49,163],24E4,"00000000000000010001000000000000000000000000000000300001666100003000000000000020000000000003000111110003000000000007002000000000000030000000003000000000001110203000000000000000000000000000000000000020332200000000000000000000000000000000002033202000000000000000000000000000000000203320320000000000222000000000000000000020332033111001111100011111000110011001102055200000000000000000000000000110011000205520000000000000000000000000000000000020111100000000000000000000000000000000002000000000000000030003000000000220022000200000000000000030000030000200000000000020000000000000000300030000020000000000002000003030300000000200000002011001100110200003030303030303020000000200011001100020000000000030303032111111000000000000000000000000000000000203030303030000000000000000011100070000023030303030300000000000000000000011100002000000000000000000000011110000000000000200000000000000000000001111111111111111111111111111111111111111",
[1,2]],["Level 4",[75,370],[R-24,24],[83,365],[80,53],3E5,"33333300000000000000000000000000000000605555530000000000000000000000000000000011555550000000000000000000003333000000000055555000000000000002000000000000000000001111110010011001111201110011110000000000000000000003300000020000000000100000000000000000000000000702000000000001000000000001110000000000111111000000000010020000002000000000000033333330000333330102100000200033333300000000000000000000000200000020000000000000000000000000000000020000002000000000000010010010011000020202000000201111111111111000000033311001111211100020033333333330000000000003300000033333002000000000000000000000000000000000000000200000000000000000200000000000020000000020111100111110011120111001111112011111002000000000000000002000000303030200000000200000000000000000207000000000020000000000333330003030300011110000200002000000000000000000000000000000000021111200000000000000000000000000000000002000000000001111111111111111111111111111111111111111",
[1,2,3]]];Levels=window.localStorage&&window.localStorage.sa&&JSON.parse(window.localStorage.sa)||fb;var Ma=Levels.length-fb.length+1,V={la:{},N:function(a){V.la[a.keyCode]=void 0},M:function(a){V.la[a.keyCode]=Q}};window.addEventListener("keyup",V.N,!1);window.addEventListener("keydown",V.M,!1);for(var gb=[523.25,587.33,659.26,698.46,783.99,880,987.77,1046.5,1108.73],ab={},Ra=0;Ra<gb.length;Ra++)ab[Ra]=Sa.za(["synth",0,0.4,0,0.208,0,0.12,20,gb[Ra],2400,0,0,0,0.01,3E-4,0,0,0,0,0,0,0,0,1,0,0,0.1,0]);
var Ua=db.slice(),Ha={};n(D.ra,["square",0,0.4,0,0.174,0,0.28,20,497,2400,0.22,0,0,0.01,3E-4,0,0,0,0.0665,0,0,0,0,0.783,0,0,0,0]);n(D.ua,["noise",0,0.4,0,0.14,0.405,0.116,20,479,2400,-0.07,0,0,0.01,3E-4,0,0,0,0,0,0,-0.086,-0.122,1,0,0,0,0]);n(D.ma,["square",0,0.4,0,0.098,0.504,0.282,20,1582,2400,0,0,0,0.01,3E-4,0,0,0,0,0,0,0,0,1,0,0,0,0]);n(D.wa,["saw",0,0.4,0,0.324,0,0.284,20,631,2400,0.172,0,0.498,19.35,3E-4,0,0,0,0,0,0,0,0,1,0,0,0,0]);n(D.na,["saw",0,0.4,0,0.212,0,0.028,20,1169,2400,-0.52,0,0,
0.01,3E-4,0,0,0,0.5,-0.592,0,0.094,0.066,1,0,0,0.28,0]);n(D.oa,["synth",0,0.4,0,0.32,0.348,0.44,20,372,417,0,0,0,0.01,3E-4,0,0.374,0.264,0,0,0,0,0,1,0,0,0,0]);n(D.xa,["synth",0,0.4,0,0.13,0.345,0.41,253,1168,1407,-0.0060,-0.082,0,0.01,3E-4,0,0.206,0.166,0,0,0,0,0,1,0,0,0,0]);n(D.$,["noise",0,0.4,0,0.0020,0.024,0.09,20,372,2400,0,0,0,0.01,3E-4,0,-0.342,0.809,0,0,0,0,0,1,0,0,0,0]);n(D.Ca,["noise",0,0.4,0,0.152,0.393,0.274,20,839,2400,-0.31,0,0,0.01,3E-4,0,-0.34,0.783,0,0,0.6096,0.526,-0.0080,1,0,0,
0,0]);n(D.aa,["square",0,0.4,0,0.04,0,0.048,20,578,2400,0.104,0,0.683,19.158,3E-4,0,0,0,0.385,0,0,0,0,1,0,0,0,0]);n(D.p,["square",0,0.4,0,0.046,0.477,0.24,20,1197,2400,0,0,0,0.01,3E-4,0,0.498,0.204,0,0,0,0,0,1,0,0,0,0]);n(D.qa,["noise",0,0.4,0,0.108,0.336,0.124,20,462,2400,0,0,0,0.01,3E-4,0,0,0,0,0,0,0,0,1,0,0,0,0]);B(v);E(L,"click",Z);E(L,"mousedown",function(a){1===a.which&&(ua=!0);f.state===y.g&&ua&&Z()});E(L,"mouseup",function(a){1===a.which&&(ua=!1)});E(L,"mousemove",function(a){var b=N(a);r=
[b[0],b[1]];f.state===y.i?J=N(a).slice():f.state===y.g&&ua&&Z()});E(L,"contextmenu",ca);if(P){var ga=function(a,b){var c=document.getElementById(a);E(c,"touchstart",function(){V.M({keyCode:b})});E(c,"touchend",function(){V.N({keyCode:b})})},Ya=function(a,b,c){a=document.getElementById(a);E(a,"touchstart",b);E(a,"touchend",c)};E(L,"touchstart",function(){f.state===y.e&&O()});Ya("s",function(){f.state===y.e?V.M({keyCode:c.F}):Z()},function(){V.N({keyCode:c.F})});Ya("e",function(a){f.state===y.e?V.M({keyCode:c.r}):
ca(a)},function(){V.N({keyCode:c.r})});var Ia=document.getElementById("o"),ha=Ia.getBoundingClientRect(),hb=[100,100],Za=!1,Ja,ib=function(a){a.preventDefault();Ja=a.changedTouches;ha=Ia.getBoundingClientRect();Za=!0};E(Ia,"touchstart",ib);E(Ia,"touchmove",ib);E(Ia,"touchend",function(a){a.preventDefault();Za=!1});Ya("p",function(){V.M({keyCode:f.state!==y.e?c.P:c.r})},function(){V.N({keyCode:f.state!==y.e?c.P:c.r})});ga("a",c.k);ga("l",c.t);ga("u",c.R);ga("r",c.u);ga("d",c.ca);ga("g",c.l);ga("c",
c.f);ga("t",c.j);ga("n",c.m)}(function t(c){Ba(c);Q=c;if(Za&&Ja){for(var h,n,e=0;e<Ja.length;e++)if(n=Ja[e],n.clientX>=ha.left&&n.clientX<ha.left+ha.width&&n.clientY>=ha.top&&n.clientY<ha.top+ha.height){h=Ja[e];break}if(h){h=[h.clientX-ha.left,h.clientY-ha.top];n=U(hb,h);var e=Math.sqrt(ka(hb,h))/12.5,g;f.state===y.i?g=a:f.state===y.g&&(g=r);g&&(g[0]+=(f.state===y.g?Math.round(Math.cos(n)):Math.cos(n))*(100>h[0]?-e:e),g[1]+=(f.state===y.g?Math.round(Math.sin(n)):Math.sin(n))*(100>h[0]?-e:e),g[0]=
Math.max(0,Math.min(g[0],R-1)),g[1]=Math.max(0,Math.min(g[1],S-1)));Wa&&Z()}}if(f.state===y.i){f.S=L.getBoundingClientRect();g=0;for(var m;g<=b.A;){if(fa(b.position[0]-8,b.position[1]+g,16,0,I.va)){m=b.position[1]+g-(b.position[1]+g)%C;break}g+=C}m?(b.position[1]=m,b.n&&(b.U=0,(m=ta())&&b.A>12-m.size&&la()),b.n=!1,b.A=0):fa(b.position[0]-16,b.position[1]-32,16,32,I.s)?b.n=!1:(b.A+=1,b.n=!0,b.position[1]+=b.A);void 0!==b.d&&(M[b.d].position[0]=b.position[0]+eb[0],M[b.d].position[1]=b.position[1]+eb[1]);
b.X<c&&0<b.W&&(b.W=0);for(m=0;m<na.length;m++)if(g=na[m],g.position[1]+=g.speed,sa(b.position,g.position))la(),na.splice(m,1),m--;else if(g.position[1]>S||fa(g.position[0],g.position[1],0,0,I.I))na.splice(m,1),m--;f.time<c&&Aa();a&&J&&(n=U(a,J),e=a[0]>J[0]?-1:1,m=Math.abs(a[0]-J[0]),g=Math.abs(a[1]-J[1]),3<m||3<g)&&(h=16*Math.cos(n)*e,n=16*Math.sin(n)*e,Math.abs(h)>m&&(h=m*h/Math.abs(h)),Math.abs(n)>g&&(n=g*n/Math.abs(n)),a[0]+=h,a[1]+=n);l=Math.pow(7*ja()+75,2)>=ka(a,b.position);d&&(m=fa(a[0],a[1],
0,0,I.C)?q:a,g=U(u,m),h=u[0]>m[0]?-1:1,3<Math.abs(m[0]-u[0])||3<Math.abs(m[1]-u[1]))&&(u[0]+=1*Math.cos(g)*h,u[1]+=1*Math.sin(g)*h);(Math.pow(7*ja()+25,2)>=ka(a,b.position)||ea(a[0],a[1],0,0,I.I)||d&&3>Math.sqrt(ka(u,a)))&&x<c&&(x=c+5E3,w(D.qa),A=0,z--,0>=z&&qa())}f.S=L.getBoundingClientRect();p.fillStyle="black";p.fillRect(0,0,R,S);for(m=0;m<ya;m++)for(g=0;g<Va;g++)La(va[ya*g+m],m*C,g*C);for(g=0;g<M.length;g++)g!==b.d&&(m=M[g],p.drawImage(m.ka,m.position[0]-8,m.position[1]-8));for(g=0;g<wa.length;g++)m=
wa[g],F(K.Da,m.position[0]-8,m.position[1]-8);for(g=0;g<na.length;g++)m=na[g],F(K.Ea,m.position[0]-8,m.position[1]-8);d&&F(K.l,d[0],d[1]);if(f.o[s.G])for(m=0;m<f.o[s.G].length;m++){g=p;var B=f.o[s.G][m][2];h=f.o[s.G][m][0];var E=f.o[s.G][m][1];n=g.fillColor;e=g.textAlign;g.fillStyle="black";for(B=B.slice();0<B.length;)g.fillText(B.shift(),h,E),E+=10;g.fillStyle=n;g.textAlign=e}f.state===y.i?b.n?T(K.H,b.position[0]-8,b.position[1]-24,0,b.v):b.a?T(K.H,b.position[0]-8,b.position[1]-24,10,b.v,c):T(K.H,
b.position[0]-8,b.position[1]-24,1,b.v):T(K.H,b.position[0]-8,b.position[1]-24,1);void 0!==b.d&&(m=M[b.d],p.drawImage(m.ka,b.v?m.position[0]+2:m.position[0]-15-m.size,m.position[1]-10));l&&(p.beginPath(),p.arc(b.position[0],b.position[1],7*ja()+25,0,360),p.lineWidth=2,p.strokeStyle="#f09",p.stroke());f.state===y.i?x>c&&0===Math.floor(c/100)%2||T(K.B,a[0]-8,a[1]-8,2,!1,c):T(K.B,a[0]-8,a[1]-8,0);d&&(p.fillStyle="red",p.fillRect(u[0]-1,u[1]-1,2,2),p.beginPath(),p.arc(u[0],u[1],5,0,360),p.lineWidth=2,
p.strokeStyle="red",p.stroke());f.state===y.i?(p.fillStyle="#00deff",p.fillText("BOY",10,396),p.fillStyle="red",p.fillText("CROW",600,12),p.fillStyle="white",p.fillText("SPEED: "+ja()+"   BOOST: "+Math.max(0,Math.ceil((b.X-c)/1E3))+"   TIME: "+Math.max(0,Math.ceil((f.time-c)/1E3))+"   CANDIES: "+b.J+"   CRATES: "+b.T,50,396),p.fillText("SHOTS: "+A+"   STUN: "+Math.max(0,Math.ceil((x-c)/1E3))+"   HEALTH: "+z,410,12)):f.state===y.g&&(p.fillStyle="white",p.fillText("< > CHANGE BLOCK   G: GRANNY   C: CRATES   T: TIME ("+
Levels[v][s.j]+")   N: NAME ("+Levels[v][s.m]+")"+(P?"   1: PAINT   2: TOGGLE PAINT":""),12,12));f.state===y.e&&p.drawImage(Qa,0,0);f.state===y.g&&(p.globalAlpha=0.6,G<xa?(La(""+G,r[0]-r[0]%C,r[1]-r[1]%C),p.strokeStyle="#000",p.strokeRect(r[0]-r[0]%C,r[1]-r[1]%C,C,C)):G===oa.ta?T(K.H,r[0]-8,r[1]-24,1):G===oa.B?T(K.B,r[0]-8,r[1]-8,0):G===oa.l?F(K.l,r[0],r[1]):G===oa.f&&(p.fillStyle="yellow",p.fillRect(r[0]-8,r[1]-8,16,16),p.fillStyle="#000",p.fillText("C",r[0]-4,r[1]+4)),p.globalAlpha=1);window.requestAnimationFrame(t)})()})();

/* 1.3.1 http://github.com/4lbertoC/mirrordelivery */var oa={};
(function(b){function y(b,k){return k?c(b&255)+y(b>>8,k-1):""}var n=this.xa=b||44100,s=2*n,c=String.fromCharCode,k;this.Pa=function(b){var Q=Audio,h=btoa,K="",R=b.length;for(m=0;m<R;m++)var c=32767*b[m]|0,c=-32768>c?-32768:32767<c?32767:c,c=c+(0>c?65536:0),K=K+String.fromCharCode(c&255,c>>8);b=K;b=["RIFF",36+(k=b.length),"WAVEfmt ",16,1,1,n,s,2,16,"data",k,b];K="";for(m=0;m<b.length;m++)K+="s"=="s4s4224422s4s"[m]?b[m]:y(b[m],"s4s4224422s4s".charCodeAt(m)-48);return new Q("data:audio/wav;base64,"+h(K))};
var B,m,D=Math.sin,h=2*Math.PI;this.filter=function(b,k,c,n,h,y,s,v,D,T){c=c?c:1;n=n?n:b.length;B=b.slice(0);for(m=c;m<n;m++)B[m]=k(b,B,c,n,m,h,y,s,v,D,T);return B};this.filters={Wa:function(b,c,k,n,h,m){return c[h-1]+m*(b[h]-c[h-1])},Xa:function(b,c,k,n,h,m){return c[h-1]+m*(n-h)/(n-k)*(b[h]-c[h-1])},Va:function(b,c,k,n,h,m){return m*(c[h-1]+b[h]-b[h-1])}};this.za=function(b,c,k,y,s,v,B,D,ja){c=c*h/n;var T=Array(b|0);for(m=0;m<b;m++)T[m]=k(m*c,y,s,v,B,D,ja);return T};var v=0;this.N={Qa:function(b){4>
b%h&&(v=2*Math.random()-1);return v},Ya:Math.random,Sa:Math.sin,Ta:function(b){return D(b)+0.5*D(b/2)+0.3*D(b/4)},Ra:function(b){return 2*(b/h-(b/h+0.5|0))},Ca:function(b,c){return D(b)>c?1:D(b)<c?-1:c}}}).apply(oa);var Ka={};
(function(){this.ea=[];this.ba={square:oa.N.Ca,saw:oa.N.Ra,sine:oa.N.Sa,noise:oa.N.Qa,synth:oa.N.Ta};this.La=function(){var b=[],y;for(y in this.ba)b.push(y);return b};this.Ma=function(){function b(b,k,s,m,D){void 0===D&&(D=(s-k)/1E3);b={name:b,id:b.replace(/ /g,""),min:k,max:s,step:D,Ka:m,type:"range",group:n};y.push(b)}var y=[],n=0,s=this.La();(function(b,k,s){b={name:b,id:b.replace(/ /g,""),options:k,Ka:s,type:"option",group:n};y.push(b)})("Generator",s,s[0]);b("SuperSamplingQuality",0,16,0,1);
b("MasterVolume",0,1,0.4);n++;b("AttackTime",0,1,0.1);b("SustainTime",0,2,0.3);b("SustainPunch",0,3,2);b("DecayTime",0,2,1);n++;b("MinFrequency",20,2400,0,1);b("StartFrequency",20,2400,440,1);b("MaxFrequency",20,2400,2E3,1);b("Slide",-1,1,0);b("DeltaSlide",-1,1,0);n++;b("VibratoDepth",0,1,0);b("VibratoFrequency",0.01,48,8);b("VibratoDepth Slide",-0.3,1,0);b("VibratoFrequencySlide",-1,1,0);n++;b("ChangeAmount",-1,1,0);b("ChangeSpeed",0,1,0.1);n++;b("SquareDuty",0,0.5,0);b("SquareDutySweep",-1,1,0);
n++;b("RepeatSpeed",0,0.8,0);n++;b("PhaserOffset",-1,1,0);b("PhaserSweep",-1,1,0);n++;b("LPFilterCutoff",0,1,1);b("LPFilterCutoffSweep",-1,1,0);b("LPFilterResonance",0,1,0);b("HPFilterCutoff",0,1,0);b("HPFilterCutoffSweep",-1,1,0);return y};this.za=function(b){var y=2*Math.PI,n=Math.sin,s=Math.pow,c=Math.abs,k=oa.xa,B=b.SuperSamplingQuality|0;1>B&&(B=1);for(var k=k*B,m=[{M:0,Y:1,time:b.AttackTime},{M:1+b.SustainPunch,Y:1,time:b.SustainTime},{M:1,Y:0,time:b.DecayTime}],D=m.length,h=0;h<D;h++)m[h].X=
1+(m[h].time*k|0);for(var v=void 0,I=0,Q=-1,Ea=0,K=-1,R=0,h=0;h<D;h++)R+=m[h].X;R<k/2&&(R=k/2);var Fa=Array(R/B|0),G=0,pa=0,ja=Ka.ba[b.Generator];void 0===ja&&(ja=this.ba.Ca);var T=0,T=b.SquareDuty,Sa=b.SquareDutySweep/k,fa=0,V=b.StartFrequency*y/k,ca=1+64*s(b.Slide,3)/k,Y=s(b.DeltaSlide,3)/(1E3*k);void 0!==B&&(Y/=B);b.MinFrequency>b.StartFrequency&&(b.MinFrequency=b.StartFrequency);b.MaxFrequency<b.StartFrequency&&(b.MaxFrequency=b.StartFrequency);for(var xa=b.MinFrequency*y/k,ka=b.MaxFrequency*
y/k,Ga=0,La=b.VibratoFrequency*y/k,aa=b.VibratoDepth,qa=1+3*s(b.VibratoFrequencySlide,3)/k,ya=b.VibratoDepthSlide/k,ga=0,Ha=b.ChangeSpeed*k,la=s(b.ChangeAmount,2),la=0<b.ChangeAmount?1+10*la:1-0.9*la,za=Array(1024),h=0;1024>h;h++)za[h]=0;var Aa=0,da=1020*s(b.PhaserOffset,2),ma=4E3*s(b.PhaserSweep,3)/k,L=1E-5<c(ma)||1E-5<c(da),N=0.0010<b.HPFilterCutoff||0.999>b.LPFilterCutoff,t=0,U=0,ha=s(b.LPFilterCutoff,3)/10,J=1+b.HPFilterCutoffSweep/1E4,Z=5/(1+20*s(b.LPFilterResonance,2))*(0.01+b.LPFilterCutoff);
0.8<Z&&(Z=0.8);var Z=1-Z,Ta=0.999>b.LPFilterCutoff,ra=0,E=s(b.HPFilterCutoff,2)/10,z=1+b.HPFilterCutoffSweep/1E4,Ba=0,u=R;0<b.RepeatSpeed&&(u=s(1-b.RepeatSpeed,2)*k+32);for(var Ua=b.MasterVolume,Ma=0,h=0;h<R;h++)G=ja(fa,T,0),T+=Sa,0>T?T=0:0.5<T&&(T=0.5),Ba>u&&(fa=0,V=b.StartFrequency*y/k,ca=1+3*s(b.Slide,3)/k,Y=s(b.DeltaSlide,3)/(1E3*k),void 0!==B&&(Y/=B),ga=0,Ha=b.ChangeSpeed*k,la=1+(b.ChangeAmount|0)/12,Ba=0),Ba+=1,fa+=V,ca+=Y,V*=ca,ga>Ha&&(V*=la,Ha=R),ga+=1,V>ka?V=ka:V<xa&&(V=xa),Ga+=La,v=V*n(Ga)*
aa,fa+=v,La*=qa,ya&&(aa+=ya,0>aa?ya=aa=0:1<aa&&(aa=1,ya=0)),N&&(0.0010<c(E)&&(E*=z,1E-5>E?E=1E-5:0.1<E&&(E=0.1)),v=t,ha*=J,0>ha?ha=0:0.1<ha&&(ha=0.1),Ta?(U+=(G-t)*ha,U*=Z):(t=G,U=0),t+=U,ra+=t-v,G=ra*=1-E),L&&(da+=ma,0>da&&(da=-da,ma=-ma),1023<da&&(da=1023,ma=0),za[Aa]=G,G+=za[Aa-(da|0)+1024&1023],Aa=Aa+1&1023),h>K&&(Q+=1,v=Q<D?m[Q]:{M:0,Y:0,X:R},I=v.M,Ea=(v.Y-v.M)/(v.X+1),K+=v.X),G*=I,I+=Ea,G*=Ua,1<B?(pa+=G,0===(h+1)%B&&(Fa[Ma]=pa/B,Ma+=1,pa=0)):Fa[h]=G;b=k/100|0;y=Array(b);for(h=0;h<b;h++)y[h]=
0;return y.concat(Fa).concat(y)};this.ea=this.Ma()}).apply(Ka);var eb={};(function(){this.ya=function(b){b=Ka.za(this.Ja(b));return oa.Pa(b)};this.Ja=function(b){for(var y={},n=Ka.ea.length,s=0;s<n;s++)y[Ka.ea[s].id]=b[s];return y}}).apply(eb);(function(){var b,y,n,s;function c(f,a,b){f.addEventListener?f.addEventListener(a,b,!1):f.attachEvent?f.attachEvent("on"+a,b):f["on"+a]=b}function k(f,a,b,O,e,c){var d=Z[f].frame,k=Z[f].g;f=Z[f].frames;O=c?f[Math.floor(c*O/1E3)%f.length]:f[O];e?p.drawImage(Va,lb-(d.x+O.x)-O.a,d.y+O.y,O.a,O.b,a+k.x,b+k.y,O.a,O.b):p.drawImage(sa,d.x+O.x,d.y+O.y,O.a,O.b,a+k.x,b+k.y,O.a,O.b)}function B(f,a,b,O,e){var d=Z[f].frame;f=Z[f].g;p.drawImage(sa,d.x,d.y,O||d.a,e||d.b,a+f.x,b+f.y,f.a,f.b)}function m(f){var a=f.clientX-
d.W.left;f=f.clientY-d.W.top;a=Math.max(0,Math.min(a,L-1));f=Math.max(0,Math.min(f,N-1));return[a,f]}function D(f,a,b,e,d,c,k){var h=f.fillColor,n=f.textAlign,p=f.font;f.fillStyle=d;f.font=k;f.textAlign=c;for(a=a.slice();0<a.length;)f.fillText(a.shift(),b,e),e+=10;f.fillStyle=h;f.textAlign=n;f.font=p;f.textAlign=n}function h(f){ea.style.cursor=f?"auto":"none"}function v(f,a){if(ra)try{Na[f]=eb.ya(a)}catch(b){}}function I(f){if(ra)try{Na[f]&&(Na[f].pause(),Na[f].currentTime=0,Na[f].play())}catch(a){}}
function Q(f,a){var b=document.getElementById(f);c(b,Oa,function(){X.Q({keyCode:a})});c(b,Wa,function(){X.R({keyCode:a})})}function Ea(f,a,b){f=document.getElementById(f);c(f,Oa,a);c(f,Wa,b)}function K(f,a,b,e){var d=Object.create(xb);d.position=a;d.text=[f];d.color=b;d.time=ta+Ma;d.Aa=e||!1;Pa.push(d)}function R(f,a,b,e,d){var c=Object.create(yb);c.position=f;c.e=a;c.color=b;c.time=ta+zb;c.size=e;c.speed=d;Qa.push(c)}function Fa(f){var a=f[r.Z],b,e,d,c;Xa.T=a;for(var k=P.length=0;k<f[r.l].length;k++)b=
f[r.l][k],e=Object.create(Xa),e.size=b,d=document.createElement("canvas"),d.width=Ia+b,d.height=Ia+b,c=d.getContext("2d"),c.fillStyle="#ea0",c.strokeStyle="#330",c.fillRect(0,0,Ia+b,Ia+b),c.strokeRect(0,0,Ia+b,Ia+b),c.fillStyle="#000",c.fillText(b,5,10),e.ha=d,d=a[0]+16*k,b=a[1]-b,e.position=[d,b],e.T=[d,b],P.push(e)}function G(f){f=d.n=A[f]||A[w];a.position=f[r.da].slice();a.p=0;a.ia=0;a.c=void 0;a.L=mb;a.r=!1;a.B=!1;a.s=!1;a.d=!1;a.q=!1;e.O=nb;e.h=0;e.C=0;e.position=f[r.U].slice();e.e=f[r.U].slice();
b=f[r.F].slice();y=[f[r.F][0]+15,f[r.F][1]+23];n=y.slice();s=1;M.position=M.e=null;d.time=0;pa(u.i);S=0;ia="4444444444444444444444444444444444444444"+f[r.ca]+"4444444444444444444444444444444444444444";ia=ia.split("");Ja=null;Fa(f);Ca.length=0;ua.length=0;Pa.length=0;Qa.length=0;F.clearRect(0,0,L,N);F.fillStyle="rgba(0,0,0,0.7)";F.fillRect(0,0,L,N);F.fillStyle="#fff";F.textAlign="center";F.fillText("A 13kB game by Alberto Congiu",L/2,12);F.font="20px courier";F.fillText(d.n[r.I],L/2,N/2-50);D(F,["Luke "+
d.fa],L/2-50,N/2,!0===Ya?"#0f0":"#fff","right");D(F,[d.ga+" Crow"],L/2+50,N/2,!1===Ya?"#0f0":"#fff","left");D(F,["|"],L/2,N/2,"#fff","center");F.font="15px courier";F.fillText("Click the "+(ba?"screen":"crow")+" to start",L/2,N/2+60);F.fillText("< >: Select level",L/2,N/2+100);F.fillText(f[r.V]?"E: EDIT   "+(ba?"S":"D")+": DELETE   "+(ba?"A":"J")+": EXPORT   I: IMPORT":"E: EDIT   I: IMPORT",L/2,N/2+120);F.beginPath();F.arc(e.position[0],e.position[1],16,0,360);F.lineWidth=2;F.strokeStyle="#fff";F.stroke();
Za=E.slice();window.localStorage&&(window.localStorage.sa=JSON.stringify(A))}function pa(f){d.state=f;if(ba){var a=document.getElementsByClassName("edit");f="btn edit"+(f===u.f?"":" h");for(var b=0;b<a.length;b++)a[b].setAttribute("class",f)}}function ja(a){pa(u.j);d.time=ta+d.n[r.K];ra&&($a=a+Ba);h()}function T(a){d.fa+=1;h(!0);I(z.wa);Ya=!0;G(w);fb=a+ob}function Sa(a){d.ga+=1;h(!0);I(z.oa);Ya=!1;G(w);fb=a+ob}function fa(a,b){return Math.round(a[0]/t)===Math.round(b[0]/t)&&Math.round(a[1]/t)===Math.round(b[1]/
t)}function V(a,b){return Math.atan((b[1]-a[1])/(b[0]-a[0]))}function ca(a,b){return a&&b&&Math.sqrt(Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2))}function Y(a,b){return ia[U*Math.floor(b/t)+Math.floor(a/t)]}function xa(a,b,d,e,c){var k=b,h=Y(a,k);d=a+d;topRight=Y(d,k);bottomRight=Y(d,b+e);bottomLeft=Y(a,b);return h===c||topRight===c||bottomRight===c||bottomLeft===c}function ka(a,b,d,e,c){b+=e;e=Y(a,b);bottomLeft=Y(a+d,b);return e===c||bottomLeft===c}function Ga(){h(!0);d.state===u.f&&(A[w][r.ca]=
ia.join("").substring(U,U*ha-U),A[w][r.da]=a.position.slice(),A[w][r.U]=e.position.slice(),A[w][r.F]=b.slice(),A[w][r.Z]=Xa.T.slice());G(w)}function La(){var b=a.w,d=aa();if(a.d)b=a.w;else if(a.s)b=Math.min(d,b+d/25);else if(b*=Math.min(0.2*d,0.8),0.2>b||qa(H.m))b=0;a.w=b;if(a.S&&!a.d)for(var e=2*d;0<e--;)R(a.position.slice(),[a.position[0]-Math.floor(64*Math.random()-32),a.position[1]-Math.ceil(20*Math.random()-5)],"#04f",Math.ceil(2*Math.random()),Math.ceil(5*Math.random()));return qa(H.m)?d/2:
b}function aa(){return Math.max(1,a.speed+a.S-(void 0!==a.c?P[a.c].size:0))}function qa(b){return xa(a.position[0]-8,a.position[1]-32,16,32,b)||xa(a.position[0],a.position[1]-8,0,0,b)}function ya(a){a.preventDefault();if(d.state===u.f)gb=!gb;else if(d.state===u.j&&e.C<ta){a=m(a);var b=e.h;if((ka(e.position[0]-8,e.position[1]-8,16,16,H.u)||xa(e.position[0],e.position[1],0,0,H.u))&&e.h<Ab)I(z.aa),e.h++,K("+"+(e.h-b)+"\u21a1",[e.position[0]-4,e.position[1]-4],"#0c0");else{var c;for(c=0;c<Ca.length;c++)if(fa(a,
Ca[c].position)){e.h=Math.max(e.h,Bb);K("+"+(e.h-b)+"\u21a1",[e.position[0]-4,e.position[1]-4],"#0c0");I(z.aa);Ca.splice(c,1);break}}}}function ga(){if(d.state===u.f)if(S<Da){var f=U*Math.floor(x[1]/t)+Math.floor(x[0]/t);f<ia.length&&(ia[f]=""+S)}else if(S===va.ta)a.position=x.slice();else if(S===va.t)e.position=x.slice();else if(S===va.D)b=x.slice(),y=[b[0]+15,b[1]+23],n=y.slice();else{if(S===va.l)for(Xa.T=x.slice(),f=0;f<P.length;f++){var c=P[f];c.position[0]=x[0]+16*f;c.position[1]=x[1]-c.size}}else d.state!==
u.i||ba?0<e.h&&e.C<ta&&(e.h--,I(z.na),f=Object.create(Cb),f.position=e.position.slice(),ua.push(f)):x[0]>e.position[0]-16&&(x[0]<e.position[0]+16&&x[1]>e.position[1]-16&&x[1]<e.position[1]+16)&&ja(ta)}function Ha(a){for(var b=60;0<b--;)R(e.position.slice(),[e.position[0]-Math.floor(128*Math.random()-64),e.position[1]+Math.ceil(128*Math.random()-64)],"#000",Math.ceil(3*Math.random()),Math.ceil(2*Math.random()));e.C=a+Db;I(z.qa);e.h=0;e.O--;K("-1\u2665",[e.position[0]-4,e.position[1]-4],"#c00");0>=
e.O?T(a):e.O<pb&&la(a);hb=a+Ua}function la(a){if(!Ja){Ja=[];for(var b=0;b<ia.length;b++)ia[b]===H.v&&Ja.push(b);I(z.ka)}b=Ja[Math.floor(Math.random()*Ja.length)]+1;b=[b%U*t,Math.floor(b/U)*t];M.e=[b[0]-6,b[1]-10];M.position?I(z.la):(M.position=M.e.slice(),K("meow...",[M.position[0],M.position[1]-4],"#ccc",!0));M.Ba=a+Eb;s+=0.05}function za(f,d){for(var c=60;0<c--;)R(a.position.slice(),[a.position[0]-Math.floor(128*Math.random()-64),a.position[1]-16-Math.ceil(128*Math.random()-64)],"#ea0",Math.ceil(3*
Math.random()),Math.ceil(4*Math.random()));K(0.5<Math.random()?"Be careful!":"My mirrors!",[b[0]+4,b[1]],"#ccc",!0);I(z.ua);a.c=void 0;f.position=f.T.slice();a.L--;K("-1\u25fc",[a.position[0]-4,a.position[1]-32],"#c00");hb=d+Ua;0>=a.L?Sa(d):a.L<pb&&la(d)}function Aa(b){var a=b||A[w];b=[b?a[r.I]:"CustomLevel"+Fb++,a[r.da].slice(),a[r.U].slice(),a[r.Z].slice(),a[r.F].slice(),a[r.K],a[r.ca],a[r.l].slice(),null,!0];A.push(b);d.state===u.i&&(w=A.length-1,G(w))}function da(a,b,d){var c=null,e=M.position?
"#c29":"#00deff";a===H.v?c=J.v:a===H.J?c=J.J:a===H.Ia?e="#000":a===H.pa?e="#0f0":a===H.u?c=J.u:a===H.m?c=J.m:a===H.o&&(c=J.o);p.fillStyle=e;p.fillRect(b,d,t,t);null!==c&&B(c,b,d,t,t)}function ma(a,b){if(a.position&&a.e){var d=V(a.position,a.e),c=a.position[0]>a.e[0]?-1:1,e=Math.abs(a.position[0]-a.e[0]),k=Math.abs(a.position[1]-a.e[1]);if(3<e||3<k){var h=Math.cos(d)*c*b,d=Math.sin(d)*c*b;Math.abs(h)>e&&(h=e*h/Math.abs(h));Math.abs(d)>k&&(d=k*d/Math.abs(d));a.position[0]+=h;a.position[1]+=d;return!0}return!1}}
var L=640,N=400,t=16,U=L/t,ha=N/t,J={t:0,Ga:1,o:2,D:3,m:4,H:5,u:6,J:7,Ha:8,v:9,Da:10,Ea:11},Z=[{frame:{x:30,y:0,a:30,b:14},g:{x:1,y:1,a:30,b:14},frames:[{x:1,y:1,a:15,b:11},{x:17,y:1,a:15,b:13}]},{frame:{x:14,y:40,a:14,b:8},g:{x:1,y:7,a:14,b:8}},{frame:{x:32,y:14,a:16,b:16},g:{x:0,y:0,a:16,b:16}},{frame:{x:0,y:24,a:14,b:24},g:{x:1,y:7,a:14,b:24}},{frame:{x:16,y:48,a:16,b:16},g:{x:0,y:0,a:16,b:16}},{frame:{x:0,y:0,a:30,b:24},g:{x:1,y:3,a:30,b:24},frames:[{x:0,y:0,a:15,b:24},{x:16,y:0,a:13,b:24}]},
{frame:{x:48,y:14,a:16,b:10},g:{x:0,y:10,a:16,b:10}},{frame:{x:14,y:24,a:16,b:16},g:{x:0,y:0,a:16,b:16}},{frame:{x:31,y:32,a:6,b:14},g:{x:4,y:1,a:6,b:14}},{frame:{x:0,y:48,a:16,b:16},g:{x:0,y:0,a:16,b:16}},{frame:{x:36,y:32,a:11,b:13},g:{x:0,y:0,a:12,b:13}},{frame:{x:49,y:25,a:15,b:16},g:{x:0,y:0,a:15,b:16}}],Ta=[523.25,587.33,659.26,698.46,783.99,880,987.77,1046.5,1108.73],ra=!(!window.btoa||!window.atob),E="023123467".split(""),z={ra:0,ua:1,na:2,Fa:3,$:4,ma:5,wa:6,oa:7,ja:8,aa:9,o:10,qa:11,ka:12,
la:13,va:14},Ba=200,u={i:0,j:1,f:2},Ua=500,Ma=1500,zb=1500,ob=2E3,H={EMPTY:"0",v:"1",m:"2",J:"3",Ia:"4",pa:"5",u:"6",o:"7"},Da=8,va={ta:Da+0,t:Da+1,D:Da+2,l:Da+3},ib=Da+4,Ab=3,Bb=5,Db=5E3,nb=10,pb=4,Eb=2E3,mb=10,Ia=12,qb=[1,-6],r={I:0,da:1,U:2,Z:3,F:4,K:5,ca:6,l:7,G:8,V:9},ea=document.getElementById("C"),p=ea.getContext("2d"),sa=new Image,Va=document.createElement("canvas"),lb=0,ab=document.createElement("canvas"),F=ab.getContext("2d"),Na=[],rb={},Za=null,$a=0,x=null,bb=!1,$=!1,X={P:{},R:function(a){X.P[a.keyCode]=
void 0},Q:function(a){X.P[a.keyCode]=ta}},ba=!1,Ra=document.getElementById("o"),na=Ra.getBoundingClientRect(),sb=[100,100],jb=!1,wa=null,Oa=null,Wa=null,tb=null,ta=0,d={state:u.i,W:ea.getBoundingClientRect(),time:0,fa:0,ga:0,n:null},hb=0,fb=0,Ya=void 0,xb={position:null,text:void 0,color:"#0f0",time:0,Aa:!1},Pa=[],ia=[],Ja=null,S=0,gb=!1,a={position:null,speed:4,w:0,S:0,ia:0,Oa:2,Na:-6.8,A:!1,B:!1,d:!1,s:!1,r:!1,k:0,c:void 0,p:0,L:mb,Ua:!1},e={position:null,e:null,h:0,C:0,O:nb};n=y=b=null;s=1;var M=
{position:null,e:null,Ba:0},Xa={ha:null,size:1,position:null,T:[0,0]},P=[],Gb={position:null},Ca=[],Cb={position:null,speed:6},ua=[],yb={position:null,e:null,color:"#000",size:2,time:0,speed:2},Qa=[],ub=[["Tutorial",[33,370],[L-24,55],[300,365],[20,70],3E6,"00000000000000000000000000000000000000000000000000000000000000000000000000000000330000000000000000000000000000000000006000000000000000000000000000000000000000110000000000033300000000000006000000000000110000000003330000000000001110000000000000000000000333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003333333333333333333333333333333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005500000000000000000000000000000000000000550000000000007000000000000002000000000111111111111111111111111111111200000000000000000000000000000000000000020000000000000000000000000000000000000002000000000000000000000000000000000000000200000000000000000000000000000000000000020000000001111111111111111111111111111111111111111",
[1],[[20,340,["PLAYER 1"]],[100,340,["ARROWS: move/jump"]],[250,340,[(ba?"I":"SPACEBAR")+": grab/release crate"]],[500,340,["UP/DOWN: Climb"]],[450,250,["Crates break if you fall from too high"]],[160,250,[(ba?"I":"SPACEBAR")+": buy candies when not holding crate","E: Use candy to gain speed"]],[10,230,["Deliver crate to green area"]],[560,30,["PLAYER 2",(ba?"analogPad":"Mouse")+": move"]],[390,80,["Hide from granny in nest"]],[390,130,[(ba?"A":"RClick")+": eat from nest or crumbs",(ba?"S":"LClick")+
": shoot!"]],[150,70,["Don't touch roofs or Luke"]]]],["Level 1",[25,366],[616,24],[41,364],[513,180],6E4,"00000000000000000000000000000000000000600000000000000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000111000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000003330000000000000000000000000000000000003333300033000000000000000000000000000000000000000000000000000000000006000000000000550000020000000000000200001110000000000055020002000111111111120000333000000000111112000200133333330002000000000000000000000200021130000000000200000000000000000000020002000000000000020000000000000000000002000200020000000002111111100111001101111100111112000000000200000000000000000000000033333200000000000000000000000000000000000000020000000000000000000000000000000000000002000000000000000000000000000000000000000200000000000000000000000000000000001111111111111111111111111111111111111111",
[1,2]],["Level 2",[28,143],[600,296],[588,365],[51,50],12E4,"33330000000000000000000000000000000000000000000000000033000000000330000000000000055000000000000000000000000000000000000005500000000000000003030000000000000000001111111000000000000030000000000000110010000000010000000000000000000000000100301000000000000200000200000200000200000000100000000011120111102000201111021113002010111100000002000000020200000002000000211100000000000100000000200000000100000020000000000000000000000000000000000002002000000000000000000000000000000000030211100000001110000000000000000000000030020000000000000000000000003333300000000002000000000000000000000000000000000003020200000000000001100000000000000000000002110000000000000000000000000020700000020200000000000600000000000000112110000002020000060000111000010000000000200000000201000011100000000000000000000020000000020000000000000000000000000000002000000002000000000000000000000000000000200000000200000000001111111111111111111111111111111111111111",
[1,2]],["Level 3",[17,349],[281,39],[96,316],[49,163],24E4,"00000000000000010001000000000000000000000000000000300001666100003000000000000020000000000003000111110003000000000007002000000000000030000000003000000000001110203000000000000000000000000000000000000020332200000000000000000000000000000000002033202000000000000000000000000000000000203320320000000000222000000000000000000020332033111001111100011111000110011001102055200000000000000000000000000110011000205520000000000000000000000000000000000020111100000000000000000000000000000000002000000000000000030003000000000220022000200000000000000030000030000200000000000020000000000000000300030000020000000000002000003030300000000200000002011001100110200003030303030303020000000200011001100020000000000030303032111111000000000000000000000000000000000203030303030000000000000000011100070000023030303030300000000000000000000011100002000000000000000000000011110000000000000200000000000000000000001111111111111111111111111111111111111111",
[1,2]],["Level 4",[75,370],[L-24,24],[83,365],[80,53],3E5,"33333300000000000000000000000000000000600000000000000000000000000000000000000011055000000000000000000000003333000000000005500000000000000002000000000000000000001111110010011001111211110011110000000000000000000003300000000000000000100000000000000000000000000700000000000001000000000001110000000000111111000000000010020000002000000000000033333330000333330112100000200033333300000000000000000000000200000020000000000000000000000000000000020000002000000000000010101010111000020200000000211111111111111000000033311001111011100020033333333330000000000003300000033333002000000000000000000000000000000000000000200000000000000000200000000000020000000020111100111110011121111001111112011111002000000000000000000000000303030200000000000000000000000000007000000000020000000000333330003030300011110000200002000000000000000000000000000000000021111200000000000000000000000000000000002000000000001111111111111111111111111111111111111111",
[1,2,3]]],A=window.localStorage&&window.localStorage.sa&&JSON.parse(window.localStorage.sa)||ub,Fb=A.length-ub.length+1,w=0;(function(){for(var a=0,b=["webkit","moz"],d=0;d<b.length&&!window.requestAnimationFrame;++d)window.requestAnimationFrame=window[b[d]+"RequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var d=(new Date).getTime(),c=Math.max(0,16-(d-a)),e=window.setTimeout(function(){b(d+c)},c);a=d+c;return e})})();if("ontouchstart"in document.documentElement||
window.navigator.msMaxTouchPoints)for(var ba=!0,Oa=window.navigator.msMaxTouchPoints?"MSPointerDown":"touchstart",Wa=window.navigator.msMaxTouchPoints?"MSPointerUp":"touchend",tb=window.navigator.msMaxTouchPoints?"MSPointerMove":"touchmove",kb=document.getElementsByClassName("btn"),cb=0;cb<kb.length;cb++)-1===kb[cb].getAttribute("class").indexOf("edit")&&kb[cb].setAttribute("class","btn");sa.onload=function(){Va.width=lb=sa.naturalWidth;Va.height=sa.naturalHeight;var a=Va.getContext("2d");a.translate(sa.naturalWidth,
0);a.scale(-1,1);a.drawImage(sa,0,0)};sa.src="imgmap.png";ab.width=L;ab.height=N;for(var db=0;db<Ta.length;db++)rb[db]=eb.ya(["synth",0,0.1,0,0.208,0,0.12,20,Ta[db],2400,0,0,0,0.01,3E-4,0,0,0,0,0,0,0,0,1,0,0,0.1,0]);Za=E.slice();v(z.ra,["square",0,0.3,0,0.174,0,0.28,20,497,2400,0.22,0,0,0.01,3E-4,0,0,0,0.0665,0,0,0,0,0.783,0,0,0,0]);v(z.ua,["noise",0,0.3,0,0.14,0.405,0.116,20,479,2400,-0.07,0,0,0.01,3E-4,0,0,0,0,0,0,-0.086,-0.122,1,0,0,0,0]);v(z.ma,["square",0,0.3,0,0.098,0.504,0.282,20,1582,2400,
0,0,0,0.01,3E-4,0,0,0,0,0,0,0,0,1,0,0,0,0]);v(z.ja,["saw",0,0.3,0,0.324,0,0.284,20,631,2400,0.172,0,0.498,19.35,3E-4,0,0,0,0,0,0,0,0,1,0,0,0,0]);v(z.na,["saw",0,0.3,0,0.212,0,0.028,20,1169,2400,-0.52,0,0,0.01,3E-4,0,0,0,0.5,-0.592,0,0.094,0.066,1,0,0,0.28,0]);v(z.oa,["synth",0,0.3,0,0.32,0.348,0.44,20,372,417,0,0,0,0.01,3E-4,0,0.374,0.264,0,0,0,0,0,1,0,0,0,0]);v(z.wa,["synth",0,0.3,0,0.13,0.345,0.41,253,1168,1407,-0.0060,-0.082,0,0.01,3E-4,0,0.206,0.166,0,0,0,0,0,1,0,0,0,0]);v(z.$,["noise",0,0.3,
0,0.0020,0.024,0.09,20,372,2400,0,0,0,0.01,3E-4,0,-0.342,0.809,0,0,0,0,0,1,0,0,0,0]);v(z.Fa,["noise",0,0.3,0,0.152,0.393,0.274,20,839,2400,-0.31,0,0,0.01,3E-4,0,-0.34,0.783,0,0,0.6096,0.526,-0.0080,1,0,0,0,0]);v(z.aa,["square",0,0.3,0,0.04,0,0.048,20,578,2400,0.104,0,0.683,19.158,3E-4,0,0,0,0.385,0,0,0,0,1,0,0,0,0]);v(z.o,["square",0,0.3,0,0.046,0.477,0.24,20,1197,2400,0,0,0,0.01,3E-4,0,0.498,0.204,0,0,0,0,0,1,0,0,0,0]);v(z.qa,["noise",0,0.3,0,0.108,0.336,0.124,20,462,2400,0,0,0,0.01,3E-4,0,0,0,0,
0,0,0,0,1,0,0,0,0]);v(z.ka,["synth",0,0.3,0,0.44,0.579,1.004,20,1793,2400,-0.202,0,0,8.6962,0.5346,0.666,-0.298,0.671,0,0,0,0,0,1,0,0,0,0]);v(z.la,["noise",0,0.127,0.043,0.124,0,0.282,20,2400,20,1,-1,0,0.01,-0.3,-1,0.956,0.272,0,0.68,0,-0.998,-1,1,1,0,0,-0.998]);v(z.va,["noise",0,0.126,0,0.07,0,0.232,2400,2400,2400,-1,-1,0,0.01,-0.3,-1,-1,0,0,-1,0,0.0040,0,1,1,0,0,-1]);window.addEventListener("keyup",X.R,!1);window.addEventListener("keydown",X.Q,!1);if(ba){c(ea,Oa,function(){d.state===u.i&&ja()});
Ea("s",function(){d.state===u.i?X.Q({keyCode:68}):ga()},function(){X.R({keyCode:68})});Ea("a",function(a){d.state===u.i?X.Q({keyCode:74}):ya(a)},function(){X.R({keyCode:74})});Ea("i",function(){X.Q({keyCode:d.state===u.i?73:32})},function(){X.R({keyCode:d.state===u.i?73:32})});Q("x",27);Q("e",69);Q("l",37);Q("u",38);Q("r",39);Q("d",40);Q("c",67);Q("t",84);Q("n",78);var vb=function(a){a.preventDefault();wa=a.changedTouches||a;na=Ra.getBoundingClientRect();jb=!0};c(Ra,Oa,vb);c(Ra,tb,vb);c(Ra,Wa,function(a){a.preventDefault();
jb=!1});c(document.body,"contextmenu",function(a){a.preventDefault()})}else c(ea,"click",ga),c(ea,"contextmenu",ya),c(ea,"mousedown",function(a){1===a.which&&(bb=!0);d.state===u.f&&bb&&ga()}),c(ea,"mouseup",function(a){1===a.which&&(bb=!1)}),c(ea,"mousemove",function(a){var b=m(a);x=[b[0],b[1]];d.state===u.j?(a=m(a),e.e=a.slice()):d.state===u.f&&bb&&ga()});G(w);(function wb(c){var h=c;if(!(fb>h)){aa();var m=a.Oa,v=a.position[0],F=a.position[1],q=X.P;if(d.state===u.i)if(q[37]&&!$)w=(w+A.length-1)%
A.length,G(w);else if(q[39]&&!$)w=(w+1)%A.length,G(w);else if(q[69]&&!$)A[w][r.V]||Aa(),pa(u.f),q[69]=void 0;else if(q[68]&&!$)A[w][r.V]&&(A.splice(w,1),w--,G(w)),q[68]=void 0;else if(q[74]&&A[w][r.V]&&!$)m=prompt("Data",JSON.stringify(A[w])),q[74]=void 0;else{if(q[73]){if(m=prompt("Data"))try{Aa(JSON.parse(m))}catch(Q){alert("Error!")}q[73]=void 0}}else{if(d.state===u.f)if(q[37]&&!$)S=(S+ib-1)%ib;else if(q[39]&&!$)S=(S+1)%ib;else if(q[67]&&!$){try{var W=JSON.parse(prompt("Crates",JSON.stringify(A[w][r.l])));
if(W instanceof Array){for(m=0;m<W.length;m++)"number"===!typeof m&&alert("Error!"),W[m]=Math.max(1,Math.min(5,W[m]));A[w][r.l]=W;Fa(A[w])}}catch(Y){alert("Error!")}q[67]=void 0}else q[78]&&!$?((m=prompt("Name",A[w][r.I]))&&(A[w][r.I]=m),q[78]=!1):q[84]&&!$?(h=+prompt("Time",A[w][r.K]),!isNaN(h)&&0<h&&(A[w][r.K]=h),q[84]=!1):q[69]&&!$&&(Ga(),q[69]=void 0);else if(d.state===u.j){if(!q[32]||a.B||a.d||a.r)q[69]&&!a.r?(a.r=!0,0<a.p&&(a.p--,a.S=3,a.ia=h+5E3,W=Object.create(Gb),W.position=[a.position[0]+
4,a.position[1]-7],Ca.push(W),I(z.ja))):q[32]||(q[69]||!a.r)||(a.r=!1);else{a.r=!0;a:{var W=h,h=a.c,Z=void 0!==h?P[h]:void 0;if(void 0===Z){for(W=0;W<P.length;W++)if(fa(a.position,P[W].position)){a.c=W;I(z.$);break a}qa(H.o)&&3>a.p&&(K("+"+(3-a.p)+"\u00a7",[a.position[0]-4,a.position[1]-32],"#0c0"),a.p=3,I(z.o))}else if(a.c=void 0,I(z.$),qa(H.pa)&&void 0!==Z){P.splice(h,1);for(h=60;0<h--;)R(a.position.slice(),[a.position[0]-Math.floor(128*Math.random()-64),a.position[1]-16-Math.ceil(128*Math.random()-
64)],"#0c0",Math.ceil(4*Math.random()),Math.ceil(6*Math.random()));K(0.5<Math.random()?"Good boy!":"Thank you!",[b[0]+4,b[1]],"#ccc",!0);0>=P.length?T(W):I(z.ma)}}}q[38]?qa(H.m)?(a.position[1]=Math.min(N-t,F-m),a.A=!0):a.B||a.d||(a.k=a.Na,a.B=!0,a.d=!0,a.A=!1,I(z.ra)):!q[38]&&a.B?(a.B=!1,a.A=!1):q[40]&&qa(H.m)?(a.position[1]=Math.min(N,F+m),a.A=!0):a.A=!1;q[37]&&!a.d?(a.s=!0,a.q=!0):q[39]&&!a.d?(a.s=!0,a.q=!1):a.s=!1;if(a.s||0<a.w)a.position[0]=Math.min(L-t,Math.max(t,v+(a.q?-1:1)*La()))}q[27]&&Ga()}$=
!1;for(var E in X.P)$=$||!!X.P[E]}ta=c;try{$a<c&&d.state===u.j&&0<Za.length&&(rb[Za.shift()].play(),$a+=Ba)}catch(ja){}if(jb&&wa){var C;if(wa.clientX)C=wa;else if(wa instanceof TouchList)for(E=0;E<wa.length;E++)if(q=wa[E],q.clientX>=na.left&&q.clientX<na.left+na.width&&q.clientY>=na.top&&q.clientY<na.top+na.height){C=wa[E];break}if(C){C=[C.clientX-na.left,C.clientY-na.top];q=V(sb,C);E=ca(sb,C)/12.5;var l;d.state===u.j?l=e.position:d.state===u.f&&(l=x);l&&(l[0]+=(d.state===u.f?Math.round(Math.cos(q)):
Math.cos(q))*(100>C[0]?-E:E),l[1]+=(d.state===u.f?Math.round(Math.sin(q)):Math.sin(q))*(100>C[0]?-E:E),l[0]=Math.max(0,Math.min(l[0],L-1)),l[1]=Math.max(0,Math.min(l[1],N-1)));gb&&ga()}}if(d.state===u.j){d.W=ea.getBoundingClientRect();C=2;var g;l=0;if(!a.d&&ka(a.position[0]-4,a.position[1],8,0,H.v))g=a.position[1]-a.position[1]%t;else for(;C<=a.k;){if(ka(a.position[0]-4,a.position[1]+C,8,0,H.v)){g=a.position[1]+C-(a.position[1]+C)%t;break}C+=t}if(g){a.position[1]=g;a.d&&(a.w/=2,g=void 0!==a.c&&P[a.c])&&
(C=13-g.size,l=g.size,a.k>C&&za(g,c));a.d=!1;if(a.k>10-2*l){for(g=3*a.k;0<g--;)R(a.position.slice(),[a.position[0]-Math.floor(64*Math.random()-32),a.position[1]+Math.ceil(10*Math.random()-5)],"#dda",Math.ceil(2*Math.random()),Math.ceil(5*Math.random()));I(z.va)}a.k=0}else ka(a.position[0]-4,a.position[1]-32,8,16,H.m)?(a.d=!1,a.k=0):(a.k+=0.6,a.d=!0,a.position[1]+=a.k);void 0!==a.c&&(P[a.c].position[0]=a.position[0]+qb[0],P[a.c].position[1]=a.position[1]+qb[1]);a.ia<c&&0<a.S&&(a.S=0);for(g=0;g<ua.length;g++)if(l=
ua[g],l.position[1]+=l.speed,fa(a.position,l.position)&&void 0!==a.c)za(P[a.c],c),ua.splice(g,1),g--;else if(l.position[1]>N||ka(l.position[0],l.position[1],0,0,H.J))ua.splice(g,1),g--;d.time<c&&Sa(c);ma(e,16);M.position&&(void 0!==a.c&&15>ca(a.position,M.position)&&za(P[a.c],c),15>ca(e.position,M.position)&&Ha(c),M.Ba<c&&la(c),ma(M,16));g=ka(e.position[0],e.position[1],0,0,H.u)?y:e.position;l=V(n,g);C=n[0]>g[0]?-1:1;if(3<Math.abs(g[0]-n[0])||3<Math.abs(g[1]-n[1]))n[0]+=Math.cos(l)*C*s,n[1]+=Math.sin(l)*
C*s;(7*aa()+25>=ca(e.position,a.position)||xa(e.position[0],e.position[1],0,0,H.J)||3>ca(n,e.position))&&e.C<c&&Ha(c)}d.W=ea.getBoundingClientRect();p.fillStyle="#000";p.fillRect(0,0,L,N);q=C=0;hb>c&&(C=Math.floor(6*Math.random()-3),q=Math.floor(6*Math.random()-3));for(g=0;g<U;g++)for(l=0;l<ha;l++)da(ia[U*l+g],g*t+C,l*t+q);for(l=0;l<P.length;l++)l!==a.c&&(g=P[l],p.drawImage(g.ha,g.position[0]-8,g.position[1]-8));for(l=0;l<Ca.length;l++)g=Ca[l],B(J.Ga,g.position[0]-8,g.position[1]-8);for(l=0;l<ua.length;l++)g=
ua[l],B(J.Ha,g.position[0]-8,g.position[1]-8);B(J.D,b[0],b[1]);if(d.n[r.G])for(g=0;g<d.n[r.G].length;g++)D(p,d.n[r.G][g][2],d.n[r.G][g][0],d.n[r.G][g][1],"#000");M.position&&B(5<ca(M.position,M.e)?J.Ea:J.Da,M.position[0]-8,M.position[1]);d.state===u.j?a.d?k(J.H,a.position[0]-8,a.position[1]-24,0,a.q):a.s||a.A?k(J.H,a.position[0]-8,a.position[1]-24,10,a.q,c):k(J.H,a.position[0]-8,a.position[1]-24,1,a.q):k(J.H,a.position[0]-8,a.position[1]-24,1);void 0!==a.c&&(g=P[a.c],p.drawImage(g.ha,a.q?g.position[0]+
2:g.position[0]-15-g.size,g.position[1]-10));7*aa()+75>=ca(e.position,a.position)&&(p.beginPath(),p.arc(a.position[0],a.position[1],7*aa()+25,0,360),p.lineWidth=2,p.strokeStyle="#f09",p.stroke());d.state===u.j?e.C>c&&0===Math.floor(c/100)%2||k(J.t,e.position[0]-8,e.position[1]-8,2,!1,c):k(J.t,e.position[0]-8,e.position[1]-8,0);p.fillStyle="red";p.fillRect(n[0]-1,n[1]-1,2,2);p.beginPath();p.arc(n[0],n[1],5,0,360);p.lineWidth=2;p.strokeStyle="red";p.stroke();p.fillStyle="white";d.state===u.j?(l=Math.max(0,
Math.ceil((d.time-c)/1E3)),g=l%60,l=Math.floor(l/60),10>g&&(g="0"+g),p.fillText("\u00a7 "+a.p+"   \u25fc "+a.L+"   \u2699 "+l+":"+g,50,396),p.fillText("\u21a1 "+e.h+"   \u2665 "+e.O,530,12),p.fillStyle="#00deff",p.fillText("LUKE",10,396),p.fillStyle="red",p.fillText("CROW",600,12)):d.state===u.f&&p.fillText("< > CHANGE BLOCK   C: CRATES   T: TIME ("+A[w][r.K]+")   N: NAME ("+A[w][r.I]+")"+(ba?"   S: PAINT   A: TOGGLE PAINT   analogPad: MOVE":""),12,12);for(l=0;l<Qa.length;l++)if(g=Qa[l],p.fillStyle=
g.color,p.fillRect(g.position[0],g.position[1],g.size,g.size),!ma(g,g.speed)||g.time<c)Qa.splice(l,1),l--;for(l=0;l<Pa.length;l++)g=Pa[l],g.time<c?(Pa.splice(l,1),l--):(D(p,g.text,g.position[0]+1,g.position[1]+1,"#000","center","14px sans-serif"),D(p,g.text,g.position[0],g.position[1],g.color,"center","14px sans-serif"),g.Aa||(g.position[1]+=-0.5));d.state===u.i&&p.drawImage(ab,0,0);d.state===u.f&&(p.globalAlpha=0.6,S<Da?(da(""+S,x[0]-x[0]%t,x[1]-x[1]%t),p.strokeStyle="#000",p.strokeRect(x[0]-x[0]%
t,x[1]-x[1]%t,t,t)):S===va.ta?k(J.H,x[0]-8,x[1]-24,1):S===va.t?k(J.t,x[0]-8,x[1]-8,0):S===va.D?B(J.D,x[0],x[1]):S===va.l&&(p.fillStyle="#ea0",p.strokeStyle="#330",p.fillRect(x[0]-8,x[1]-8,16,16),p.strokeRect(x[0]-8,x[1]-8,16,16),p.fillStyle="#000",p.fillText("C",x[0]-4,x[1]+4)),p.globalAlpha=1);window.requestAnimationFrame(wb)})()})();

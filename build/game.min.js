var ka={};
(function(a){function y(a,d){return d?L(a&255)+y(a>>8,d-1):""}var A=this.ya=a||44100,v=2*A,L=String.fromCharCode,l;this.Na=function(a){var d=Audio,q=btoa,h="",w=a.length;for(n=0;n<w;n++)var B=32767*a[n]|0,B=-32768>B?-32768:32767<B?32767:B,B=B+(0>B?65536:0),h=h+String.fromCharCode(B&255,B>>8);a=h;a=["RIFF",36+(l=a.length),"WAVEfmt ",16,1,1,A,v,2,16,"data",l,a];h="";for(n=0;n<a.length;n++)h+="s"=="s4s4224422s4s"[n]?a[n]:y(a[n],"s4s4224422s4s".charCodeAt(n)-48);return new d("data:audio/wav;base64,"+q(h))};
var d,n,q=Math.sin,h=2*Math.PI;this.filter=function(a,h,l,q,w,B,v,A,y,m){l=l?l:1;q=q?q:a.length;d=a.slice(0);for(n=l;n<q;n++)d[n]=h(a,d,l,q,n,w,B,v,A,y,m);return d};this.filters={Ta:function(a,d,h,l,w,n){return d[w-1]+n*(a[w]-d[w-1])},Ua:function(a,d,n,h,l,q){return d[l-1]+q*(h-l)/(h-n)*(a[l]-d[l-1])},Sa:function(a,d,l,h,n,q){return q*(d[n-1]+a[n]-a[n-1])}};this.Aa=function(a,d,l,q,v,B,y,m,L){d=d*h/A;var N=Array(a|0);for(n=0;n<a;n++)N[n]=l(n*d,q,v,B,y,m,L);return N};var m=0;this.L={Oa:function(a){4>
a%h&&(m=2*Math.random()-1);return m},Va:Math.random,Qa:Math.sin,Ra:function(a){return q(a)+0.5*q(a/2)+0.3*q(a/4)},Pa:function(a){return 2*(a/h-(a/h+0.5|0))},Ba:function(a,d){return q(a)>d?1:q(a)<d?-1:d}}}).apply(ka);var Ea={};
(function(){this.ga=[];this.da={square:ka.L.Ba,saw:ka.L.Pa,sine:ka.L.Qa,noise:ka.L.Oa,synth:ka.L.Ra};this.Ja=function(){var a=[],y;for(y in this.da)a.push(y);return a};this.Ka=function(){function a(a,l,d,n,q){void 0===q&&(q=(d-l)/1E3);a={name:a,id:a.replace(/ /g,""),min:l,max:d,step:q,Ia:n,type:"range",group:A};y.push(a)}var y=[],A=0,v=this.Ja();(function(a,l,d){a={name:a,id:a.replace(/ /g,""),options:l,Ia:d,type:"option",group:A};y.push(a)})("Generator",v,v[0]);a("SuperSamplingQuality",0,16,0,1);
a("MasterVolume",0,1,0.4);A++;a("AttackTime",0,1,0.1);a("SustainTime",0,2,0.3);a("SustainPunch",0,3,2);a("DecayTime",0,2,1);A++;a("MinFrequency",20,2400,0,1);a("StartFrequency",20,2400,440,1);a("MaxFrequency",20,2400,2E3,1);a("Slide",-1,1,0);a("DeltaSlide",-1,1,0);A++;a("VibratoDepth",0,1,0);a("VibratoFrequency",0.01,48,8);a("VibratoDepth Slide",-0.3,1,0);a("VibratoFrequencySlide",-1,1,0);A++;a("ChangeAmount",-1,1,0);a("ChangeSpeed",0,1,0.1);A++;a("SquareDuty",0,0.5,0);a("SquareDutySweep",-1,1,0);
A++;a("RepeatSpeed",0,0.8,0);A++;a("PhaserOffset",-1,1,0);a("PhaserSweep",-1,1,0);A++;a("LPFilterCutoff",0,1,1);a("LPFilterCutoffSweep",-1,1,0);a("LPFilterResonance",0,1,0);a("HPFilterCutoff",0,1,0);a("HPFilterCutoffSweep",-1,1,0);return y};this.Aa=function(a){var y=2*Math.PI,A=Math.sin,v=Math.pow,L=Math.abs,l=ka.ya,d=a.SuperSamplingQuality|0;1>d&&(d=1);for(var l=l*d,n=[{K:0,Y:1,time:a.AttackTime},{K:1+a.SustainPunch,Y:1,time:a.SustainTime},{K:1,Y:0,time:a.DecayTime}],q=n.length,h=0;h<q;h++)n[h].V=
1+(n[h].time*l|0);for(var m=void 0,Z=0,T=-1,Da=0,ya=-1,w=0,h=0;h<q;h++)w+=n[h].V;w<l/2&&(w=l/2);var B=Array(w/d|0),G=0,M=0,za=Ea.da[a.Generator];void 0===za&&(za=this.da.Ba);var N=0,N=a.SquareDuty,Fa=a.SquareDutySweep/l,U=0,O=a.StartFrequency*y/l,$=1+64*v(a.Slide,3)/l,da=v(a.DeltaSlide,3)/(1E3*l);void 0!==d&&(da/=d);a.MinFrequency>a.StartFrequency&&(a.MinFrequency=a.StartFrequency);a.MaxFrequency<a.StartFrequency&&(a.MaxFrequency=a.StartFrequency);for(var qa=a.MinFrequency*y/l,ea=a.MaxFrequency*y/
l,ra=0,Ga=a.VibratoFrequency*y/l,aa=a.VibratoDepth,Ka=1+3*v(a.VibratoFrequencySlide,3)/l,Aa=a.VibratoDepthSlide/l,fa=0,ga=a.ChangeSpeed*l,X=v(a.ChangeAmount,2),X=0<a.ChangeAmount?1+10*X:1-0.9*X,la=Array(1024),h=0;1024>h;h++)la[h]=0;var sa=0,V=1020*v(a.PhaserOffset,2),ma=4E3*v(a.PhaserSweep,3)/l,La=1E-5<L(ma)||1E-5<L(V),P=0.0010<a.HPFilterCutoff||0.999>a.LPFilterCutoff,ba=0,Y=0,ca=v(a.LPFilterCutoff,3)/10,Ba=1+a.HPFilterCutoffSweep/1E4,ha=5/(1+20*v(a.LPFilterResonance,2))*(0.01+a.LPFilterCutoff);0.8<
ha&&(ha=0.8);var ha=1-ha,J=0.999>a.LPFilterCutoff,p=0,Q=v(a.HPFilterCutoff,2)/10,u=1+a.HPFilterCutoffSweep/1E4,r=0,ta=w;0<a.RepeatSpeed&&(ta=v(1-a.RepeatSpeed,2)*l+32);for(var Ma=a.MasterVolume,E=0,h=0;h<w;h++)G=za(U,N,0),N+=Fa,0>N?N=0:0.5<N&&(N=0.5),r>ta&&(U=0,O=a.StartFrequency*y/l,$=1+3*v(a.Slide,3)/l,da=v(a.DeltaSlide,3)/(1E3*l),void 0!==d&&(da/=d),fa=0,ga=a.ChangeSpeed*l,X=1+(a.ChangeAmount|0)/12,r=0),r+=1,U+=O,$+=da,O*=$,fa>ga&&(O*=X,ga=w),fa+=1,O>ea?O=ea:O<qa&&(O=qa),ra+=Ga,m=O*A(ra)*aa,U+=
m,Ga*=Ka,Aa&&(aa+=Aa,0>aa?Aa=aa=0:1<aa&&(aa=1,Aa=0)),P&&(0.0010<L(Q)&&(Q*=u,1E-5>Q?Q=1E-5:0.1<Q&&(Q=0.1)),m=ba,ca*=Ba,0>ca?ca=0:0.1<ca&&(ca=0.1),J?(Y+=(G-ba)*ca,Y*=ha):(ba=G,Y=0),ba+=Y,p+=ba-m,G=p*=1-Q),La&&(V+=ma,0>V&&(V=-V,ma=-ma),1023<V&&(V=1023,ma=0),la[sa]=G,G+=la[sa-(V|0)+1024&1023],sa=sa+1&1023),h>ya&&(T+=1,m=T<q?n[T]:{K:0,Y:0,V:w},Z=m.K,Da=(m.Y-m.K)/(m.V+1),ya+=m.V),G*=Z,Z+=Da,G*=Ma,1<d?(M+=G,0===(h+1)%d&&(B[E]=M/d,E+=1,M=0)):B[h]=G;a=l/100|0;y=Array(a);for(h=0;h<a;h++)y[h]=0;return y.concat(B).concat(y)};
this.ga=this.Ka()}).apply(Ea);var Sa={};(function(){this.za=function(a){a=Ea.Aa(this.Ha(a));return ka.Na(a)};this.Ha=function(a){for(var y={},A=Ea.ga.length,v=0;v<A;v++)y[Ea.ga[v].id]=a[v];return y}}).apply(Sa);(function(){var a,y,A,v,L,l,d,n,q;function h(z,a){var b=new XMLHttpRequest;"withCredentials"in b?b.open(z,a,!0):"undefined"!=typeof XDomainRequest?(b=new XDomainRequest,b.open(z,a)):b=null;return b}function m(z,a,b){z.addEventListener?z.addEventListener(a,b,!1):z.attachEvent?z.attachEvent("on"+a,b):z["on"+a]=b}function Z(a,b,c,F,d){var e=Ca[a].frame;a=Ca[a].h;p.drawImage(na,e.x,e.y,F||e.b,d||e.c,b+a.x,c+a.y,a.b,a.c)}function T(a,b,c,F,d,e){var g=Ca[a].frame,k=Ca[a].h;a=Ca[a].frames;F=e?a[Math.floor(e*
F/1E3)%a.length]:a[F];d?p.drawImage(Na,$a-(g.x+F.x)-F.b,g.y+F.y,F.b,F.c,b+k.x,c+k.y,F.b,F.c):p.drawImage(na,g.x+F.x,g.y+F.y,F.b,F.c,b+k.x,c+k.y,F.b,F.c)}function Da(a){a=a||Levels[u];a=["CustomLevel"+Ma++,a[s.fa].slice(),a[s.ba].slice(),a[s.Z].slice(),a[s.q]&&a[s.q].slice(),a[s.j],a[s.ea],a[s.f].slice(),null,!0];Levels.push(a);f.state===x.e&&(u=Levels.length-1,M(u))}function ya(){if(Ta)try{f.state===x.i&&0<Ua.length&&(ab[Ua.shift()].play(),setTimeout(ya,200))}catch(a){}}function w(a,b){if(Ta)try{Ha[a]=
Sa.za(b)}catch(c){}}function B(a){if(Ta)try{Ha[a]&&(Ha[a].pause(),Ha[a].currentTime=0,Ha[a].play())}catch(b){}}function G(a){var b=a[s.Z],c,d,f,e;Oa.O=b;for(var g=K.length=0;g<a[s.f].length;g++)c=a[s.f][g],d=Object.create(Oa),d.size=c,f=document.createElement("canvas"),f.width=Pa+c,f.height=Pa+c,e=f.getContext("2d"),e.fillStyle="yellow",e.fillRect(0,0,Pa+c,Pa+c),e.fillStyle="black",e.fillText(c,5,10),d.ka=f,f=b[0]+16*g,c=b[1]-c,d.position=[f,c],d.O=[f,c],K.push(d)}function M(z){z=f.o=Levels[z]||Levels[u];
qa(x.e);b.position=z[s.fa].slice();a=z[s.ba].slice();b.J=0;b.X=0;b.d=void 0;b.T=bb;b.w=!1;b.D=!1;b.a=!1;b.n=!1;b.v=!1;y=cb;v=A=0;f.time=0;qa(x.e);E=0;z[s.q]?(d=z[s.q].slice(),n=[z[s.q][0]+15,z[s.q][1]+23],q=n.slice()):n=d=null;ua="4444444444444444444444444444444444444444"+z[s.ea]+"4444444444444444444444444444444444444444";ua=ua.split("");G(z);va.length=0;oa.length=0;Qa.width=R;Qa.height=S;var t=Qa.getContext("2d");t.fillStyle="rgba(0,0,0,0.7)";t.fillRect(0,0,R,S);t.fillStyle="#fff";t.font="20px courier";
t.textAlign="center";t.fillText(f.o[s.m],R/2,S/2-50);t.fillText("Delivery Boy "+f.ia+" - "+f.ja+" Crow",R/2,S/2);t.font="15px courier";t.fillText("Click the "+(P?"screen":"crow")+" to start!",R/2,S/2+60);t.fillText("< >: Select level",R/2,S/2+100);t.fillText(z[s.Q]?"E: edit   "+(P?"1":"D")+": delete   "+(P?"2":"J")+": insert/copy JSON   S: share":"E: edit",R/2,S/2+120);t.beginPath();t.arc(a[0],a[1],16,0,360);t.lineWidth=1;t.strokeStyle="#fff";t.stroke();Ua=db.slice();window.localStorage&&(window.localStorage.sa=
JSON.stringify(Levels))}function za(){f.ia+=1;J.style.cursor="auto";B(D.xa);M(u)}function N(){f.ja+=1;J.style.cursor="auto";B(D.oa);M(u)}function Fa(a){var b=a.clientX-f.S.left;a=a.clientY-f.S.top;b=Math.max(0,Math.min(b,R-1));a=Math.max(0,Math.min(a,S-1));return[b,a]}function U(){return Math.max(1,b.speed+b.W-(void 0!==b.d?K[b.d].size:0))}function O(){qa(x.i);f.time=Q+f.o[s.j];ya();J.style.cursor="none"}function $(){if(f.state===x.g)if(E<wa){var z=Math.floor(r[1]/C);0<z&&z<Va-1&&(ua[xa*z+Math.floor(r[0]/
C)]=""+E)}else if(E===pa.ta)b.position=r.slice();else if(E===pa.B)a=r.slice();else if(E===pa.l&&d)d=r.slice(),n=[d[0]+15,d[1]+23],q=n.slice();else{if(E===pa.f)for(Oa.O=r.slice(),z=0;z<K.length;z++){var t=K[z];t.position[0]=r[0]+16*z;t.position[1]=r[1]-t.size}}else f.state!==x.e||P?0<A&&v<Q&&(A--,B(D.na),z=Object.create(jb),z.position=a.slice(),oa.push(z)):r[0]>a[0]-16&&(r[0]<a[0]+16&&r[1]>a[1]-16&&r[1]<a[1]+16)&&O()}function da(b){b.preventDefault();if(f.state===x.g)Wa=!Wa;else if(f.state===x.i&&
v<Q)if(b=Fa(b),(ga(a[0]-8,a[1]-8,16,16,H.C)||fa(a[0],a[1],0,0,H.C))&&A<kb)B(D.aa),A++;else{var t;for(t=0;t<va.length;t++)if(ra(b,va[t].position)){A=Math.max(A,lb);B(D.aa);va.splice(t,1);break}}}function qa(a){f.state=a;if(P)if(a===x.g){a=document.getElementsByClassName("edit");for(var b=0;b<a.length;b++)a[b].setAttribute("class","btn edit")}else for(a=document.getElementsByClassName("edit"),b=0;b<a.length;b++)a[b].setAttribute("class","btn h edit")}function ea(a,b){return ua[xa*Math.floor(b/C)+Math.floor(a/
C)]}function ra(a,b){return Math.round(a[0]/C)===Math.round(b[0]/C)&&Math.round(a[1]/C)===Math.round(b[1]/C)}function Ga(){var a=b.d,c=void 0!==a?K[a]:void 0;if(void 0===c){for(a=0;a<K.length;a++)if(ra(b.position,K[a].position)){b.d=a;B(D.$);return}X(H.p)&&(b.J=mb,B(D.p))}else b.d=void 0,B(D.$),X(H.pa)&&void 0!==c&&(K.splice(a,1),0>=K.length?za():B(D.ma))}function aa(){var a=b.U,c=U();b.a||(a=0);a=Math.min(c,a+c/7);b.U=a;return X(H.s)?c/2:a}function Ka(){J.style.cursor="auto";f.state===x.g&&(Levels[u][s.ea]=
ua.join("").substring(xa,xa*Va-xa),Levels[u][s.fa]=b.position.slice(),Levels[u][s.ba]=a.slice(),Levels[u][s.q]=d instanceof Array?d.slice():void 0,Levels[u][s.Z]=Oa.O.slice());M(u)}function Aa(a){var t=U(),l=b.Ma,F=b.position[0],p=b.position[1],e=W.la;if(f.state===x.e)if(e[c.t]&&!b.a)u=(u+Levels.length-1)%Levels.length,M(u),b.a=!0;else if(e[c.u]&&!b.a)u=(u+1)%Levels.length,M(u),b.a=!0;else if(e[c.k]&&!b.a)b.a=!0,Levels[u][s.Q]||Da(),qa(x.g),e[c.k]=void 0;else if(e[c.F]&&!b.a)b.a=!0,Levels[u][s.Q]&&
(Levels.splice(u,1),u--,M(u)),e[c.F]=void 0;else if(e[c.r]&&Levels[u][s.Q]&&!b.a){if(l=t=prompt("LEVEL JSON",JSON.stringify(Levels[u])))a:{try{JSON.parse(t);l=!0;break a}catch(g){alert("Error!")}l=!1}l&&(Levels[u]=JSON.parse(t),M(u));e[c.r]=void 0}else if(e[c.ha]&&!b.a){b.a=!0;var k=h("post",ca+"/addLevel");k.onload=function(){prompt("Your level share url",k.responseText)};k.onerror=function(){alert("Not available now")};k.send(JSON.stringify(Levels[u]));e[c.ha]=void 0}else e[c.t]||(e[c.u]||e[c.F]||
e[c.k]||e[c.r]||e[c.ha])||(b.a=!1);else{if(f.state===x.g)if(e[c.t]&&!b.a)E=(E+Xa-1)%Xa,b.a=!0;else if(e[c.u]&&!b.a)E=(E+1)%Xa,b.a=!0;else if(e[c.l]&&!b.a)d instanceof Array?d=n=q=null:(d=[32,32],n=[d[0]+15,d[1]+23],q=n.slice()),b.a=!0;else if(e[c.f]&&!b.a){b.a=!0;try{var r=JSON.parse(prompt("Set crates",JSON.stringify(Levels[u][s.f])));if(r instanceof Array){for(t=0;t<r.length;t++)"number"===!typeof t&&alert("Error!"),r[t]=Math.max(1,Math.min(5,r[t]));Levels[u][s.f]=r;G(Levels[u])}}catch(v){alert("Error!")}e[c.f]=
void 0}else e[c.m]&&!b.a?(b.a=!0,(t=prompt("Set name",Levels[u][s.m]))&&(Levels[u][s.m]=t),e[c.m]=!1):e[c.j]&&!b.a?(b.a=!0,a=+prompt("Set time",Levels[u][s.j]),!isNaN(a)&&0<a&&(Levels[u][s.j]=a),e[c.j]=!1):e[c.k]&&!b.a?(b.a=!0,Ka(),e[c.k]=void 0):e[c.t]||(e[c.u]||e[c.l]||e[c.f]||e[c.m]||e[c.j]||e[c.k])||(b.a=!1);else f.state===x.i&&(!e[c.P]||b.D||b.n||b.w?e[c.k]&&!b.w?(b.w=!0,0<b.J&&(b.J--,b.W=nb,b.X=a+ob,r=Object.create(pb),r.position=[b.position[0]+4,b.position[1]-7],va.push(r),B(D.wa))):e[c.P]||
(e[c.k]||!b.w)||(b.w=!1):(b.w=!0,Ga()),e[c.R]?X(H.s)?(b.position[1]=Math.min(S-C,p-l),b.a=!0):b.D||b.n||(b.A=b.La,b.U=t,b.D=!0,b.n=!0,B(D.ra)):!e[c.R]&&b.D&&(b.D=!1),e[c.t]&&(b.position[0]=Math.max(C,F-aa()),b.a=!0,b.v=!0),e[c.u]&&(b.position[0]=Math.min(R-2*C,F+aa()),b.a=!0,b.v=!1),e[c.ca]&&X(H.s)&&(b.position[1]=Math.min(S,p+l),b.a=!0),e[c.t]||(e[c.R]||e[c.u]||e[c.ca])||(b.a=!1));e[c.e]&&Ka()}}function fa(a,b,c,d,f){var e=b,g=ea(a,e);c=a+c;topRight=ea(c,e);bottomRight=ea(c,b+d);bottomLeft=ea(a,
b);return g===f||topRight===f||bottomRight===f||bottomLeft===f}function ga(a,b,c,d,f){b+=d;d=ea(a,b);bottomLeft=ea(a+c,b);return d===f||bottomLeft===f}function X(a){return fa(b.position[0]-8,b.position[1]-32,16,32,a)||fa(b.position[0],b.position[1]-8,0,0,a)}function la(a,b){return Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2)}function sa(){return void 0!==b.d?K[b.d]:void 0}function V(a,b){return Math.atan((b[1]-a[1])/(b[0]-a[0]))}function ma(){var a=sa();a&&(B(D.ua),b.d=void 0,a.position=a.O.slice(),
b.T--,0>=b.T&&N())}function La(a,b,c){var d=null,f="#00deff";a===H.va?d=I.Ga:a===H.I?d=I.I:a===H.Fa?f="#000":a===H.pa?f="#0f0":a===H.C?d=I.C:a===H.s?d=I.s:a===H.p&&(d=I.p);p.fillStyle=f;p.fillRect(b,c,C,C);null!==d&&Z(d,b,c,C,C)}(function(){for(var a=0,b=["webkit","moz"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||
(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),f=window.setTimeout(function(){b(c+d)},d);a=c+d;return f});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})})();window.createCORSRequest=h;var P=!1;if("ontouchstart"in document.documentElement)for(var P=!0,ba=document.getElementsByClassName("btn"),Y=0;Y<ba.length;Y++)-1===ba[Y].getAttribute("class").indexOf("edit")&&ba[Y].setAttribute("class","btn");var ca="http://127.0.0.1:3000",
Ba=window.location.hash;if(1<Ba.length){var Ba=Ba.substr(1),ha=h("get",ca+"/getLevel/"+Ba);ha.onload=function(){try{var a=ha.responseText;0<a.length&&Da(JSON.parse(a))}catch(b){alert("Error!")}};ha.send()}var J=document.getElementById("C"),p=J.getContext("2d"),Q=0,u=0,r=[0,0],ta=!1,Ma=1,E=0,Wa=!1,R=640,S=400,C=16,xa=R/C,Va=S/C,Ta=window.btoa&&window.atob,H={EMPTY:"0",va:"1",s:"2",I:"3",Fa:"4",pa:"5",C:"6",p:"7"},wa=8,pa={ta:wa+0,B:wa+1,l:wa+2,f:wa+3},Xa=wa+4,x={e:0,i:1,g:2},D={ra:0,ua:1,na:2,Ca:3,
$:4,ma:5,xa:6,oa:7,wa:8,aa:9,p:10,qa:11},bb=10,Pa=12,eb=[1,-6],nb=3,ob=5E3,mb=3,kb=3,lb=5,cb=10,db="023123467".split(""),c={t:37,R:38,u:39,ca:40,k:69,P:32,e:27,F:68,r:74,l:71,f:67,m:78,j:84,ha:83},I={B:0,Da:1,p:2,l:3,s:4,H:5,C:6,I:7,Ea:8,Ga:9},Ca={},Ca=[{frame:{x:30,y:0,b:30,c:14},h:{x:1,y:1,b:30,c:14},frames:[{x:1,y:1,b:15,c:13},{x:17,y:1,b:15,c:13}]},{frame:{x:14,y:40,b:14,c:8},h:{x:1,y:7,b:14,c:8}},{frame:{x:32,y:14,b:16,c:16},h:{x:0,y:0,b:16,c:16}},{frame:{x:0,y:24,b:14,c:24},h:{x:1,y:7,b:14,
c:24}},{frame:{x:16,y:48,b:16,c:16},h:{x:0,y:0,b:16,c:16}},{frame:{x:0,y:0,b:30,c:24},h:{x:1,y:3,b:30,c:24},frames:[{x:0,y:0,b:15,c:24},{x:15,y:0,b:15,c:24}]},{frame:{x:48,y:14,b:16,c:10},h:{x:0,y:10,b:16,c:10}},{frame:{x:14,y:24,b:16,c:16},h:{x:0,y:0,b:16,c:16}},{frame:{x:31,y:30,b:6,c:14},h:{x:4,y:1,b:6,c:14}},{frame:{x:0,y:48,b:16,c:16},h:{x:0,y:0,b:16,c:16}}],s={m:0,fa:1,ba:2,Z:3,q:4,j:5,ea:6,f:7,G:8,Q:9},na=new Image,Na=document.createElement("canvas"),$a=0;na.onload=function(){Na.width=$a=na.naturalWidth;
Na.height=na.naturalHeight;var a=Na.getContext("2d");a.translate(na.naturalWidth,0);a.scale(-1,1);a.drawImage(na,0,0)};na.src="img/imgmap.png";var b={position:null,speed:4,U:0,W:0,X:0,Ma:2,La:-7,D:!1,n:!1,a:!1,w:!1,A:0,d:void 0,J:0,T:bb,v:!1};L=a=null;A=0;l=!1;v=0;y=cb;var ua=[],Oa={ka:null,size:1,position:null,O:[0,0]},K=[],pb={position:null},va=[],jb={position:null,speed:6},oa=[],f={state:x.e,S:J.getBoundingClientRect(),time:0,ia:0,ja:0,o:null},Qa=document.createElement("canvas");q=null;d=[80,53];
n=[95,78];var fb=[["Tutorial",[33,370],[R-24,55],[300,365],[20,70],3E6,"00000000000000000000000000000000000000000000000000000000000000000000000000000000330000000000000000000000000000000000006000000000000000000000000000000000000000110000000000033300000000000006000000000000110000000003330000000000001110000000000000000000000333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003333333333333333333333333333333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000555500000000000000000000000000000000000055550000000000000000000000000000000000005555000000000007000000000000002000000000111111111111111111111111111111200000000000000000000000000000000000000020000000000000000000000000000000000000002000000000000000000000000000000000000000200000000000000000000000000000000000000020000000001111111111111111111111111111111111111111",
[1],[[20,340,["PLAYER 1"]],[100,340,["ARROWS: move/jump"]],[250,340,["SPACEBAR: grab/release crate"]],[500,340,["UP/DOWN: Climb ladder"]],[450,250,["Crates break if you fall from too high"]],[160,250,[(P?"S":"SPACEBAR")+": buy candies when not holding crate","E: Use candy to gain speed"]],[10,230,["Deliver crate to green area"]],[560,30,["PLAYER 2",(P?"DPad":"Mouse")+": move"]],[410,70,["Don't get shot","Hide in the nest"]],[410,130,[(P?"2":"RClick")+": eat from nest or candy crumbs",(P?"1":"LClick")+
": shoot!"]],[140,60,["Don't touch roofs or the boy"]]]],["Level 1",[25,366],[616,24],[41,364],[513,180],6E4,"00000000000000000000000000000000000000600000000000000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000003330000000000000000000000000000000000003333300000000000000000000000000000000000055500000000000000000000000000000000000005550000020000000000000200000000000000000555020002000111111111120000333000000000111112000200133333330002000000000000000000000200021130000000000200000000000000000000020002000000000000020000000000000000000002000200020000000002111111100111001101111100111112000000000200000000000000000000000033333200000000020000000000000000000000000000020000000000000000000000000000000000000002000000000000000000000000000000000000000200000000000000000000000000000000001111111111111111111111111111111111111111",
[1,2]],["Level 2",[28,143],[600,296],[588,365],[51,50],12E4,"33330000000000000000000000000000000000005550000000000033000000000330000000000000555000000000000000000000000000000000000055500000000000000003030000000000000000001111111000000000000030000000000000110010000000010000000000000000000000000100301000000000000200000200000200000200000000100000000011120111102000201111021113002010111100000002000000020200000002000000211100000000000100000000200000000100000020000000000000000000000000000000000002002000000000000000000000000000000000030211100000001110000000000000000000000030020000000000000000000000003333300000000002000000000000000000000000000000000003020200000000000001100000000000000000000002110000000000000000000000000020700000020200000000000000000000000000112110000002020000060000000000010000000000200000000201000011100000000000000000000020000000020000000000000000000000000000002000000002000000000000000000000000000000200000000200000000001111111111111111111111111111111111111111",
[1,2]],["Level 3",[17,349],[281,39],[96,316],[49,163],24E4,"00000000000000010001000000000000000000000000000000300001666100003000000000000020000000000003000111110003000000000007002000000000000030000000003000000000001110203000000000000000000000000000000000000020332200000000000000000000000000000000002033202000000000000000000000000000000000203320320000000000222000000000000000000020332033111001111100011111000110011001102055200000000000000000000000000110011000205520000000000000000000000000000000000020111100000000000000000000000000000000002000000000000000030003000000000220022000200000000000000030000030000200000000000020000000000000000300030000020000000000002000003030300000000200000002011001100110200003030303030303020000000200011001100020000000000030303032111111000000000000000000000000000000000203030303030000000000000000011100070000023030303030300000000000000000000011100002000000000000000000000011110000000000000200000000000000000000001111111111111111111111111111111111111111",
[1,2]],["Level 4",[75,370],[R-24,24],[83,365],[80,53],3E5,"33333300000000000000000000000000000000605555530000000000000000000000000000000011555550000000000000000000003333000000000055555000000000000002000000000000000000001111110010011001111201110011110000000000000000000003300000020000000000100000000000000000000000000702000000000001000000000001110000000000111111000000000010020000002000000000000033333330000333330102100000200033333300000000000000000000000200000020000000000000000000000000000000020000002000000000000010010010011000020202000000201111111111111000000033311001111211100020033333333330000000000003300000033333002000000000000000000000000000000000000000200000000000000000200000000000020000000020111100111110011120111001111112011111002000000000000000002000000303030200000000200000000000000000207000000000020000000000333330003030300011110000200002000000000000000000000000000000000021111200000000000000000000000000000000002000000000001111111111111111111111111111111111111111",
[1,2,3]]];Levels=window.localStorage&&window.localStorage.sa&&JSON.parse(window.localStorage.sa)||fb;var Ma=Levels.length-fb.length+1,W={la:{},N:function(a){W.la[a.keyCode]=void 0},M:function(a){W.la[a.keyCode]=Q}};window.addEventListener("keyup",W.N,!1);window.addEventListener("keydown",W.M,!1);for(var gb=[523.25,587.33,659.26,698.46,783.99,880,987.77,1046.5,1108.73],ab={},Ra=0;Ra<gb.length;Ra++)ab[Ra]=Sa.za(["synth",0,0.4,0,0.208,0,0.12,20,gb[Ra],2400,0,0,0,0.01,3E-4,0,0,0,0,0,0,0,0,1,0,0,0.1,0]);
var Ua=db.slice(),Ha={};w(D.ra,["square",0,0.4,0,0.174,0,0.28,20,497,2400,0.22,0,0,0.01,3E-4,0,0,0,0.0665,0,0,0,0,0.783,0,0,0,0]);w(D.ua,["noise",0,0.4,0,0.14,0.405,0.116,20,479,2400,-0.07,0,0,0.01,3E-4,0,0,0,0,0,0,-0.086,-0.122,1,0,0,0,0]);w(D.ma,["square",0,0.4,0,0.098,0.504,0.282,20,1582,2400,0,0,0,0.01,3E-4,0,0,0,0,0,0,0,0,1,0,0,0,0]);w(D.wa,["saw",0,0.4,0,0.324,0,0.284,20,631,2400,0.172,0,0.498,19.35,3E-4,0,0,0,0,0,0,0,0,1,0,0,0,0]);w(D.na,["saw",0,0.4,0,0.212,0,0.028,20,1169,2400,-0.52,0,0,
0.01,3E-4,0,0,0,0.5,-0.592,0,0.094,0.066,1,0,0,0.28,0]);w(D.oa,["synth",0,0.4,0,0.32,0.348,0.44,20,372,417,0,0,0,0.01,3E-4,0,0.374,0.264,0,0,0,0,0,1,0,0,0,0]);w(D.xa,["synth",0,0.4,0,0.13,0.345,0.41,253,1168,1407,-0.0060,-0.082,0,0.01,3E-4,0,0.206,0.166,0,0,0,0,0,1,0,0,0,0]);w(D.$,["noise",0,0.4,0,0.0020,0.024,0.09,20,372,2400,0,0,0,0.01,3E-4,0,-0.342,0.809,0,0,0,0,0,1,0,0,0,0]);w(D.Ca,["noise",0,0.4,0,0.152,0.393,0.274,20,839,2400,-0.31,0,0,0.01,3E-4,0,-0.34,0.783,0,0,0.6096,0.526,-0.0080,1,0,0,
0,0]);w(D.aa,["square",0,0.4,0,0.04,0,0.048,20,578,2400,0.104,0,0.683,19.158,3E-4,0,0,0,0.385,0,0,0,0,1,0,0,0,0]);w(D.p,["square",0,0.4,0,0.046,0.477,0.24,20,1197,2400,0,0,0,0.01,3E-4,0,0.498,0.204,0,0,0,0,0,1,0,0,0,0]);w(D.qa,["noise",0,0.4,0,0.108,0.336,0.124,20,462,2400,0,0,0,0.01,3E-4,0,0,0,0,0,0,0,0,1,0,0,0,0]);M(u);m(J,"click",$);m(J,"mousedown",function(a){1===a.which&&(ta=!0);f.state===x.g&&ta&&$()});m(J,"mouseup",function(a){1===a.which&&(ta=!1)});m(J,"mousemove",function(a){var b=Fa(a);
r=[b[0],b[1]];f.state===x.i?L=Fa(a).slice():f.state===x.g&&ta&&$()});m(J,"contextmenu",da);if(P){var ia=function(a,b){var c=document.getElementById(a);m(c,"touchstart",function(){W.M({keyCode:b})});m(c,"touchend",function(){W.N({keyCode:b})})},Ya=function(a,b,c){a=document.getElementById(a);m(a,"touchstart",b);m(a,"touchend",c)};m(J,"touchstart",function(){f.state===x.e&&O()});Ya("s",function(){f.state===x.e?W.M({keyCode:c.F}):$()},function(){W.N({keyCode:c.F})});Ya("e",function(a){f.state===x.e?
W.M({keyCode:c.r}):da(a)},function(){W.N({keyCode:c.r})});var Ia=document.getElementById("o"),ja=Ia.getBoundingClientRect(),hb=[100,100],Za=!1,Ja,ib=function(a){a.preventDefault();Ja=a.changedTouches;ja=Ia.getBoundingClientRect();Za=!0};m(Ia,"touchstart",ib);m(Ia,"touchmove",ib);m(Ia,"touchend",function(a){a.preventDefault();Za=!1});Ya("p",function(){W.M({keyCode:f.state!==x.e?c.P:c.r})},function(){W.N({keyCode:f.state!==x.e?c.P:c.r})});ia("a",c.k);ia("l",c.t);ia("u",c.R);ia("r",c.u);ia("d",c.ca);
ia("g",c.l);ia("c",c.f);ia("t",c.j);ia("n",c.m)}(function t(c){Aa(c);Q=c;if(Za&&Ja){for(var h,m,e=0;e<Ja.length;e++)if(m=Ja[e],m.clientX>=ja.left&&m.clientX<ja.left+ja.width&&m.clientY>=ja.top&&m.clientY<ja.top+ja.height){h=Ja[e];break}if(h){h=[h.clientX-ja.left,h.clientY-ja.top];m=V(hb,h);var e=Math.sqrt(la(hb,h))/12.5,g;f.state===x.i?g=a:f.state===x.g&&(g=r);g&&(g[0]+=(f.state===x.g?Math.round(Math.cos(m)):Math.cos(m))*(100>h[0]?-e:e),g[1]+=(f.state===x.g?Math.round(Math.sin(m)):Math.sin(m))*(100>
h[0]?-e:e),g[0]=Math.max(0,Math.min(g[0],R-1)),g[1]=Math.max(0,Math.min(g[1],S-1)));Wa&&$()}}if(f.state===x.i){f.S=J.getBoundingClientRect();g=0;for(var k;g<=b.A;){if(ga(b.position[0]-8,b.position[1]+g,16,0,H.va)){k=b.position[1]+g-(b.position[1]+g)%C;break}g+=C}k?(b.position[1]=k,b.n&&(b.U=0,(k=sa())&&b.A>12-k.size&&ma()),b.n=!1,b.A=0):ga(b.position[0]-16,b.position[1]-32,16,32,H.s)?b.n=!1:(b.A+=1,b.n=!0,b.position[1]+=b.A);void 0!==b.d&&(K[b.d].position[0]=b.position[0]+eb[0],K[b.d].position[1]=
b.position[1]+eb[1]);b.X<c&&0<b.W&&(b.W=0);for(k=0;k<oa.length;k++)if(g=oa[k],g.position[1]+=g.speed,ra(b.position,g.position))ma(),oa.splice(k,1),k--;else if(g.position[1]>S||ga(g.position[0],g.position[1],0,0,H.I))oa.splice(k,1),k--;f.time<c&&N();a&&L&&(m=V(a,L),e=a[0]>L[0]?-1:1,k=Math.abs(a[0]-L[0]),g=Math.abs(a[1]-L[1]),3<k||3<g)&&(h=16*Math.cos(m)*e,m=16*Math.sin(m)*e,Math.abs(h)>k&&(h=k*h/Math.abs(h)),Math.abs(m)>g&&(m=g*m/Math.abs(m)),a[0]+=h,a[1]+=m);l=Math.pow(7*U()+75,2)>=la(a,b.position);
d&&(k=ga(a[0],a[1],0,0,H.C)?n:a,g=V(q,k),h=q[0]>k[0]?-1:1,3<Math.abs(k[0]-q[0])||3<Math.abs(k[1]-q[1]))&&(q[0]+=1*Math.cos(g)*h,q[1]+=1*Math.sin(g)*h);(Math.pow(7*U()+25,2)>=la(a,b.position)||fa(a[0],a[1],0,0,H.I)||d&&3>Math.sqrt(la(q,a)))&&v<c&&(v=c+5E3,B(D.qa),A=0,y--,0>=y&&za())}f.S=J.getBoundingClientRect();p.fillStyle="black";p.fillRect(0,0,R,S);for(k=0;k<xa;k++)for(g=0;g<Va;g++)La(ua[xa*g+k],k*C,g*C);for(g=0;g<K.length;g++)g!==b.d&&(k=K[g],p.drawImage(k.ka,k.position[0]-8,k.position[1]-8));
for(g=0;g<va.length;g++)k=va[g],Z(I.Da,k.position[0]-8,k.position[1]-8);for(g=0;g<oa.length;g++)k=oa[g],Z(I.Ea,k.position[0]-8,k.position[1]-8);d&&Z(I.l,d[0],d[1]);if(f.o[s.G])for(k=0;k<f.o[s.G].length;k++){g=p;var w=f.o[s.G][k][2];h=f.o[s.G][k][0];var G=f.o[s.G][k][1];m=g.fillColor;e=g.textAlign;g.fillStyle="black";for(w=w.slice();0<w.length;)g.fillText(w.shift(),h,G),G+=10;g.fillStyle=m;g.textAlign=e}f.state===x.i?b.n?T(I.H,b.position[0]-8,b.position[1]-24,0,b.v):b.a?T(I.H,b.position[0]-8,b.position[1]-
24,10,b.v,c):T(I.H,b.position[0]-8,b.position[1]-24,1,b.v):T(I.H,b.position[0]-8,b.position[1]-24,1);void 0!==b.d&&(k=K[b.d],p.drawImage(k.ka,b.v?k.position[0]+2:k.position[0]-15-k.size,k.position[1]-10));l&&(p.beginPath(),p.arc(b.position[0],b.position[1],7*U()+25,0,360),p.lineWidth=2,p.strokeStyle="#f09",p.stroke());f.state===x.i?v>c&&0===Math.floor(c/100)%2||T(I.B,a[0]-8,a[1]-8,2,!1,c):T(I.B,a[0]-8,a[1]-8,0);d&&(p.fillStyle="red",p.fillRect(q[0]-1,q[1]-1,2,2),p.beginPath(),p.arc(q[0],q[1],5,0,
360),p.lineWidth=2,p.strokeStyle="red",p.stroke());f.state===x.i?(p.fillStyle="#00deff",p.fillText("BOY",10,396),p.fillStyle="red",p.fillText("CROW",600,12),p.fillStyle="white",p.fillText("SPEED: "+U()+"   BOOST: "+Math.max(0,Math.ceil((b.X-c)/1E3))+"   TIME: "+Math.max(0,Math.ceil((f.time-c)/1E3))+"   CANDIES: "+b.J+"   CRATES: "+b.T,50,396),p.fillText("SHOTS: "+A+"   STUN: "+Math.max(0,Math.ceil((v-c)/1E3))+"   HEALTH: "+y,410,12)):f.state===x.g&&(p.fillStyle="white",p.fillText("< > CHANGE BLOCK   G: GRANNY   C: CRATES   T: TIME ("+
Levels[u][s.j]+")   N: NAME ("+Levels[u][s.m]+")"+(P?"   1: PAINT   2: TOGGLE PAINT":""),12,12));f.state===x.e&&p.drawImage(Qa,0,0);f.state===x.g&&(p.globalAlpha=0.6,E<wa?(La(""+E,r[0]-r[0]%C,r[1]-r[1]%C),p.strokeStyle="#000",p.strokeRect(r[0]-r[0]%C,r[1]-r[1]%C,C,C)):E===pa.ta?T(I.H,r[0]-8,r[1]-24,1):E===pa.B?T(I.B,r[0]-8,r[1]-8,0):E===pa.l?Z(I.l,r[0],r[1]):E===pa.f&&(p.fillStyle="yellow",p.fillRect(r[0]-8,r[1]-8,16,16),p.fillStyle="#000",p.fillText("C",r[0]-4,r[1]+4)),p.globalAlpha=1);window.requestAnimationFrame(t)})()})();

var ka={};
(function(b){function y(b,e){return e?l(b&255)+y(b>>8,e-1):""}var n=this.Ea=b||44100,u=2*n,l=String.fromCharCode,e;this.Xa=function(b){var M=Audio,f=btoa,l="",V=b.length;for(t=0;t<V;t++)var G=32767*b[t]|0,G=-32768>G?-32768:32767<G?32767:G,G=G+(0>G?65536:0),l=l+String.fromCharCode(G&255,G>>8);b=l;b=["RIFF",36+(e=b.length),"WAVEfmt ",16,1,1,n,u,2,16,"data",e,b];l="";for(t=0;t<b.length;t++)l+="s"=="s4s4224422s4s"[t]?b[t]:y(b[t],"s4s4224422s4s".charCodeAt(t)-48);return new M("data:audio/wav;base64,"+f(l))};
var E,t,H=Math.sin,f=2*Math.PI;this.filter=function(b,e,l,n,f,G,y,u,p,H){l=l?l:1;n=n?n:b.length;E=b.slice(0);for(t=l;t<n;t++)E[t]=e(b,E,l,n,t,f,G,y,u,p,H);return E};this.filters={eb:function(b,e,l,n,f,t){return e[f-1]+t*(b[f]-e[f-1])},fb:function(b,e,l,n,f,t){return e[f-1]+t*(n-f)/(n-l)*(b[f]-e[f-1])},cb:function(b,e,l,n,f,t){return t*(e[f-1]+b[f]-b[f-1])}};this.Ga=function(b,e,l,y,u,p,E,H,ma){e=e*f/n;var W=Array(b|0);for(t=0;t<b;t++)W[t]=l(t*e,y,u,p,E,H,ma);return W};var p=0;this.Q={Ya:function(b){4>
b%f&&(p=2*Math.random()-1);return p},gb:Math.random,$a:Math.sin,ab:function(b){return H(b)+0.5*H(b/2)+0.3*H(b/4)},Za:function(b){return 2*(b/f-(b/f+0.5|0))},Ma:function(b,e){return H(b)>e?1:H(b)<e?-1:e}}}).apply(ka);var Ja={};
(function(){this.ia=[];this.fa={square:ka.Q.Ma,saw:ka.Q.Za,sine:ka.Q.$a,noise:ka.Q.Ya,synth:ka.Q.ab};this.Ua=function(){var b=[],y;for(y in this.fa)b.push(y);return b};this.Va=function(){function b(b,e,u,t,H){void 0===H&&(H=(u-e)/1E3);b={name:b,id:b.replace(/ /g,""),min:e,max:u,step:H,Ta:t,type:"range",group:n};y.push(b)}var y=[],n=0,u=this.Ua();(function(b,e,u){b={name:b,id:b.replace(/ /g,""),options:e,Ta:u,type:"option",group:n};y.push(b)})("Generator",u,u[0]);b("SuperSamplingQuality",0,16,0,1);
b("MasterVolume",0,1,0.4);n++;b("AttackTime",0,1,0.1);b("SustainTime",0,2,0.3);b("SustainPunch",0,3,2);b("DecayTime",0,2,1);n++;b("MinFrequency",20,2400,0,1);b("StartFrequency",20,2400,440,1);b("MaxFrequency",20,2400,2E3,1);b("Slide",-1,1,0);b("DeltaSlide",-1,1,0);n++;b("VibratoDepth",0,1,0);b("VibratoFrequency",0.01,48,8);b("VibratoDepth Slide",-0.3,1,0);b("VibratoFrequencySlide",-1,1,0);n++;b("ChangeAmount",-1,1,0);b("ChangeSpeed",0,1,0.1);n++;b("SquareDuty",0,0.5,0);b("SquareDutySweep",-1,1,0);
n++;b("RepeatSpeed",0,0.8,0);n++;b("PhaserOffset",-1,1,0);b("PhaserSweep",-1,1,0);n++;b("LPFilterCutoff",0,1,1);b("LPFilterCutoffSweep",-1,1,0);b("LPFilterResonance",0,1,0);b("HPFilterCutoff",0,1,0);b("HPFilterCutoffSweep",-1,1,0);return y};this.Ga=function(b){var y=2*Math.PI,n=Math.sin,u=Math.pow,l=Math.abs,e=ka.Ea,E=b.SuperSamplingQuality|0;1>E&&(E=1);for(var e=e*E,t=[{P:0,ba:1,time:b.AttackTime},{P:1+b.SustainPunch,ba:1,time:b.SustainTime},{P:1,ba:0,time:b.DecayTime}],H=t.length,f=0;f<H;f++)t[f].aa=
1+(t[f].time*e|0);for(var p=void 0,L=0,M=-1,da=0,ua=-1,V=0,f=0;f<H;f++)V+=t[f].aa;V<e/2&&(V=e/2);var G=Array(V/E|0),N=0,la=0,ma=Ja.fa[b.Generator];void 0===ma&&(ma=this.fa.Ma);var W=0,W=b.SquareDuty,Pa=b.SquareDutySweep/e,ea=0,U=b.StartFrequency*y/e,$=1+64*u(b.Slide,3)/e,F=u(b.DeltaSlide,3)/(1E3*e);void 0!==E&&(F/=E);b.MinFrequency>b.StartFrequency&&(b.MinFrequency=b.StartFrequency);b.MaxFrequency<b.StartFrequency&&(b.MaxFrequency=b.StartFrequency);for(var va=b.MinFrequency*y/e,ga=b.MaxFrequency*
y/e,Ka=0,na=b.VibratoFrequency*y/e,X=b.VibratoDepth,La=1+3*u(b.VibratoFrequencySlide,3)/e,ba=b.VibratoDepthSlide/e,wa=0,Fa=b.ChangeSpeed*e,oa=u(b.ChangeAmount,2),oa=0<b.ChangeAmount?1+10*oa:1-0.9*oa,xa=Array(1024),f=0;1024>f;f++)xa[f]=0;var ya=0,aa=1020*u(b.PhaserOffset,2),ha=4E3*u(b.PhaserSweep,3)/e,Qa=1E-5<l(ha)||1E-5<l(aa),O=0.0010<b.HPFilterCutoff||0.999>b.LPFilterCutoff,I=0,v=0,R=u(b.LPFilterCutoff,3)/10,Ra=1+b.HPFilterCutoffSweep/1E4,C=5/(1+20*u(b.LPFilterResonance,2))*(0.01+b.LPFilterCutoff);
0.8<C&&(C=0.8);var C=1-C,za=0.999>b.LPFilterCutoff,Aa=0,Y=u(b.HPFilterCutoff,2)/10,Sa=1+b.HPFilterCutoffSweep/1E4,Ba=0,z=V;0<b.RepeatSpeed&&(z=u(1-b.RepeatSpeed,2)*e+32);for(var q=b.MasterVolume,Ga=0,f=0;f<V;f++)N=ma(ea,W,0),W+=Pa,0>W?W=0:0.5<W&&(W=0.5),Ba>z&&(ea=0,U=b.StartFrequency*y/e,$=1+3*u(b.Slide,3)/e,F=u(b.DeltaSlide,3)/(1E3*e),void 0!==E&&(F/=E),wa=0,Fa=b.ChangeSpeed*e,oa=1+(b.ChangeAmount|0)/12,Ba=0),Ba+=1,ea+=U,$+=F,U*=$,wa>Fa&&(U*=oa,Fa=V),wa+=1,U>ga?U=ga:U<va&&(U=va),Ka+=na,p=U*n(Ka)*
X,ea+=p,na*=La,ba&&(X+=ba,0>X?ba=X=0:1<X&&(X=1,ba=0)),O&&(0.0010<l(Y)&&(Y*=Sa,1E-5>Y?Y=1E-5:0.1<Y&&(Y=0.1)),p=I,R*=Ra,0>R?R=0:0.1<R&&(R=0.1),za?(v+=(N-I)*R,v*=C):(I=N,v=0),I+=v,Aa+=I-p,N=Aa*=1-Y),Qa&&(aa+=ha,0>aa&&(aa=-aa,ha=-ha),1023<aa&&(aa=1023,ha=0),xa[ya]=N,N+=xa[ya-(aa|0)+1024&1023],ya=ya+1&1023),f>ua&&(M+=1,p=M<H?t[M]:{P:0,ba:0,aa:V},L=p.P,da=(p.ba-p.P)/(p.aa+1),ua+=p.aa),N*=L,L+=da,N*=q,1<E?(la+=N,0===(f+1)%E&&(G[Ga]=la/E,Ga+=1,la=0)):G[f]=N;b=e/100|0;y=Array(b);for(f=0;f<b;f++)y[f]=0;return y.concat(G).concat(y)};
this.ia=this.Va()}).apply(Ja);var eb={};(function(){this.Fa=function(b){b=Ja.Ga(this.Sa(b));return ka.Xa(b)};this.Sa=function(b){for(var y={},n=Ja.ia.length,u=0;u<n;u++)y[Ja.ia[u].id]=b[u];return y}}).apply(eb);(function(){var b,y,n,u;function l(c,a,b){c.addEventListener?c.addEventListener(a,b,!1):c.attachEvent?c.attachEvent("on"+a,b):c["on"+a]=b}function e(c,a,b,d,e,f){var h=za[c].frame,n=za[c].g;c=za[c].frames;d=f?c[Math.floor(f*d/1E3)%c.length]:c[d];e?m.drawImage(Ta,pb-(h.x+d.x)-d.a,h.y+d.y,d.a,d.b,a+n.x,b+n.y,d.a,d.b):m.drawImage(pa,h.x+d.x,h.y+d.y,d.a,d.b,a+n.x,b+n.y,d.a,d.b)}function E(c,a,b,d,e,h){var f=za[a].frame;a=za[a].g;c.drawImage(pa,f.x,f.y,e||f.a,h||f.b,b+a.x,d+a.y,a.a,a.b)}function t(c,a){var b=
c-h.Y.left,d=a-h.Y.top,b=Math.max(0,Math.min(b,O-1)),d=Math.max(0,Math.min(d,I-1));return[b,d]}function H(c,a,b,d,e,f,h){var m=c.fillStyle,k=c.textAlign,n=c.font;c.fillStyle=e;c.font=h;c.textAlign=f;for(a=a.slice();0<a.length;)c.fillText(a.shift(),b,d),d+=10;c.fillStyle=m;c.font=n;c.textAlign=k}function f(c){ca.style.cursor=c?"auto":"none"}function p(c,a){if(Y)try{Ma[c]=eb.Fa(a)}catch(b){}}function L(c){if(Y)try{Ma[c]&&(Ma[c].pause(),Ma[c].currentTime=0,Ma[c].play())}catch(a){}}function M(c,a){var b=
document.getElementById(c);l(b,Ua,function(c){c.preventDefault();ia.Ka({keyCode:a})});l(b,fb,function(c){c.preventDefault();ia.La({keyCode:a})})}function da(c,a,b,d){var e=Object.create(Ab);e.position=a;e.text=[c];e.color=b;e.time=qa+Bb;e.Ha=d||!1;Na.push(e)}function ua(c,a,b,d,e){var f=Object.create(Cb);f.position=c.slice();f.d=a.slice();f.color=b;f.time=qa+Db;f.size=d;f.speed=e;Ca.push(f)}function V(c){var a=c[s.ca],b,d,e,f;Va.T=a;for(var h=Q.length=0;h<c[s.h].length;h++)b=c[s.h][h],d=Object.create(Va),
d.size=b,e=document.createElement("canvas"),e.width=Ha+b,e.height=Ha+b,f=e.getContext("2d"),f.fillStyle="#ea0",f.strokeStyle="#330",f.fillRect(0,0,Ha+b,Ha+b),f.strokeRect(0,0,Ha+b,Ha+b),f.fillStyle="#000",f.fillText(b,5,10),d.ma=e,e=a[0]+16*h,b=a[1]-b,d.position=[e,b],d.T=[e,b],Q.push(d)}function G(c){c=h.o=B[c]||B[x];a.position=c[s.ha].slice();a.u=0;a.v=0;a.oa=0;a.c=void 0;a.Z=qb;a.w=!1;a.G=!1;a.r=!1;a.e=!1;a.j=!1;d.$=rb;d.i=0;d.A=0;d.position=c[s.U].slice();d.d=c[s.U].slice();b=c[s.L].slice();y=
[c[s.L][0]+15,c[s.L][1]+23];n=y.slice();u=1;D.position=D.d=null;D.na=gb;h.time=0;la(A.k);S=0;Da.length=0;ra.length=0;Na.length=0;Ca.length=0;fa="4444444444444444444444444444444444444444"+c[s.ga]+"4444444444444444444444444444444444444444";fa=fa.split("");Ia=null;V(c);Wa=Sa.slice();window.localStorage&&(window.localStorage.za=JSON.stringify(B));N()}function N(){var c,a;for(c=0;c<R;c++)for(a=0;a<Ra;a++)aa(Eb,fa[R*a+c],c*v,a*v)}function la(c){h.state=c;if(T){var a=document.getElementsByClassName("edit");
c="btn edit"+(c===A.f?"":" h");for(var b=0;b<a.length;b++)a[b].setAttribute("class",c)}}function ma(c){la(A.l);h.time=qa+h.o[s.n];Y&&(Xa=c+Ba);f()}function W(c){h.ka+=1;f(!0);L(z.Da);Ya=!0;G(x);Za=c+Ga}function Pa(c){h.la+=1;f(!0);L(z.wa);Ya=!1;G(x);Za=c+Ga}function ea(c,a){return Math.round(c[0]/v)===Math.round(a[0]/v)&&Math.round(c[1]/v)===Math.round(a[1]/v)}function U(c,a){return Math.atan((a[1]-c[1])/(a[0]-c[0]))}function $(c,a){return c&&a&&Math.sqrt(Math.pow(c[0]-a[0],2)+Math.pow(c[1]-a[1],
2))}function F(a,b){return fa[R*Math.floor(b/v)+Math.floor(a/v)]}function va(a,b,d,e,f){var h=b,m=F(a,h);d=a+d;topRight=F(d,h);bottomRight=F(d,b+e);bottomLeft=F(a,b);return m===f||topRight===f||bottomRight===f||bottomLeft===f}function ga(a,b,d,e,f){b+=e;e=F(a,b);bottomLeft=F(a+d,b);return e===f||bottomLeft===f}function Ka(){var c=a.v,b=na();if(a.e)c=a.v;else if(a.r)c=Math.min(b,c+b/25);else if(c*=Math.min(0.2*b,0.8),0.2>c||X(K.q))c=0;a.v=c;return X(K.q)?b/2:c}function na(){return Math.max(1,a.speed+
a.S-(void 0!==a.c?Q[a.c].size:0))}function X(c){return va(a.position[0]-8,a.position[1]-32,16,32,c)||va(a.position[0],a.position[1]-8,0,0,c)}function La(a){a&&a.preventDefault();if(h.state===A.f)hb=!hb;else if(h.state===A.l&&d.A<qa){a=t(w[0],w[1]);var b=d.i;if((ga(d.position[0]-8,d.position[1]-8,16,16,K.C)||va(d.position[0],d.position[1],0,0,K.C))&&d.i<Fb)L(z.ea),d.i++,da("+"+(d.i-b)+"\u21a1",[d.position[0]-4,d.position[1]-4],"#0c0");else{var e;for(e=0;e<Da.length;e++)if(ea(a,Da[e].position)){d.i=
Math.max(d.i,Gb);da("+"+(d.i-b)+"\u21a1",[d.position[0]-4,d.position[1]-4],"#0c0");L(z.ea);Da.splice(e,1);break}}}}function ba(){if(h.state===A.f)if(S<Ea){var c=R*Math.floor(w[1]/v)+Math.floor(w[0]/v);c<fa.length&&(fa[c]=""+S);N()}else if(S===sa.Aa)a.position=w.slice();else if(S===sa.B)d.position=w.slice();else if(S===sa.K)b=w.slice(),y=[b[0]+15,b[1]+23],n=y.slice();else{if(S===sa.h)for(Va.T=w.slice(),c=0;c<Q.length;c++){var e=Q[c];e.position[0]=w[0]+16*c;e.position[1]=w[1]-e.size}}else h.state!==
A.k||T?0<d.i&&d.A<qa&&(d.i--,L(z.ua),c=Object.create(Hb),c.position=d.position.slice(),ra.push(c)):w[0]>d.position[0]-16&&(w[0]<d.position[0]+16&&w[1]>d.position[1]-16&&w[1]<d.position[1]+16)&&ma(qa)}function wa(a){for(var b=60;0<b--;)ua(d.position,[d.position[0]-Math.floor(128*Math.random()-64),d.position[1]+Math.ceil(128*Math.random()-64)],"#000",Math.ceil(3*Math.random()),Math.ceil(2*Math.random()));d.A=a+Ib;L(z.ta);d.i=0;d.$--;da("-1\u2665",[d.position[0]-4,d.position[1]-4],"#c00");0>=d.$?W(a):
oa(a);ib=a+sb}function Fa(a){if(!Ia){Ia=[];for(var b=0;b<fa.length;b++)fa[b]===K.D&&Ia.push(b)}b=Ia[Math.floor(Math.random()*Ia.length)]+1;b=[b%R*v,Math.floor(b/R)*v];D.d=[b[0]-6,b[1]-10];D.position?L(z.ra):D.position=D.d.slice();D.Ja=a+Jb;u+=0.05}function oa(a){D.position||0<--D.na||(D.na=gb,L(z.qa),Fa(a),N())}function xa(c,d){for(var e=80;0<e--;)ua(a.position,[a.position[0]-Math.floor(128*Math.random()-64),a.position[1]-16-Math.ceil(128*Math.random()-64)],0.4>Math.random()?"#330":"#ea0",Math.ceil(3*
Math.random()),Math.ceil(4*Math.random()));da(0.5<Math.random()?"My mirrors!":"Be careful!",[b[0]+4,b[1]],"#fff",!0);L(z.Ba);a.c=void 0;c.position=c.T.slice();a.Z--;da("-1\u25fc",[a.position[0]-4,a.position[1]-32],"#c00");ib=d+sb;0>=a.Z?Pa(d):oa(d)}function ya(a){var b=a||B[x];a=[a?b[s.m]:"CustomLevel"+Kb++,b[s.ha].slice(),b[s.U].slice(),b[s.ca].slice(),b[s.L].slice(),b[s.n],b[s.ga],b[s.h].slice(),null,!0];B.push(a);h.state===A.k&&(x=B.length-1,G(x))}function aa(a,b,d,e){var f=null,h=D.position?"rgb("+
Math.pow(e,2)+","+Math.floor(e/3)+","+Math.floor(e)+")":"rgb("+Math.floor(e/3)+","+Math.floor(e)+","+Math.pow(e,2)+")";b===K.D?f=C.D:b===K.O?f=C.O:b===K.Ra?h="#000":b===K.xa?h="#0f0":b===K.C?f=C.C:b===K.q?f=C.q:b===K.s&&(f=C.s);a.fillStyle=h;a.fillRect(d,e,v,v);null!==f&&E(a,f,d,e,v,v)}function ha(a,b,d){if(a.position&&a.d){var e=U(a.position,a.d),f=a.position[0]>a.d[0]?-1:1,h=Math.abs(a.position[0]-a.d[0]),m=Math.abs(a.position[1]-a.d[1]);return h>b||m>b?(b=Math.cos(e)*f*d,d*=Math.sin(e)*f,Math.abs(b)>
h&&(b=h*b/Math.abs(b)),Math.abs(d)>m&&(d=m*d/Math.abs(d)),a.position[0]+=b,a.position[1]+=d,!0):!1}}function Qa(c){if(!(Za>c)){var r=ia.R;if(h.state===A.k)if(r[q.W]&&!Z)x=(x+B.length-1)%B.length,G(x);else if(r[q.X]&&!Z)x=(x+1)%B.length,G(x);else if(r[q.I]&&!Z)B[x][s.V]||ya(),la(A.f),r[q.I]=void 0;else if(r[q.H]&&!Z)B[x][s.V]&&(B.splice(x,1),x--,G(x)),r[q.H]=void 0;else if(r[q.J]&&B[x][s.V]&&!Z){var l=prompt("JSON",JSON.stringify(B[x]));r[q.J]=void 0}else{if(r[q.N]){if(l=prompt("JSON"))try{ya(JSON.parse(l))}catch(t){alert("Error")}r[q.N]=
void 0}}else{if(h.state===A.f){var p=c;if(!Z){if(r[q.W])S=(S+jb-1)%jb;else if(r[q.X])S=(S+1)%jb;else if(r[q.h]){try{if(l=JSON.parse(prompt("Crates",JSON.stringify(B[x][s.h]))),l instanceof Array){for(p=0;p<l.length;p++)"number"===!typeof p&&alert("Error"),l[p]=Math.max(1,Math.min(5,l[p]));B[x][s.h]=l;V(B[x])}}catch(M){alert("Error")}r[q.h]=void 0}else r[q.m]?((l=prompt("Name",B[x][s.m]))&&(B[x][s.m]=l),r[q.m]=!1):r[q.n]&&(p=+prompt("Time",B[x][s.n]),!isNaN(p)&&0<p&&(B[x][s.n]=p),r[q.n]=!1);T&&(r[q.H]&&
!Z)&&ba();T&&(r[q.J]&&!Z)&&La()}}else if(h.state===A.l){r[q.ja]?X(K.q)?(a.position[1]=Math.min(I-v,a.position[1]-a.Ia),a.F=!0):a.G||a.e||(a.p=a.Wa,a.G=!0,a.e=!0,a.F=!1,L(z.ya)):!r[q.ja]&&a.G?(a.G=!1,a.F=!1):r[q.va]&&X(K.q)?(a.position[1]=Math.min(I,a.position[1]+a.Ia),a.F=!0):a.F=!1;r[q.W]&&!a.e?(a.r=!0,a.j=!0):r[q.X]&&!a.e?(a.r=!0,a.j=!1):a.r=!1;if(a.r||0<a.v)a.position[0]=Math.min(O-v,Math.max(v,a.position[0]+(a.j?-1:1)*Ka()));if(!r[q.N]||a.G||a.e||a.w)r[q.I]&&!a.w?(a.w=!0,0<a.u&&(a.u--,a.S=Lb,
a.oa=c+Mb,l=Object.create(Nb),l.position=[a.position[0]+4,a.position[1]-7],Da.push(l),L(z.pa))):r[q.N]||(r[q.I]||!a.w)||(a.w=!1);else a:if(a.w=!0,l=a.c,p=void 0!==l?Q[l]:void 0,void 0===p){for(l=0;l<Q.length;l++)if(ea(a.position,Q[l].position)){a.c=l;L(z.da);break a}X(K.s)&&a.u<kb&&(da("+"+(kb-a.u)+"\u00a7",[a.position[0]-4,a.position[1]-32],"#0c0"),a.u=kb,L(z.s))}else a.c=void 0,L(z.da),X(K.xa)&&void 0!==p&&(Q.splice(l,1),da(0.5<Math.random()?"Thank you!":"Good boy!",[b[0]+4,b[1]],"#fff",!0),0>=
Q.length?W(c):L(z.sa));T&&(r[q.H]&&!Z)&&ba();T&&(r[q.J]&&!Z)&&La()}r[q.k]&&(f(!0),h.state===A.f&&(B[x][s.ga]=fa.join("").substring(R,R*Ra-R),B[x][s.ha]=a.position.slice(),B[x][s.U]=d.position.slice(),B[x][s.L]=b.slice(),B[x][s.ca]=Va.T.slice()),G(x))}Z=!1;for(var F in ia.R)Z=Z||!!ia.R[F];if(lb&&ta){var J;if(ta.clientX)J=ta;else if(ta instanceof TouchList)for(F=0;F<ta.length;F++)if(r=ta[F],r.clientX>=ja.left&&r.clientX<ja.left+ja.width&&r.clientY>=ja.top&&r.clientY<ja.top+ja.height){J=ta[F];break}if(J){J=
[J.clientX-ja.left,J.clientY-ja.top];r=U(tb,J);F=$(tb,J)/12.5;var k;h.state===A.l?k=d.d:h.state===A.f&&(k=w);k&&(k[0]+=(h.state===A.f?Math.round(Math.cos(r)):Math.cos(r))*(100>J[0]?-F:F),k[1]+=(h.state===A.f?Math.round(Math.sin(r)):Math.sin(r))*(100>J[0]?-F:F),k[0]=Math.max(0,Math.min(k[0],O-1)),k[1]=Math.max(0,Math.min(k[1],I-1)));hb&&ba()}}}qa=c;h.Y=ca.getBoundingClientRect();try{Xa<c&&h.state===A.l&&0<Wa.length&&(ub[Wa.shift()].play(),Xa+=Ba)}catch(Y){}if(h.state===A.l){J=2;var g;k=0;if(!a.e&&
ga(a.position[0]-4,a.position[1],8,0,K.D))g=a.position[1]-a.position[1]%v;else for(;J<=a.p;){if(ga(a.position[0]-4,a.position[1]+J,8,0,K.D)){g=a.position[1]+J-(a.position[1]+J)%v;break}J+=v}g?(a.position[1]=g,a.e&&(a.v/=2,g=void 0!==a.c&&Q[a.c])&&(J=Ob-g.size,k=g.size,a.p>J&&xa(g,c)),a.e=!1,a.p>10-2*k&&L(z.Ca),a.p=0):ga(a.position[0]-4,a.position[1]-32,8,16,K.q)?(a.e=!1,a.p=0):(a.p+=0.6,a.e=!0,a.position[1]+=a.p);a.oa<c&&0<a.S&&(a.S=0);void 0!==a.c&&(Q[a.c].position[0]=a.position[0]+vb[0],Q[a.c].position[1]=
a.position[1]+vb[1]);g=ga(d.position[0],d.position[1],0,0,K.C)?y:d.position;k=U(n,g);J=n[0]>g[0]?-1:1;if(Math.abs(g[0]-n[0])>mb||Math.abs(g[1]-n[1])>mb)n[0]+=Math.cos(k)*J*u,n[1]+=Math.sin(k)*J*u;if(ha(d,Pb,Qb))for(g=3;0<g--;)ua(d.position,d.d,"#000",Math.ceil(2*Math.random()),Math.ceil(3*Math.random()));for(g=0;g<ra.length;g++)if(k=ra[g],k.position[1]+=k.speed,ea(a.position,k.position)&&void 0!==a.c)xa(Q[a.c],c),ra.splice(g,1),g--;else if(k.position[1]>I||ga(k.position[0],k.position[1],0,0,K.O))ra.splice(g,
1),g--;d.A<c&&(na()*nb+wb>=$(d.position,a.position)||va(d.position[0],d.position[1],0,0,K.O)||$(n,d.position)<mb)&&wa(c);D.position&&(void 0!==a.c&&15>$(a.position,D.position)?(xa(Q[a.c],c),D.position=null,N()):d.A<c&&15>$(d.position,D.position)?(wa(c),D.position=null,N()):(ha(D,Rb,Sb),D.Ja<c&&Fa(c)));for(k=0;k<Ca.length;k++)if(g=Ca[k],!ha(g,3,g.speed)||g.time<c)Ca.splice(k,1),k--;h.time<c&&Pa(c)}h.Y=ca.getBoundingClientRect();m.fillStyle="#000";m.fillRect(0,0,O,I);k=g=0;ib>c&&(g=Math.floor(8*Math.random()-
4),k=Math.floor(8*Math.random()-4));m.drawImage($a,g,k);for(k=0;k<Q.length;k++)k!==a.c&&(g=Q[k],m.drawImage(g.ma,g.position[0]-8,g.position[1]-8));for(k=0;k<Da.length;k++)g=Da[k],E(m,C.Pa,g.position[0]-8,g.position[1]-8);for(k=0;k<ra.length;k++)g=ra[k],E(m,C.Qa,g.position[0]-8,g.position[1]-8);E(m,C.K,b[0],b[1]);if(h.o[s.M])for(g=0;g<h.o[s.M].length;g++)H(m,h.o[s.M][g][2],h.o[s.M][g][0],h.o[s.M][g][1],"#000");D.position&&E(m,5<$(D.position,D.d)?C.Oa:C.Na,D.position[0]-8,D.position[1]);h.state===A.l?
(a.e?e(C.t,a.position[0]-8,a.position[1]-24,0,a.j):a.r||a.F?e(C.t,a.position[0]-8,a.position[1]-24,10,a.j,c):e(C.t,a.position[0]-8,a.position[1]-24,1,a.j),a.S&&(a.e||a.r)&&(m.globalAlpha=0.6,e(C.t,a.position[0]+(a.j?-4:-12),a.position[1]-24,10,a.j,c),m.globalAlpha=0.3,e(C.t,a.position[0]+(a.j?2:-18),a.position[1]-24,10,a.j,c),m.globalAlpha=1)):e(C.t,a.position[0]-8,a.position[1]-24,1);void 0!==a.c&&(g=Q[a.c],m.drawImage(g.ma,a.j?g.position[0]+2:g.position[0]-15-g.size,g.position[1]-10));na()*nb+Tb>=
$(d.position,a.position)&&(m.beginPath(),m.arc(a.position[0],a.position[1],na()*nb+wb,0,360),m.lineWidth=2,m.strokeStyle="#f00",m.stroke());h.state===A.l?d.A>c&&0===Math.floor(c/100)%2||e(C.B,d.position[0]-8,d.position[1]-8,2,!1,c):e(C.B,d.position[0]-8,d.position[1]-8,0);m.fillStyle=D.position?"#00f":"#f00";m.fillRect(n[0]-1,n[1]-1,2,2);m.beginPath();m.arc(n[0],n[1],5,0,360);m.lineWidth=2;m.strokeStyle=D.position?"#00f":"#f00";m.stroke();m.fillStyle="#fff";h.state===A.l?(k=Math.max(0,Math.ceil((h.time-
c)/1E3)),g=k%60,k=Math.floor(k/60),10>g&&(g="0"+g),m.fillText("\u00a7 "+a.u+"   \u25fc "+a.Z+"   \u2732 "+k+":"+g,50,396),m.fillText("\u21a1 "+d.i+"   \u2665 "+d.$,540,12),m.fillStyle="#00deff",m.fillText("LUKE",10,396),m.fillStyle="#f00",m.fillText("CROW",600,12)):h.state===A.f&&m.fillText("< > CHANGE BLOCK   C: CRATES   T: TIME ("+B[x][s.n]+")   N: NAME ("+B[x][s.m]+")"+(T?"   S: PAINT   A: TOGGLE PAINT   analogPad: MOVE":""),12,12);for(k=0;k<Ca.length;k++)g=Ca[k],m.fillStyle=g.color,m.fillRect(g.position[0],
g.position[1],g.size,g.size);for(k=0;k<Na.length;k++)g=Na[k],g.time<c?(Na.splice(k,1),k--):(H(m,g.text,g.position[0]+1,g.position[1]+1,"#000","center","14px sans-serif"),H(m,g.text,g.position[0],g.position[1],g.color,"center","14px sans-serif"),g.Ha||(g.position[1]-=0.5));h.state===A.k&&(g=h.o,P.fillStyle="rgba(0,0,0,0.7)",P.clearRect(0,0,O,I),P.fillRect(0,0,O,I),P.fillStyle="#fff",P.textAlign="center",P.font="20px courier",P.fillText(h.o[s.m],O/2,I/2-50),H(P,["Luke "+h.ka],O/2-50,I/2,!0===Ya?"#0f0":
"#fff","right"),H(P,[h.la+" Crow"],O/2+50,I/2,!1===Ya?"#0f0":"#fff","left"),P.font="15px courier",P.fillText("A 13kB game by Alberto Congiu",O/2,12),Za<c&&(P.fillText("Click the "+(T?"screen":"crow")+" to start",O/2,I/2+60),P.fillText("< >: Select level",O/2,I/2+100),P.fillText(g[s.V]?"E: EDIT   "+(T?"S":"D")+": DELETE   "+(T?"A":"J")+": EXPORT   I: IMPORT":"E: EDIT   I: IMPORT",O/2,I/2+120)),P.beginPath(),P.arc(d.position[0],d.position[1],16,0,360),P.lineWidth=2,P.strokeStyle="#fff",P.stroke(),m.drawImage(ab,
0,0));h.state===A.f&&(m.globalAlpha=0.6,S<Ea?(aa(m,""+S,w[0]-w[0]%v,w[1]-w[1]%v),m.strokeStyle="#000",m.strokeRect(w[0]-w[0]%v,w[1]-w[1]%v,v,v)):S===sa.Aa?e(C.t,w[0]-8,w[1]-24,1):S===sa.B?e(C.B,w[0]-8,w[1]-8,0):S===sa.K?E(m,C.K,w[0],w[1]):S===sa.h&&(m.fillStyle="#ea0",m.strokeStyle="#330",m.fillRect(w[0]-8,w[1]-8,16,16),m.strokeRect(w[0]-8,w[1]-8,16,16),m.fillStyle="#000",m.fillText("C",w[0]-4,w[1]+4)),m.globalAlpha=1);window.requestAnimationFrame(Qa)}var O=640,I=400,v=16,R=O/v,Ra=I/v,C={B:0,Pa:1,
s:2,K:3,q:4,t:5,C:6,O:7,Qa:8,D:9,Na:10,Oa:11},za=[{frame:{x:30,y:0,a:30,b:14},g:{x:1,y:1,a:30,b:14},frames:[{x:1,y:1,a:15,b:11},{x:17,y:1,a:15,b:13}]},{frame:{x:14,y:40,a:14,b:8},g:{x:1,y:7,a:14,b:8}},{frame:{x:32,y:14,a:16,b:16},g:{x:0,y:0,a:16,b:16}},{frame:{x:0,y:24,a:14,b:24},g:{x:1,y:7,a:14,b:24}},{frame:{x:16,y:48,a:16,b:16},g:{x:0,y:0,a:16,b:16}},{frame:{x:0,y:0,a:30,b:24},g:{x:1,y:3,a:30,b:24},frames:[{x:0,y:0,a:15,b:24},{x:16,y:0,a:13,b:24}]},{frame:{x:48,y:14,a:16,b:10},g:{x:0,y:10,a:16,
b:10}},{frame:{x:14,y:24,a:16,b:16},g:{x:0,y:0,a:16,b:16}},{frame:{x:31,y:32,a:6,b:14},g:{x:4,y:1,a:6,b:14}},{frame:{x:0,y:48,a:16,b:16},g:{x:0,y:0,a:16,b:16}},{frame:{x:36,y:32,a:11,b:13},g:{x:0,y:0,a:12,b:13}},{frame:{x:49,y:30,a:15,b:16},g:{x:0,y:0,a:15,b:16}}],Aa=[523.25,587.33,659.26,698.46,783.99,880,987.77,1046.5,1108.73],Y=!(!window.btoa||!window.atob),Sa="023123467".split(""),Ba=200,z={ya:0,Ba:1,ua:2,ta:3,da:4,sa:5,Da:6,wa:7,pa:8,ea:9,s:10,qa:11,ra:12,Ca:13},q={W:37,ja:38,X:39,va:40,I:69,
N:32,k:27,H:68,J:74,h:67,m:78,n:84},Ga=2E3,A={k:0,l:1,f:2},sb=500,Bb=1500,Db=1500,K={EMPTY:"0",D:"1",q:"2",O:"3",Ra:"4",xa:"5",C:"6",s:"7"},Ea=8,sa={Aa:Ea+0,B:Ea+1,K:Ea+2,h:Ea+3},jb=Ea+4,Lb=3,Mb=5E3,Tb=75,wb=25,nb=7,kb=3,Fb=3,Gb=5,Ib=5E3,rb=10,Qb=16,Pb=3,mb=3,Rb=3,gb=3,Sb=16,Jb=2E3,qb=10,Ha=12,vb=[1,-6],Ob=13,s={m:0,ha:1,U:2,ca:3,L:4,n:5,ga:6,h:7,M:8,V:9};(function(){for(var a=0,b=["webkit","moz"],d=0;d<b.length&&!window.requestAnimationFrame;++d)window.requestAnimationFrame=window[b[d]+"RequestAnimationFrame"];
window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var d=(new Date).getTime(),e=Math.max(0,16-(d-a)),f=window.setTimeout(function(){b(d+e)},e);a=d+e;return f})})();var T=!1,Oa=document.getElementById("o"),ja=Oa.getBoundingClientRect(),tb=[100,100],lb=!1,ta=null,Ua=null,fb=null,xb=null;if("ontouchstart"in document.documentElement||window.navigator.msMaxTouchPoints)for(var T=!0,Ua=window.navigator.msMaxTouchPoints?"MSPointerDown":"touchstart",fb=window.navigator.msMaxTouchPoints?
"MSPointerUp":"touchend",xb=window.navigator.msMaxTouchPoints?"MSPointerMove":"touchmove",ob=document.getElementsByClassName("btn"),bb=0;bb<ob.length;bb++)-1===ob[bb].getAttribute("class").indexOf("edit")&&ob[bb].setAttribute("class","btn");var ca=document.getElementById("C"),m=ca.getContext("2d"),pa=new Image,Ta=document.createElement("canvas"),pb=0,ab=document.createElement("canvas"),P=ab.getContext("2d"),$a=document.createElement("canvas"),Eb=$a.getContext("2d"),Ma=[],ub={},Wa=null,Xa=0,w=[0,0],
cb=!1,Z=!1,ia={R:{},La:function(a){ia.R[a.keyCode]=void 0},Ka:function(a){ia.R[a.keyCode]=qa}},qa=0,h={state:A.k,Y:ca.getBoundingClientRect(),time:0,ka:0,la:0,o:null},ib=0,Za=0,Ya=void 0,Ab={position:null,text:void 0,color:"#0f0",time:0,Ha:!1},Na=[],fa=[],Ia=null,hb=!1,S=0,a={position:null,speed:4,v:0,S:0,oa:0,Ia:2,Wa:-6.8,F:!1,G:!1,e:!1,r:!1,w:!1,p:0,c:void 0,u:0,Z:qb,bb:!1},d={position:null,d:null,i:0,A:0,$:rb};n=y=b=null;u=1;var D={position:null,d:null,Ja:0,na:gb},Va={ma:null,position:null,T:null,
size:1},Q=[],Nb={position:null},Da=[],Hb={position:null,speed:6},ra=[],Cb={position:null,d:null,color:"#000",time:0,size:2,speed:2},Ca=[],yb=[["Tutorial",[33,370],[O-24,55],[300,365],[20,70],3E6,"00000000000000000000000000000000000000000000000000000000000000000000000000000000330000000000000000000000000000000000006000000000000000000000000000000000000000110000000000033300000000000006000000000000110000000003330000000000001110000000000000000000000333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003333333333333333333333333333333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005500000000000000000000000000000000000000550000000000007000000000000002000000000111111111111111111111111111111200000000000000000000000000000000000000020000000000000000000000000000000000000002000000000000000000000000000000000000000200000000000000000000000000000000000000020000000001111111111111111111111111111111111111111",
[1],[[20,340,["PLAYER 1"]],[100,340,["ARROWS: move/jump"]],[250,340,[(T?"I":"SPACEBAR")+": grab/release crate"]],[500,340,["UP/DOWN: Climb"]],[450,250,["Crates break if you fall from too high"]],[160,250,[(T?"I":"SPACEBAR")+": buy candies when not holding crate","E: Use candy to gain speed"]],[10,230,["Deliver crate to green area"]],[560,30,["PLAYER 2",(T?"analogPad":"Mouse")+": move"]],[390,80,["Hide from granny in nest"]],[390,130,[(T?"A":"RClick")+": eat from nest or crumbs",(T?"S":"LClick")+": shoot!"]],
[150,70,["Don't touch roofs or Luke"]]]],["Level 1",[25,366],[616,24],[41,364],[513,180],6E4,"00000000000000000000000000000000000000600000000000000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000111000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000003330000000000000000000000000000000000003333300033000000000000000000000000000000000000000000000000000000000000000000000000550000020000000000000200000000000000000055020002000111111111120000333000000000111112000200133333330002000000000000000000000200021130000000000200000000000000000000020002000000000000020000000000000000000002000200020000000002111111100111001101111100111112000000000200000000000000000000000033333200000000000000000000000000000000000000020000000000000000000000000000000000000002000000000000000000000000000000000000000200000000000000000000000000000700001111111111111111111111111111111111111111",
[1,2]],["Level 2",[28,143],[600,296],[588,365],[51,50],12E4,"33330000000000000000000000000000000000000000000000000033000000000330000000000000055000000000000000000000000000000000000005500000000000000003030000000000000000001111111000000000000030000000000000110010000000010000000000000000000000000100301000000000000200000200000200000200000000100000000011120111102000201111021113002010111100000002000000020200000002000000211100000000000100000000200000000100000020000000000000000000000000000000000002002000000000000000000000000000000000030211100000001110000000000000000000000030020000000000000000000000003333300000000002000000000000000000000000000000000003020200000000000001100000000000000000000002110000000000000000000000000020700000020200000000000600000000000000112110000002020000060000111000010000000000200000000201000011100000000000000000000020000000020000000000000000000000000000002000000002000000000000000000000000000000200000000200000000001111111111111111111111111111111111111111",
[1,2]],["Level 3",[17,349],[281,39],[88,317],[49,163],24E4,"00000000000000010001000000000000000000000000000000300001666100003000000000000020000000000003000111110003000000000007002000000000000030000000003000000000001110203000000000000000000000000000000000000020332200000000000000000000000000000000002033202000000000000000000000000000000000203320320000000000222000000000000000000020332033111001111100011111000110011001102055200000000000000000000000000110011000205520000000000000000000000000000000000020111100000000000000000000000000000000002000000000000000030003000000000220022000200000000000000030000030000200000000000020000000000000000300030000020000000000002000003030300000000200000002011001100110200003030303030303020000000200011001100020000000000030303032111111000000000000000000000000000000000203030303030000000000000000011100070000023030303030300000000000000000000011100002000000000000000000000011110000000000000200000000000000000000001111111111111111111111111111111111111111",
[1,2,3]],["Level 4",[75,370],[O-24,24],[83,365],[80,53],3E5,"33333300000000000000000000000000000000600000000000000000000000000000000000000011055000000000000000000000003333000000000005500000000000000002000000000000000000001111110010011001111201110011110000000000000000000003300000000000000000100000000000000000000000000700000000000001000000000001110000000000111111000000000010020000002000000000000033333330000333330112100000200033333300000000000000000000000200000020000000000000000000000000000000020000002000000000000010101010111000020200000000211111111111111000000033311001111011100020033333333330000000000003300000033333002000000000000000000000000000000000000000200000000000000000200000000000020000000020111100111110011120111001111112011111002000000000000000000000000303030200000000000000000000000000007000000000020000000000333330003030300011110000200002000000000000000000000000000000000021111200000000000000000000000000000000002000000000001111111111111111111111111111111111111111",
[2,3,4]]],B=window.localStorage&&window.localStorage.za&&JSON.parse(window.localStorage.za)||yb,Kb=B.length-yb.length+1,x=0;pa.onload=function(){Ta.width=pb=pa.naturalWidth;Ta.height=pa.naturalHeight;var a=Ta.getContext("2d");a.translate(pa.naturalWidth,0);a.scale(-1,1);a.drawImage(pa,0,0);G(x);Qa(1)};pa.src="imgmap.png";ab.width=$a.width=O;ab.height=$a.height=I;for(var db=0;db<Aa.length;db++)ub[db]=eb.Fa(["synth",0,0.1,0,0.208,0,0.12,20,Aa[db],2400,0,0,0,0.01,3E-4,0,0,0,0,0,0,0,0,1,0,0,0.1,0]);Wa=
Sa.slice();p(z.ya,["square",0,0.3,0,0.174,0,0.28,20,497,2400,0.22,0,0,0.01,3E-4,0,0,0,0.0665,0,0,0,0,0.783,0,0,0,0]);p(z.Ba,["noise",0,0.3,0,0.14,0.405,0.116,20,479,2400,-0.07,0,0,0.01,3E-4,0,0,0,0,0,0,-0.086,-0.122,1,0,0,0,0]);p(z.sa,["square",0,0.3,0,0.098,0.504,0.282,20,1582,2400,0,0,0,0.01,3E-4,0,0,0,0,0,0,0,0,1,0,0,0,0]);p(z.pa,["saw",0,0.3,0,0.324,0,0.284,20,631,2400,0.172,0,0.498,19.35,3E-4,0,0,0,0,0,0,0,0,1,0,0,0,0]);p(z.ua,["saw",0,0.3,0,0.212,0,0.028,20,1169,2400,-0.52,0,0,0.01,3E-4,0,0,
0,0.5,-0.592,0,0.094,0.066,1,0,0,0.28,0]);p(z.wa,["synth",0,0.3,0,0.32,0.348,0.44,20,372,417,0,0,0,0.01,3E-4,0,0.374,0.264,0,0,0,0,0,1,0,0,0,0]);p(z.Da,["synth",0,0.3,0,0.13,0.345,0.41,253,1168,1407,-0.0060,-0.082,0,0.01,3E-4,0,0.206,0.166,0,0,0,0,0,1,0,0,0,0]);p(z.da,["noise",0,0.3,0,0.0020,0.024,0.09,20,372,2400,0,0,0,0.01,3E-4,0,-0.342,0.809,0,0,0,0,0,1,0,0,0,0]);p(z.ta,["noise",0,0.3,0,0.152,0.393,0.274,20,839,2400,-0.31,0,0,0.01,3E-4,0,-0.34,0.783,0,0,0.6096,0.526,-0.0080,1,0,0,0,0]);p(z.ea,
["square",0,0.3,0,0.04,0,0.048,20,578,2400,0.104,0,0.683,19.158,3E-4,0,0,0,0.385,0,0,0,0,1,0,0,0,0]);p(z.s,["square",0,0.3,0,0.046,0.477,0.24,20,1197,2400,0,0,0,0.01,3E-4,0,0.498,0.204,0,0,0,0,0,1,0,0,0,0]);p(z.qa,["synth",0,0.3,0,0.44,0.579,1.004,20,1793,2400,-0.202,0,0,8.6962,0.5346,0.666,-0.298,0.671,0,0,0,0,0,1,0,0,0,0]);p(z.ra,["noise",0,0.127,0.043,0.124,0,0.282,20,2400,20,1,-1,0,0.01,-0.3,-1,0.956,0.272,0,0.68,0,-0.998,-1,1,1,0,0,-0.998]);p(z.Ca,["noise",0,0.126,0,0.07,0,0.232,2400,2400,2400,
-1,-1,0,0.01,-0.3,-1,-1,0,0,-1,0,0.0040,0,1,1,0,0,-1]);window.addEventListener("keyup",ia.La,!1);window.addEventListener("keydown",ia.Ka,!1);if(T){l(ca,Ua,function(a){a.preventDefault();h.state===A.k&&ma()});M("x",q.k);M("e",q.I);M("l",q.W);M("u",q.ja);M("r",q.X);M("d",q.va);M("i",q.N);M("s",q.H);M("a",q.J);M("c",q.h);M("t",q.n);M("n",q.m);var zb=function(a){a.preventDefault();ta=a.changedTouches||a;ja=Oa.getBoundingClientRect();lb=!0};l(Oa,Ua,zb);l(Oa,xb,zb);l(Oa,fb,function(a){a.preventDefault();
lb=!1});l(document.body,"contextmenu",function(a){a.preventDefault()})}else l(ca,"click",ba),l(ca,"contextmenu",La),l(ca,"mousedown",function(a){1===a.which&&(cb=!0);h.state===A.f&&cb&&ba()}),l(ca,"mouseup",function(a){1===a.which&&(cb=!1)}),l(ca,"mousemove",function(a){w=t(a.clientX,a.clientY);h.state===A.l?d.d=w.slice():h.state===A.f&&cb&&ba()})})();

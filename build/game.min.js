var ja={};
(function(a){function z(a,c){return c?K(a&255)+z(a>>8,c-1):""}var A=this.Aa=a||44100,x=2*A,K=String.fromCharCode,k;this.Na=function(a){var c=Audio,u=btoa,m="",w=a.length;for(q=0;q<w;q++)var h=32767*a[q]|0,h=-32768>h?-32768:32767<h?32767:h,h=h+(0>h?65536:0),m=m+String.fromCharCode(h&255,h>>8);a=m;a=["RIFF",36+(k=a.length),"WAVEfmt ",16,1,1,A,x,2,16,"data",k,a];m="";for(q=0;q<a.length;q++)m+="s"=="s4s4224422s4s"[q]?a[q]:z(a[q],"s4s4224422s4s".charCodeAt(q)-48);return new c("data:audio/wav;base64,"+u(m))};
var c,q,u=Math.sin,h=2*Math.PI;this.filter=function(a,h,k,m,w,u,x,A,z,K){k=k?k:1;m=m?m:a.length;c=a.slice(0);for(q=k;q<m;q++)c[q]=h(a,c,k,m,q,w,u,x,A,z,K);return c};this.filters={Ta:function(a,c,h,k,w,q){return c[w-1]+q*(a[w]-c[w-1])},Ua:function(a,c,h,q,w,k){return c[w-1]+k*(q-w)/(q-h)*(a[w]-c[w-1])},Sa:function(a,c,h,q,k,u){return u*(c[k-1]+a[k]-a[k-1])}};this.Da=function(a,c,k,u,w,x,z,K,G){c=c*h/A;var N=Array(a|0);for(q=0;q<a;q++)N[q]=k(q*c,u,w,x,z,K,G);return N};var G=0;this.M={Oa:function(a){4>
a%h&&(G=2*Math.random()-1);return G},Va:Math.random,Qa:Math.sin,Ra:function(a){return u(a)+0.5*u(a/2)+0.3*u(a/4)},Pa:function(a){return 2*(a/h-(a/h+0.5|0))},Ea:function(a,c){return u(a)>c?1:u(a)<c?-1:c}}}).apply(ja);var Ea={};
(function(){this.ga=[];this.da={square:ja.M.Ea,saw:ja.M.Pa,sine:ja.M.Qa,noise:ja.M.Oa,synth:ja.M.Ra};this.Ja=function(){var a=[],z;for(z in this.da)a.push(z);return a};this.Ka=function(){function a(a,k,c,q,u){void 0===u&&(u=(c-k)/1E3);a={name:a,id:a.replace(/ /g,""),min:k,max:c,step:u,Ia:q,type:"range",group:A};z.push(a)}var z=[],A=0,x=this.Ja();(function(a,k,c){a={name:a,id:a.replace(/ /g,""),options:k,Ia:c,type:"option",group:A};z.push(a)})("Generator",x,x[0]);a("SuperSamplingQuality",0,16,0,1);
a("MasterVolume",0,1,0.4);A++;a("AttackTime",0,1,0.1);a("SustainTime",0,2,0.3);a("SustainPunch",0,3,2);a("DecayTime",0,2,1);A++;a("MinFrequency",20,2400,0,1);a("StartFrequency",20,2400,440,1);a("MaxFrequency",20,2400,2E3,1);a("Slide",-1,1,0);a("DeltaSlide",-1,1,0);A++;a("VibratoDepth",0,1,0);a("VibratoFrequency",0.01,48,8);a("VibratoDepth Slide",-0.3,1,0);a("VibratoFrequencySlide",-1,1,0);A++;a("ChangeAmount",-1,1,0);a("ChangeSpeed",0,1,0.1);A++;a("SquareDuty",0,0.5,0);a("SquareDutySweep",-1,1,0);
A++;a("RepeatSpeed",0,0.8,0);A++;a("PhaserOffset",-1,1,0);a("PhaserSweep",-1,1,0);A++;a("LPFilterCutoff",0,1,1);a("LPFilterCutoffSweep",-1,1,0);a("LPFilterResonance",0,1,0);a("HPFilterCutoff",0,1,0);a("HPFilterCutoffSweep",-1,1,0);return z};this.Da=function(a){var z=2*Math.PI,A=Math.sin,x=Math.pow,K=Math.abs,k=ja.Aa,c=a.SuperSamplingQuality|0;1>c&&(c=1);for(var k=k*c,q=[{L:0,Y:1,time:a.AttackTime},{L:1+a.SustainPunch,Y:1,time:a.SustainTime},{L:1,Y:0,time:a.DecayTime}],u=q.length,h=0;h<u;h++)q[h].V=
1+(q[h].time*k|0);for(var G=void 0,U=0,qa=-1,Da=0,m=-1,w=0,h=0;h<u;h++)w+=q[h].V;w<k/2&&(w=k/2);var Aa=Array(w/c|0),B=0,ra=0,Ba=Ea.da[a.Generator];void 0===Ba&&(Ba=this.da.Ea);var N=0,N=a.SquareDuty,ka=a.SquareDutySweep/k,F=0,P=a.StartFrequency*z/k,$=1+64*x(a.Slide,3)/k,da=x(a.DeltaSlide,3)/(1E3*k);void 0!==c&&(da/=c);a.MinFrequency>a.StartFrequency&&(a.MinFrequency=a.StartFrequency);a.MaxFrequency<a.StartFrequency&&(a.MaxFrequency=a.StartFrequency);for(var sa=a.MinFrequency*z/k,ea=a.MaxFrequency*
z/k,ta=0,Fa=a.VibratoFrequency*z/k,aa=a.VibratoDepth,La=1+3*x(a.VibratoFrequencySlide,3)/k,Ca=a.VibratoDepthSlide/k,fa=0,ga=a.ChangeSpeed*k,X=x(a.ChangeAmount,2),X=0<a.ChangeAmount?1+10*X:1-0.9*X,la=Array(1024),h=0;1024>h;h++)la[h]=0;var ua=0,V=1020*x(a.PhaserOffset,2),ma=4E3*x(a.PhaserSweep,3)/k,Ma=1E-5<K(ma)||1E-5<K(V),Q=0.0010<a.HPFilterCutoff||0.999>a.LPFilterCutoff,ba=0,Y=0,Z=x(a.LPFilterCutoff,3)/10,Ga=1+a.HPFilterCutoffSweep/1E4,ca=5/(1+20*x(a.LPFilterResonance,2))*(0.01+a.LPFilterCutoff);
0.8<ca&&(ca=0.8);var ca=1-ca,L=0.999>a.LPFilterCutoff,p=0,R=x(a.HPFilterCutoff,2)/10,v=1+a.HPFilterCutoffSweep/1E4,n=0,va=w;0<a.RepeatSpeed&&(va=x(1-a.RepeatSpeed,2)*k+32);for(var Na=a.MasterVolume,H=0,h=0;h<w;h++)B=Ba(F,N,0),N+=ka,0>N?N=0:0.5<N&&(N=0.5),n>va&&(F=0,P=a.StartFrequency*z/k,$=1+3*x(a.Slide,3)/k,da=x(a.DeltaSlide,3)/(1E3*k),void 0!==c&&(da/=c),fa=0,ga=a.ChangeSpeed*k,X=1+(a.ChangeAmount|0)/12,n=0),n+=1,F+=P,$+=da,P*=$,fa>ga&&(P*=X,ga=w),fa+=1,P>ea?P=ea:P<sa&&(P=sa),ta+=Fa,G=P*A(ta)*aa,
F+=G,Fa*=La,Ca&&(aa+=Ca,0>aa?Ca=aa=0:1<aa&&(aa=1,Ca=0)),Q&&(0.0010<K(R)&&(R*=v,1E-5>R?R=1E-5:0.1<R&&(R=0.1)),G=ba,Z*=Ga,0>Z?Z=0:0.1<Z&&(Z=0.1),L?(Y+=(B-ba)*Z,Y*=ca):(ba=B,Y=0),ba+=Y,p+=ba-G,B=p*=1-R),Ma&&(V+=ma,0>V&&(V=-V,ma=-ma),1023<V&&(V=1023,ma=0),la[ua]=B,B+=la[ua-(V|0)+1024&1023],ua=ua+1&1023),h>m&&(qa+=1,G=qa<u?q[qa]:{L:0,Y:0,V:w},U=G.L,Da=(G.Y-G.L)/(G.V+1),m+=G.V),B*=U,U+=Da,B*=Na,1<c?(ra+=B,0===(h+1)%c&&(Aa[H]=ra/c,H+=1,ra=0)):Aa[h]=B;a=k/100|0;z=Array(a);for(h=0;h<a;h++)z[h]=0;return z.concat(Aa).concat(z)};
this.ga=this.Ka()}).apply(Ea);var Sa={};(function(){this.Ca=function(a){a=Ea.Da(this.Ha(a));return ja.Na(a)};this.Ha=function(a){for(var z={},A=Ea.ga.length,x=0;x<A;x++)z[Ea.ga[x].id]=a[x];return z}}).apply(Sa);(function(){var a,z,A,x,K,k,c,q,u;function h(r,a){var b=new XMLHttpRequest;"withCredentials"in b?b.open(r,a,!0):"undefined"!=typeof XDomainRequest?(b=new XDomainRequest,b.open(r,a)):b=null;return b}function G(r,a,b,I,d){var e=O[r].frame;r=O[r].h;p.drawImage(na,e.x,e.y,I||e.b,d||e.c,a+r.x,b+r.y,r.b,r.c)}function U(r,a,b,I,d,e){var f=O[r].frame,c=O[r].h;r=O[r].frames;I=e?r[Math.floor(e*I/1E3)%r.length]:r[I];d?p.drawImage(Oa,$a-(f.x+I.x)-I.b,f.y+I.y,I.b,I.c,a+c.x,b+c.y,I.b,I.c):p.drawImage(na,f.x+I.x,
f.y+I.y,I.b,I.c,a+c.x,b+c.y,I.b,I.c)}function qa(a){a=a||Levels[v];a=["CustomLevel"+Na++,a[s.fa].slice(),a[s.ba].slice(),a[s.Z].slice(),a[s.s]&&a[s.s].slice(),a[s.k],a[s.ea],a[s.f].slice(),null,!0];Levels.push(a);g.state===y.e&&(v=Levels.length-1,B(v))}function Da(){if(Ta)try{g.state===y.j&&0<Ua.length&&(ab[Ua.shift()].play(),setTimeout(Da,200))}catch(a){}}function m(a,b){if(Ta)try{Ha[a]=Sa.Ca(b)}catch(c){}}function w(a){if(Ta)try{Ha[a]&&(Ha[a].pause(),Ha[a].currentTime=0,Ha[a].play())}catch(b){}}
function Aa(a){var b=a[s.Z],c,d,g,e;Ia.H=b;for(var f=M.length=0;f<a[s.f].length;f++)c=a[s.f][f],d=Object.create(Ia),d.size=c,g=document.createElement("canvas"),g.width=Pa+c,g.height=Pa+c,e=g.getContext("2d"),e.fillStyle="yellow",e.fillRect(0,0,Pa+c,Pa+c),e.fillStyle="black",e.fillText(c,5,10),d.ka=g,g=b[0]+16*f,c=b[1]-c,d.position=[g,c],d.H=[g,c],M.push(d)}function B(r){r=g.q=Levels[r]||Levels[v];sa(y.e);b.position=r[s.fa].slice();a=r[s.ba].slice();b.K=0;b.X=0;b.d=void 0;b.T=bb;b.B=!1;b.G=!1;b.a=
!1;b.n=!1;b.A=!1;z=cb;x=A=0;g.time=0;sa(y.e);H=0;r[s.s]?(c=r[s.s].slice(),q=[r[s.s][0]+15,r[s.s][1]+23],u=q.slice()):q=c=null;wa="4444444444444444444444444444444444444444"+r[s.ea]+"4444444444444444444444444444444444444444";wa=wa.split("");Aa(r);xa.length=0;oa.length=0;Qa.width=S;Qa.height=T;var t=Qa.getContext("2d");t.fillStyle="rgba(0,0,0,0.7)";t.fillRect(0,0,S,T);t.fillStyle="#fff";t.font="20px courier";t.textAlign="center";t.fillText(g.q[s.m],S/2,T/2-50);t.fillText("Delivery Boy "+g.ia+" - "+g.ja+
" Crow",S/2,T/2);t.font="15px courier";t.fillText("Click the "+(Q?"screen":"crow")+" to start!",S/2,T/2+60);t.fillText("< >: Select level",S/2,T/2+100);t.fillText(r[s.Q]?"E: edit   "+(Q?"1":"D")+": delete   "+(Q?"2":"J")+": insert/copy JSON"+(Ga?"   S: share":""):"E: edit",S/2,T/2+120);t.beginPath();t.arc(a[0],a[1],16,0,360);t.lineWidth=1;t.strokeStyle="#fff";t.stroke();Ua=db.slice();window.localStorage&&(window.localStorage.ta=JSON.stringify(Levels))}function ra(){g.ia+=1;L.style.cursor="auto";w(E.za);
B(v)}function Ba(){g.ja+=1;L.style.cursor="auto";w(E.pa);B(v)}function N(a){var b=a.clientX-g.S.left;a=a.clientY-g.S.top;b=Math.max(0,Math.min(b,S-1));a=Math.max(0,Math.min(a,T-1));return[b,a]}function ka(){return Math.max(1,b.speed+b.W-(void 0!==b.d?M[b.d].size:0))}function F(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c}function P(){sa(y.j);g.time=R+g.q[s.k];Da();L.style.cursor="none"}function $(){if(g.state===y.g)if(H<ya){var r=Math.floor(n[1]/
C);0<r&&r<Va-1&&(wa[za*r+Math.floor(n[0]/C)]=""+H)}else if(H===pa.ua)b.position[0]=n[0],b.position[1]=n[1];else if(H===pa.r)a[0]=n[0],a[1]=n[1];else if(H===pa.i&&c)c[0]=n[0],c[1]=n[1],q=[c[0]+15,c[1]+23],u=q.slice();else{if(H===pa.f)for(Ia.H[0]=n[0],Ia.H[1]=n[1],r=0;r<M.length;r++){var t=M[r];t.position[0]=n[0]+16*r;t.position[1]=n[1]-t.size}}else g.state!==y.e||Q?0<A&&x<R&&(A--,w(E.na),r=Object.create(jb),r.position=a.slice(),oa.push(r)):n[0]>a[0]-16&&(n[0]<a[0]+16&&n[1]>a[1]-16&&n[1]<a[1]+16)&&
P()}function da(b){b.preventDefault();if(g.state===y.g)Wa=!Wa;else if(g.state===y.j&&x<R)if(b=N(b),(ga(a[0]-8,a[1]-8,16,16,J.v)||fa(a[0],a[1],0,0,J.v))&&A<kb)w(E.aa),A++;else{var t;for(t=0;t<xa.length;t++)if(ta(b,xa[t].position)){A=Math.max(A,lb);w(E.aa);xa.splice(t,1);break}}}function sa(a){g.state=a;if(Q)if(a===y.g){a=document.getElementsByClassName("edit");for(var b=0;b<a.length;b++)a[b].setAttribute("class","btn edit")}else for(a=document.getElementsByClassName("edit"),b=0;b<a.length;b++)a[b].setAttribute("class",
"btn h edit")}function ea(a,b){return wa[za*Math.floor(b/C)+Math.floor(a/C)]}function ta(a,b){return Math.round(a[0]/C)===Math.round(b[0]/C)&&Math.round(a[1]/C)===Math.round(b[1]/C)}function Fa(){var a=b.d,c=void 0!==a?M[a]:void 0;if(void 0===c){for(a=0;a<M.length;a++)if(ta(b.position,M[a].position)){b.d=a;w(E.$);return}X(J.o)&&(b.K=mb,w(E.o))}else b.d=void 0,w(E.$),X(J.qa)&&void 0!==c&&(M.splice(a,1),0>=M.length?ra():w(E.ma))}function aa(){var a=b.U,c=ka();b.a||(a=0);a=Math.min(c,a+c/7);b.U=a;return X(J.p)?
c/2:a}function La(){L.style.cursor="auto";g.state===y.g&&(Levels[v][s.ea]=wa.join("").substring(za,za*Va-za),Levels[v][s.fa]=b.position.slice(),Levels[v][s.ba]=a.slice(),Levels[v][s.s]=c instanceof Array?c.slice():void 0,Levels[v][s.Z]=Ia.H.slice());B(v)}function Ca(a){var t=ka(),k=b.Ma,I=b.position[0],p=b.position[1],e=W.la;if(g.state===y.e)if(e[d.u]&&!b.a)v=(v+Levels.length-1)%Levels.length,B(v),b.a=!0;else if(e[d.w]&&!b.a)v=(v+1)%Levels.length,B(v),b.a=!0;else if(e[d.l]&&!b.a)b.a=!0,Levels[v][s.Q]||
qa(),sa(y.g),e[d.l]=void 0;else if(e[d.I]&&!b.a)b.a=!0,Levels[v][s.Q]&&(Levels.splice(v,1),v--,B(v)),e[d.I]=void 0;else if(e[d.t]&&Levels[v][s.Q]&&!b.a){if(k=t=prompt("LEVEL JSON",JSON.stringify(Levels[v])))a:{try{JSON.parse(t);k=!0;break a}catch(f){alert("Level not valid: "+f.message)}k=!1}k&&(Levels[v]=JSON.parse(t),B(v));e[d.t]=void 0}else if(e[d.ha]&&!b.a){if(b.a=!0,Ga){var l=h("post",Z+"/addLevel");l.onload=function(){prompt("Your level share url",l.responseText)};l.send(JSON.stringify(Levels[v]));
e[d.ha]=void 0}}else e[d.u]||(e[d.w]||e[d.I]||e[d.l]||e[d.t]||e[d.ha])||(b.a=!1);else{if(g.state===y.g)if(e[d.u]&&!b.a)H=(H+Xa-1)%Xa,b.a=!0;else if(e[d.w]&&!b.a)H=(H+1)%Xa,b.a=!0;else if(e[d.i]&&!b.a)c instanceof Array?u=q=c=null:(c=[32,32],q=[c[0]+15,c[1]+23],u=q.slice()),b.a=!0;else if(e[d.f]&&!b.a){b.a=!0;try{var n=JSON.parse(prompt("Set crates",JSON.stringify(Levels[v][s.f])));if(n instanceof Array){for(t=0;t<n.length;t++)"number"===!typeof t&&alert("Crates not valid"),n[t]=Math.max(1,Math.min(5,
n[t]));Levels[v][s.f]=n;Aa(Levels[v])}}catch(x){alert("Crates not valid: "+x.message)}e[d.f]=void 0}else e[d.m]&&!b.a?(b.a=!0,(t=prompt("Set name",Levels[v][s.m]))&&(Levels[v][s.m]=t),e[d.m]=!1):e[d.k]&&!b.a?(b.a=!0,a=+prompt("Set time",Levels[v][s.k]),!isNaN(a)&&0<a&&(Levels[v][s.k]=a),e[d.k]=!1):e[d.l]&&!b.a?(b.a=!0,La(),e[d.l]=void 0):e[d.u]||(e[d.w]||e[d.i]||e[d.f]||e[d.m]||e[d.k]||e[d.l])||(b.a=!1);else g.state===y.j&&(!e[d.P]||b.G||b.n||b.B?e[d.l]&&!b.B?(b.B=!0,0<b.K&&(b.K--,b.W=nb,b.X=a+ob,
n=Object.create(pb),n.position=[b.position[0]+4,b.position[1]-7],xa.push(n),w(E.ya))):e[d.P]||(e[d.l]||!b.B)||(b.B=!1):(b.B=!0,Fa()),e[d.R]?X(J.p)?(b.position[1]=Math.min(T-C,p-k),b.a=!0):b.G||b.n||(b.C=b.La,b.U=t,b.G=!0,b.n=!0,w(E.sa)):!e[d.R]&&b.G&&(b.G=!1),e[d.u]&&(b.position[0]=Math.max(C,I-aa()),b.a=!0,b.A=!0),e[d.w]&&(b.position[0]=Math.min(S-2*C,I+aa()),b.a=!0,b.A=!1),e[d.ca]&&X(J.p)&&(b.position[1]=Math.min(T,p+k),b.a=!0),e[d.u]||(e[d.R]||e[d.w]||e[d.ca])||(b.a=!1));e[d.e]&&La()}}function fa(a,
b,c,d,g){var e=b,f=ea(a,e);c=a+c;topRight=ea(c,e);bottomRight=ea(c,b+d);bottomLeft=ea(a,b);return f===g||topRight===g||bottomRight===g||bottomLeft===g}function ga(a,b,c,d,g){b+=d;d=ea(a,b);bottomLeft=ea(a+c,b);return d===g||bottomLeft===g}function X(a){return fa(b.position[0]-8,b.position[1]-32,16,32,a)||fa(b.position[0],b.position[1]-8,0,0,a)}function la(a,b){return Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2)}function ua(){return void 0!==b.d?M[b.d]:void 0}function V(a,b){return Math.atan((b[1]-
a[1])/(b[0]-a[0]))}function ma(){var a=ua();a&&(w(E.va),b.d=void 0,a.position=a.H.slice(),b.T--,0>=b.T&&Ba())}function Ma(a,b,c){var d=null,g="#00deff";a===J.xa?d=D.Ba:a===J.F?d=D.F:a===J.Ga?g="#000":a===J.qa?g="#0f0":a===J.v?d=D.v:a===J.p?d=D.p:a===J.o&&(d=D.o);p.fillStyle=g;p.fillRect(b,c,C,C);null!==d&&G(d,b,c,C,C)}(function(){for(var a=0,b=["webkit","moz"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=
window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),f=window.setTimeout(function(){b(c+d)},d);a=c+d;return f});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})})();window.createCORSRequest=h;var Q=!1;if("ontouchstart"in document.documentElement)for(var Q=!0,ba=document.getElementsByClassName("btn"),Y=0;Y<ba.length;Y++)-1===
ba[Y].getAttribute("class").indexOf("edit")&&ba[Y].setAttribute("class","btn");var Z="http://127.0.0.1:3000",Ga=!1,ca=h("get",Z+"/getServerCode");ca&&(ca.onload=function(){if("Ok"===ca.responseText){Ga=!0;var a=window.location.hash;if(1<a.length){var a=a.substr(1),b=h("get",Z+"/getLevel/"+a);b.onload=function(){try{var a=b.responseText;0<a.length&&qa(JSON.parse(a))}catch(c){console.log("Invalid level received: "+c.message)}};b.send()}}},ca.send());var L=document.getElementById("C"),p=L.getContext("2d"),
R=0,v=0,n=[0,0],va=!1,Na=1,H=0,Wa=!1,S=640,T=400,C=16,za=S/C,Va=T/C,Ta=window.btoa&&window.atob,J={EMPTY:"0",xa:"1",p:"2",F:"3",Ga:"4",qa:"5",v:"6",o:"7"},ya=8,pa={ua:ya+0,r:ya+1,i:ya+2,f:ya+3},Xa=ya+4,y={e:0,j:1,g:2},E={sa:0,va:1,na:2,Fa:3,$:4,ma:5,za:6,pa:7,ya:8,aa:9,o:10,ra:11},bb=10,Pa=12,eb=[1,-6],nb=3,ob=5E3,mb=3,kb=3,lb=5,cb=10,db="023123467".split(""),d={u:37,R:38,w:39,ca:40,l:69,P:32,e:27,I:68,t:74,i:71,f:67,m:78,k:84,ha:83},D={r:0,oa:1,o:2,i:3,p:4,D:5,v:6,F:7,wa:8,Ba:9},O={};O[D.r]={frame:{x:30,
y:0,b:30,c:14},h:{x:1,y:1,b:30,c:14},frames:[{x:1,y:1,b:15,c:13},{x:17,y:1,b:15,c:13}]};O[D.oa]={frame:{x:14,y:40,b:14,c:8},h:{x:1,y:7,b:14,c:8}};O[D.o]={frame:{x:32,y:14,b:16,c:16},h:{x:0,y:0,b:16,c:16}};O[D.i]={frame:{x:0,y:24,b:14,c:24},h:{x:1,y:7,b:14,c:24}};O[D.p]={frame:{x:16,y:48,b:16,c:16},h:{x:0,y:0,b:16,c:16}};O[D.D]={frame:{x:0,y:0,b:30,c:24},h:{x:1,y:3,b:30,c:24},frames:[{x:0,y:0,b:15,c:24},{x:15,y:0,b:15,c:24}]};O[D.v]={frame:{x:48,y:14,b:16,c:10},h:{x:0,y:10,b:16,c:10}};O[D.F]={frame:{x:14,
y:24,b:16,c:16},h:{x:0,y:0,b:16,c:16}};O[D.wa]={frame:{x:31,y:30,b:6,c:14},h:{x:4,y:1,b:6,c:14}};O[D.Ba]={frame:{x:0,y:48,b:16,c:16},h:{x:0,y:0,b:16,c:16}};var s={m:0,fa:1,ba:2,Z:3,s:4,k:5,ea:6,f:7,J:8,Q:9},na=new Image,Oa=document.createElement("canvas"),$a=0;na.onload=function(){Oa.width=$a=na.naturalWidth;Oa.height=na.naturalHeight;var a=Oa.getContext("2d");a.translate(na.naturalWidth,0);a.scale(-1,1);a.drawImage(na,0,0)};na.src="img/imgmap.png";var b={position:null,speed:4,U:0,W:0,X:0,Ma:2,La:-7,
G:!1,n:!1,a:!1,B:!1,C:0,d:void 0,K:0,T:bb,A:!1};K=a=null;A=0;k=!1;x=0;z=cb;var wa=[],Ia={ka:null,size:1,position:null,H:[0,0]},M=[],pb={position:null},xa=[],jb={position:null,speed:6},oa=[],g={state:y.e,S:L.getBoundingClientRect(),time:0,ia:0,ja:0,q:null},Qa=document.createElement("canvas");u=null;c=[80,53];q=[95,78];var fb=[["Tutorial",[33,370],[S-24,55],[300,365],[20,70],3E6,"00000000000000000000000000000000000000000000000000000000000000000000000000000000330000000000000000000000000000000000006000000000000000000000000000000000000000110000000000033300000000000006000000000000110000000003330000000000001110000000000000000000000333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003333333333333333333333333333333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000555500000000000000000000000000000000000055550000000000000000000000000000000000005555000000000007000000000000002000000000111111111111111111111111111111200000000000000000000000000000000000000020000000000000000000000000000000000000002000000000000000000000000000000000000000200000000000000000000000000000000000000020000000001111111111111111111111111111111111111111",
[1],[[20,340,["PLAYER 1"]],[100,340,["ARROWS: move/jump"]],[250,340,["SPACEBAR: grab/release crate"]],[500,340,["UP/DOWN: Climb ladder"]],[450,250,["Crates break if you fall from too high"]],[160,250,[(Q?"S":"SPACEBAR")+": buy candies when not holding crate","E: Use candy to gain speed"]],[10,230,["Deliver crate to green area"]],[560,30,["PLAYER 2",(Q?"DPad":"Mouse")+": move"]],[410,70,["Don't get shot","Hide in the nest"]],[410,130,[(Q?"2":"RClick")+": eat from nest or candy crumbs",(Q?"1":"LClick")+
": shoot!"]],[140,60,["Don't touch roofs or the boy"]]]],["Level 1",[25,366],[616,24],[41,364],[513,180],6E4,"00000000000000000000000000000000000000600000000000000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000003330000000000000000000000000000000000003333300000000000000000000000000000000000055500000000000000000000000000000000000005550000020000000000000200000000000000000555020002000111111111120000333000000000111112000200133333330002000000000000000000000200021130000000000200000000000000000000020002000000000000020000000000000000000002000200020000000002111111100111001101111100111112000000000200000000000000000000000033333200000000020000000000000000000000000000020000000000000000000000000000000000000002000000000000000000000000000000000000000200000000000000000000000000000000001111111111111111111111111111111111111111",
[1,2]],["Level 2",[28,143],[600,296],[588,365],[51,50],12E4,"33330000000000000000000000000000000000005550000000000033000000000330000000000000555000000000000000000000000000000000000055500000000000000003030000000000000000001111111000000000000030000000000000110010000000010000000000000000000000000100301000000000000200000200000200000200000000100000000011120111102000201111021113002010111100000002000000020200000002000000211100000000000100000000200000000100000020000000000000000000000000000000000002002000000000000000000000000000000000030211100000001110000000000000000000000030020000000000000000000000003333300000000002000000000000000000000000000000000003020200000000000001100000000000000000000002110000000000000000000000000020700000020200000000000000000000000000112110000002020000060000000000010000000000200000000201000011100000000000000000000020000000020000000000000000000000000000002000000002000000000000000000000000000000200000000200000000001111111111111111111111111111111111111111",
[1,2]],["Level 5",[75,370],[S-24,24],[83,365],[80,53],3E5,"33333300000000000000000000000000000000605555530000000000000000000000000000000011555550000000000000000000003333000000000055555000000000000002000000000000000000001111110010011001111201110011110000000000000000000003300000020000000000100000000000000000000000000702000000000001000000000001110000000000111111000000000010020000002000000000000033333330000333330102100000200033333300000000000000000000000200000020000000000000000000000000000000020000002000000000000010010010011000020202000000201111111111111000000033311001111211100020033333333330000000000003300000033333002000000000000000000000000000000000000000200000000000000000200000000000020000000020111100111110011120111001111112011111002000000000000000002000000303030200000000200000000000000000207000000000020000000000333330003030300011110000200002000000000000000000000000000000000021111200000000000000000000000000000000002000000000001111111111111111111111111111111111111111",
[1,2,3]]];Levels=window.localStorage&&window.localStorage.ta&&JSON.parse(window.localStorage.ta)||fb;var Na=Levels.length-fb.length+1,W={la:{},O:function(a){W.la[a.keyCode]=void 0},N:function(a){W.la[a.keyCode]=R}};window.addEventListener("keyup",W.O,!1);window.addEventListener("keydown",W.N,!1);for(var gb=[523.25,587.33,659.26,698.46,783.99,880,987.77,1046.5,1108.73],ab={},Ra=0;Ra<gb.length;Ra++)ab[Ra]=Sa.Ca(["synth",0,0.4,0,0.208,0,0.12,20,gb[Ra],2400,0,0,0,0.01,3E-4,0,0,0,0,0,0,0,0,1,0,0,0.1,0]);
var Ua=db.slice(),Ha={};m(E.sa,["square",0,0.4,0,0.174,0,0.28,20,497,2400,0.22,0,0,0.01,3E-4,0,0,0,0.0665,0,0,0,0,0.783,0,0,0,0]);m(E.va,["noise",0,0.4,0,0.14,0.405,0.116,20,479,2400,-0.07,0,0,0.01,3E-4,0,0,0,0,0,0,-0.086,-0.122,1,0,0,0,0]);m(E.ma,["square",0,0.4,0,0.098,0.504,0.282,20,1582,2400,0,0,0,0.01,3E-4,0,0,0,0,0,0,0,0,1,0,0,0,0]);m(E.ya,["saw",0,0.4,0,0.324,0,0.284,20,631,2400,0.172,0,0.498,19.35,3E-4,0,0,0,0,0,0,0,0,1,0,0,0,0]);m(E.na,["saw",0,0.4,0,0.212,0,0.028,20,1169,2400,-0.52,0,0,
0.01,3E-4,0,0,0,0.5,-0.592,0,0.094,0.066,1,0,0,0.28,0]);m(E.pa,["synth",0,0.4,0,0.32,0.348,0.44,20,372,417,0,0,0,0.01,3E-4,0,0.374,0.264,0,0,0,0,0,1,0,0,0,0]);m(E.za,["synth",0,0.4,0,0.13,0.345,0.41,253,1168,1407,-0.0060,-0.082,0,0.01,3E-4,0,0.206,0.166,0,0,0,0,0,1,0,0,0,0]);m(E.$,["noise",0,0.4,0,0.0020,0.024,0.09,20,372,2400,0,0,0,0.01,3E-4,0,-0.342,0.809,0,0,0,0,0,1,0,0,0,0]);m(E.Fa,["noise",0,0.4,0,0.152,0.393,0.274,20,839,2400,-0.31,0,0,0.01,3E-4,0,-0.34,0.783,0,0,0.6096,0.526,-0.0080,1,0,0,
0,0]);m(E.aa,["square",0,0.4,0,0.04,0,0.048,20,578,2400,0.104,0,0.683,19.158,3E-4,0,0,0,0.385,0,0,0,0,1,0,0,0,0]);m(E.o,["square",0,0.4,0,0.046,0.477,0.24,20,1197,2400,0,0,0,0.01,3E-4,0,0.498,0.204,0,0,0,0,0,1,0,0,0,0]);m(E.ra,["noise",0,0.4,0,0.108,0.336,0.124,20,462,2400,0,0,0,0.01,3E-4,0,0,0,0,0,0,0,0,1,0,0,0,0]);B(v);F(L,"click",$);F(L,"mousedown",function(a){1===a.which&&(va=!0);g.state===y.g&&va&&$()});F(L,"mouseup",function(a){1===a.which&&(va=!1)});F(L,"mousemove",function(a){var b=N(a);n=
[b[0],b[1]];g.state===y.j?K=N(a).slice():g.state===y.g&&va&&$()});F(L,"contextmenu",da);if(Q){var ha=function(a,b){var c=document.getElementById(a);F(c,"touchstart",function(){W.N({keyCode:b})});F(c,"touchend",function(){W.O({keyCode:b})})},Ya=function(a,b,c){a=document.getElementById(a);F(a,"touchstart",b);F(a,"touchend",c)};F(L,"touchstart",function(){g.state===y.e&&P()});Ya("s",function(){g.state===y.e?W.N({keyCode:d.I}):$()},function(){W.O({keyCode:d.I})});Ya("e",function(a){g.state===y.e?W.N({keyCode:d.t}):
da(a)},function(){W.O({keyCode:d.t})});var Ja=document.getElementById("o"),ia=Ja.getBoundingClientRect(),hb=[100,100],Za=!1,Ka,ib=function(a){a.preventDefault();Ka=a.changedTouches;ia=Ja.getBoundingClientRect();Za=!0};F(Ja,"touchstart",ib);F(Ja,"touchmove",ib);F(Ja,"touchend",function(a){a.preventDefault();Za=!1});Ya("p",function(){W.N({keyCode:g.state!==y.e?d.P:d.t})},function(){W.O({keyCode:g.state!==y.e?d.P:d.t})});ha("a",d.l);ha("l",d.u);ha("u",d.R);ha("r",d.w);ha("d",d.ca);ha("g",d.i);ha("c",
d.f);ha("t",d.k);ha("n",d.m)}(function t(d){Ca(d);R=d;if(Za&&Ka){for(var h,m,e=0;e<Ka.length;e++)if(m=Ka[e],m.clientX>=ia.left&&m.clientX<ia.left+ia.width&&m.clientY>=ia.top&&m.clientY<ia.top+ia.height){h=Ka[e];break}if(h){h=[h.clientX-ia.left,h.clientY-ia.top];m=V(hb,h);var e=Math.sqrt(la(hb,h))/12.5,f;g.state===y.j?f=a:g.state===y.g&&(f=n);f&&(f[0]+=(g.state===y.g?Math.round(Math.cos(m)):Math.cos(m))*(100>h[0]?-e:e),f[1]+=(g.state===y.g?Math.round(Math.sin(m)):Math.sin(m))*(100>h[0]?-e:e),f[0]=
Math.max(0,Math.min(f[0],S-1)),f[1]=Math.max(0,Math.min(f[1],T-1)));Wa&&$()}}if(g.state===y.j){g.S=L.getBoundingClientRect();f=0;for(var l;f<=b.C;){if(ga(b.position[0]-8,b.position[1]+f,16,0,J.xa)){l=b.position[1]+f-(b.position[1]+f)%C;break}f+=C}l?(b.position[1]=l,b.n&&(b.U=0,(l=ua())&&b.C>12-l.size&&ma()),b.n=!1,b.C=0):ga(b.position[0]-16,b.position[1]-32,16,32,J.p)?b.n=!1:(b.C+=1,b.n=!0,b.position[1]+=b.C);void 0!==b.d&&(M[b.d].position[0]=b.position[0]+eb[0],M[b.d].position[1]=b.position[1]+eb[1]);
b.X<d&&0<b.W&&(b.W=0);for(l=0;l<oa.length;l++)if(f=oa[l],f.position[1]+=f.speed,ta(b.position,f.position))ma(),oa.splice(l,1),l--;else if(f.position[1]>T||ga(f.position[0],f.position[1],0,0,J.F))oa.splice(l,1),l--;g.time<d&&Ba();a&&K&&(m=V(a,K),e=a[0]>K[0]?-1:1,l=Math.abs(a[0]-K[0]),f=Math.abs(a[1]-K[1]),3<l||3<f)&&(h=16*Math.cos(m)*e,m=16*Math.sin(m)*e,Math.abs(h)>l&&(h=l*h/Math.abs(h)),Math.abs(m)>f&&(m=f*m/Math.abs(m)),a[0]+=h,a[1]+=m);k=Math.pow(7*ka()+75,2)>=la(a,b.position);c&&(l=ga(a[0],a[1],
0,0,J.v)?q:a,f=V(u,l),h=u[0]>l[0]?-1:1,3<Math.abs(l[0]-u[0])||3<Math.abs(l[1]-u[1]))&&(u[0]+=1*Math.cos(f)*h,u[1]+=1*Math.sin(f)*h);(Math.pow(7*ka()+25,2)>=la(a,b.position)||fa(a[0],a[1],0,0,J.F)||c&&3>Math.sqrt(la(u,a)))&&x<d&&(x=d+5E3,w(E.ra),A=0,z--,0>=z&&ra())}g.S=L.getBoundingClientRect();p.fillStyle="black";p.fillRect(0,0,S,T);for(l=0;l<za;l++)for(f=0;f<Va;f++)Ma(wa[za*f+l],l*C,f*C);for(f=0;f<M.length;f++)f!==b.d&&(l=M[f],p.drawImage(l.ka,l.position[0]-8,l.position[1]-8));for(f=0;f<xa.length;f++)l=
xa[f],G(D.oa,l.position[0]-8,l.position[1]-8);for(f=0;f<oa.length;f++)l=oa[f],G(D.wa,l.position[0]-8,l.position[1]-8);c&&G(D.i,c[0],c[1]);if(g.q[s.J])for(l=0;l<g.q[s.J].length;l++){f=p;var B=g.q[s.J][l][2];h=g.q[s.J][l][0];var F=g.q[s.J][l][1];m=f.fillColor;e=f.textAlign;f.fillStyle="black";for(B=B.slice();0<B.length;)f.fillText(B.shift(),h,F),F+=10;f.fillStyle=m;f.textAlign=e}g.state===y.j?b.n?U(D.D,b.position[0]-8,b.position[1]-24,0,b.A):b.a?U(D.D,b.position[0]-8,b.position[1]-24,10,b.A,d):U(D.D,
b.position[0]-8,b.position[1]-24,1,b.A):U(D.D,b.position[0]-8,b.position[1]-24,1);void 0!==b.d&&(l=M[b.d],p.drawImage(l.ka,b.A?l.position[0]+2:l.position[0]-15-l.size,l.position[1]-10));k&&(p.beginPath(),p.arc(b.position[0],b.position[1],7*ka()+25,0,360),p.lineWidth=2,p.strokeStyle="#f09",p.stroke());g.state===y.j?x>d&&0===Math.floor(d/100)%2||U(D.r,a[0]-8,a[1]-8,2,!1,d):U(D.r,a[0]-8,a[1]-8,0);c&&(p.fillStyle="red",p.fillRect(u[0]-1,u[1]-1,2,2),p.beginPath(),p.arc(u[0],u[1],5,0,360),p.lineWidth=2,
p.strokeStyle="red",p.stroke());g.state===y.j?(p.fillStyle="#00deff",p.fillText("BOY",10,396),p.fillStyle="red",p.fillText("CROW",600,12),p.fillStyle="white",p.fillText("SPEED: "+ka()+"   BOOST: "+Math.max(0,Math.ceil((b.X-d)/1E3))+"   TIME: "+Math.max(0,Math.ceil((g.time-d)/1E3))+"   CANDIES: "+b.K+"   CRATES: "+b.T,50,396),p.fillText("SHOTS: "+A+"   STUN: "+Math.max(0,Math.ceil((x-d)/1E3))+"   HEALTH: "+z,410,12)):g.state===y.g&&(p.fillStyle="white",p.fillText("< > CHANGE BLOCK   G: GRANNY   C: CRATES   T: TIME ("+
Levels[v][s.k]+")   N: NAME ("+Levels[v][s.m]+")"+(Q?"   1: PAINT   2: TOGGLE PAINT":""),12,12));g.state===y.e&&p.drawImage(Qa,0,0);g.state===y.g&&(p.globalAlpha=0.6,H<ya?(Ma(""+H,n[0]-n[0]%C,n[1]-n[1]%C),p.strokeStyle="#000",p.strokeRect(n[0]-n[0]%C,n[1]-n[1]%C,C,C)):H===pa.ua?U(D.D,n[0]-8,n[1]-24,1):H===pa.r?U(D.r,n[0]-8,n[1]-8,0):H===pa.i?G(D.i,n[0],n[1]):H===pa.f&&(p.fillStyle="yellow",p.fillRect(n[0]-8,n[1]-8,16,16),p.fillStyle="#000",p.fillText("C",n[0]-4,n[1]+4)),p.globalAlpha=1);window.requestAnimationFrame(t)})()})();

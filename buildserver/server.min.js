var f=require("http"),h=require("fs"),k=require("crypto"),l="return ("+function(){alert("ciao");isOnline=!0}.toString()+")()";
h.exists("levels.json",function(g){g||h.writeFileSync("levels.json","{}");var d=JSON.parse(h.readFileSync("levels.json")),c;for(c in d)d[c].a<Date.now()&&(d[c]=void 0);f.createServer(function(a,b){if("OPTIONS"==a.method)console.log("OPTIONS ",a.url),b.writeHead(200,{"Content-Type":"text/html","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, OPTIONS","Access-Control-Allow-Headers":"X-Requested-With, Content-Type","Access-Control-Max-Age":"1800"}),b.end("options received");
else if("POST"==a.method&&"/addLevel"===a.url){console.log("POST",a.url);var e="";a.on("data",function(a){e+=a});a.on("end",function(){try{JSON.parse(e);var a=k.b("md5");a.update(e);var c=a.digest("hex");console.log("Added level with hash: "+c);d[c]={a:Date.now()+6048E5,c:e};h.writeFileSync("levels.json",JSON.stringify(d));b.writeHead(200,{"Content-Type":"text/plain","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, OPTIONS","Access-Control-Allow-Headers":"X-Requested-With, Content-Type",
"Access-Control-Max-Age":"1800"});b.end("127.0.0.1/getLevel/"+c)}catch(g){console.log("Tried to add an invalid level: "+g.message),b.writeHead(400,{"Content-Type":"text/plain","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, OPTIONS","Access-Control-Allow-Headers":"X-Requested-With, Content-Type","Access-Control-Max-Age":"1800"}),b.end("Invalid Level Information")}})}else"GET"==a.method&&0===a.url.indexOf("/getLevel")?(console.log("GET",a.url),b.writeHead(200,{"Content-Type":"text/html",
"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, OPTIONS","Access-Control-Allow-Headers":"X-Requested-With, Content-Type","Access-Control-Max-Age":"1800"}),b.end("ToDo")):"GET"==a.method&&0===a.url.indexOf("/getServerCode")?(console.log("GET",a.url),b.writeHead(200,{"Content-Type":"text/html","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, OPTIONS","Access-Control-Allow-Headers":"X-Requested-With, Content-Type","Access-Control-Max-Age":"1800"}),
b.end(l)):(b.writeHead(400,{"Content-Type":"text/html"}),b.end("Not Supported"))}).listen(3E3,"127.0.0.1");console.log("Listening at http://127.0.0.1:3000")});
